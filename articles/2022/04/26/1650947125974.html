<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/><meta name="theme-color" content="#3b3e43"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no"/><title>Java 8 - CompletableFuture - 佛系码农</title><meta name="description" content="悄悄咪咪写bug的佛系码农"/><meta property="og:description" content="悄悄咪咪写bug的佛系码农"/>    <meta name="keywords" content="Solo,Java,博客,开源"/><link rel="dns-prefetch" href="https://forzenfox.github.io"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://forzenfox.github.io"><link rel="icon" type="image/png" href="https://b3log.org/images/brand/solo-128.png"/><link rel="apple-touch-icon" href="https://b3log.org/images/brand/solo-128.png"><link rel="shortcut icon" type="image/x-icon" href="https://b3log.org/images/brand/solo-128.png"><meta name="copyright" content="B3log"/><meta http-equiv="Window-target" content="_top"/><meta property="og:locale" content="zh_CN"/><meta property="og:title" content="Java 8 - CompletableFuture - 佛系码农"/><meta property="og:site_name" content="佛系码农"/><meta property="og:url"      content="https://forzenfox.github.io/articles/2022/04/26/1650947125974.html?"/><meta property="og:image" content="https://b3log.org/images/brand/solo-128.png"/><link rel="search" type="application/opensearchdescription+xml" title="Java 8 - CompletableFuture - 佛系码农" href="/opensearch.xml"><link href="https://forzenfox.github.io/rss.xml" title="RSS" type="application/rss+xml" rel="alternate"/><link rel="manifest" href="https://forzenfox.github.io/manifest.json">        <link rel="canonical" href="https://forzenfox.github.io/articles/2022/04/26/1650947125974.html">        <link rel="stylesheet"
              href="https://forzenfox.github.io/skins/Bubble/css/base.css?1682844075131"/>
            <link rel="prev" title="Spring Framework 学习笔记 - Spring 应用上下文生命周期" href="https://forzenfox.github.io/articles/2022/04/02/1648886248605.html">
            <link rel="next" title="如何实现在容器内部限速" href="https://forzenfox.github.io/articles/2023/05/03/1683102869814.html">
    <script src="https://cdn.jsdelivr.net/npm/vditor@3.8.4/dist/js/icons/ant.js" async="" id="vditorIconScript"></script></head>
<body class="fn__flex-column">
<div id="pjax" class="fn__flex-1">
    
    <progress class="fn__progress"></progress>
    <header class="header header--article">
        <div class="wrapper header__title">
            <h1 class="header__h1 fn__flex-inline">
                <a href="https://forzenfox.github.io" rel="start">佛系码农</a>
            </h1>
            <h2 class="header__desc header__desc--title">就是你小子悄悄咪咪把bug写出来的？</h2>
            <div class="header__desc">
                
            </div>
            <svg class="header__down" id="headerDown" viewBox="0 0 32 32" width="100%" height="100%">
                <path d="M15.992 25.304c-0 0-0 0-0.001 0-0.516 0-0.981-0.216-1.31-0.563l-0.001-0.001-14.187-14.996c-0.306-0.323-0.494-0.76-0.494-1.241 0-0.998 0.809-1.807 1.807-1.807 0.517 0 0.983 0.217 1.313 0.565l0.001 0.001 12.875 13.612 12.886-13.612c0.331-0.348 0.797-0.565 1.314-0.565 0.481 0 0.918 0.187 1.242 0.493l-0.001-0.001c0.723 0.687 0.755 1.832 0.072 2.555l-14.201 14.996c-0.33 0.348-0.795 0.564-1.311 0.564-0.001 0-0.003 0-0.004 0h0z"></path>
            </svg>
        </div>
    </header>
    <div class="side__menu">
        <svg viewBox="0 0 32 32" width="100%" height="100%">
            <path d="M30 18h-28c-1.1 0-2-0.9-2-2s0.9-2 2-2h28c1.1 0 2 0.9 2 2s-0.9 2-2 2zM30 6.25h-28c-1.1 0-2-0.9-2-2s0.9-2 2-2h28c1.1 0 2 0.9 2 2s-0.9 2-2 2zM2 25.75h28c1.1 0 2 0.9 2 2s-0.9 2-2 2h-28c-1.1 0-2-0.9-2-2s0.9-2 2-2z"></path>
        </svg>
        <span>
            &nbsp; menu
        </span>
    </div>
    <div class="side__main">
        <div class="side__bg"></div>
        <div class="side__panel">
            <svg class="side__close ft__a" version="1.1" xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                 viewBox="0 0 20 20">
                <path d="M18.362 19.324c-0.902 0.902-2.363 0.902-3.263 0l-5.098-5.827-5.098 5.825c-0.902 0.902-2.363 0.902-3.263 0-0.902-0.902-0.902-2.363 0-3.263l5.304-6.057-5.306-6.061c-0.902-0.902-0.902-2.361 0-3.263s2.361-0.902 3.263 0l5.1 5.829 5.098-5.829c0.902-0.902 2.361-0.902 3.263 0s0.902 2.363 0 3.263l-5.304 6.061 5.304 6.057c0.902 0.902 0.902 2.363 0 3.265z"></path>
            </svg>

            <div class="side__header">
                <a href="https://forzenfox.github.io" rel="start"><img class="side__logo" alt="佛系码农" src="https://b3logfile.com/avatar/1636036720949_1636122082221.jpeg?imageView2/1/w/128/h/128/interlace/0/q/100"></a>

                <div class="side__meta">
                    14 文章 <br>
                    <span data-uvstaturl="https://forzenfox.github.io">0</span> 浏览
                    
                </div>
            </div>

            <div class="side__title">
                <span>ღゝ◡╹)ノ❤️</span>
            </div>
            <ul class="side__nav">
                <li>
                    <a href="https://forzenfox.github.io" rel="start">
                            佛系码农
                    </a>
                </li>
                <li>
                    <a href="https://forzenfox.github.io/categories.html">分类</a>
                </li>
                <li>
                    <a href="https://forzenfox.github.io/tags.html">标签墙</a>
                </li>
                <li>
                    <a href="https://forzenfox.github.io/archives.html">存档</a>
                </li>
                <li>
                    <a href="https://forzenfox.github.io/links.html">友链</a>
                </li>
                <li>
                    <a rel="alternate" href="https://forzenfox.github.io/rss.xml">RSS</a>
                </li>
            </ul>
        </div>
    </div>
    <div class="article__top" style="background-image: url(https://b3logfile.com/bing/20180105.jpg?imageView2/1/w/960/h/540/interlace/1/q/100)">
        <div style="background-image: url(https://b3logfile.com/bing/20180105.jpg?imageView2/1/w/960/h/540/interlace/1/q/100)"></div>
        <canvas id="articleTop"></canvas>
    </div>
    <div class="article">
        <div class="ft__center">
            <div class="article__meta">
                <time>
                    2022-04-26
                </time>
                /
                    <a rel="tag"
                       href="https://forzenfox.github.io/tags/java">java</a> &nbsp;
                    <a rel="tag"
                       href="https://forzenfox.github.io/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B">多线程</a> &nbsp;
            </div>
            <h2 class="article__title">
                Java 8 - CompletableFuture
            </h2>
<div class="article__share"
     data-title="Java 8 - CompletableFuture"
     data-blogtitle="佛系码农"
     data-url="https://forzenfox.github.io/articles/2022/04/26/1650947125974.html"
     data-avatar="https://b3logfile.com/avatar/1636036720949_1636122082221.jpeg?imageView2/1/w/128/h/128/interlace/0/q/100">
    <span class="item" data-type="qqz">
        <svg viewBox="0 0 32 32" width="100%" height="100%">
            <path d="M22.824 13.989l-8.348 6.287s3.351 0.522 8.404 0.461l-0.23-1.040 7.2-6.549c0.132-0.12 0.183-0.312 0.129-0.487s-0.203-0.299-0.377-0.314l-9.492-0.856-3.708-9.213c-0.068-0.169-0.226-0.279-0.401-0.279s-0.333 0.11-0.401 0.279l-3.708 9.213-9.492 0.856c-0.174 0.015-0.323 0.139-0.377 0.314s-0.004 0.366 0.129 0.487l7.2 6.549-2.158 9.742c-0.040 0.178 0.026 0.365 0.168 0.474 0.142 0.107 0.331 0.115 0.481 0.021l8.158-5.165 8.158 5.165c0.070 0.045 0.147 0.066 0.225 0.066 0.090 0 0.18-0.029 0.256-0.086 0.142-0.109 0.208-0.295 0.168-0.474l-1.707-7.704c0.732-0.386 1.538-1.040 1.538-1.040s-3.195 1.638-14.664 0.838l8.312-6.325s-0.327-0.534-10.744-0.914c-0.697-0.026 8.493-1.83 15.281-0.305z"></path>
        </svg>
    </span>
    <span class="item" data-type="wechat">
        <svg viewBox="0 0 32 32" width="100%" height="100%">
            <path d="M9.062 9.203c0-0.859-0.562-1.422-1.422-1.422-0.844 0-1.703 0.562-1.703 1.422 0 0.844 0.859 1.406 1.703 1.406 0.859 0 1.422-0.562 1.422-1.406zM20.672 17.125c0-0.562-0.562-1.125-1.422-1.125-0.562 0-1.125 0.562-1.125 1.125 0 0.578 0.562 1.141 1.125 1.141 0.859 0 1.422-0.562 1.422-1.141zM16.984 9.203c0-0.859-0.562-1.422-1.406-1.422-0.859 0-1.703 0.562-1.703 1.422 0 0.844 0.844 1.406 1.703 1.406 0.844 0 1.406-0.562 1.406-1.406zM26.906 17.125c0-0.562-0.578-1.125-1.422-1.125-0.562 0-1.125 0.562-1.125 1.125 0 0.578 0.562 1.141 1.125 1.141 0.844 0 1.422-0.562 1.422-1.141zM22.75 10.922c-0.359-0.047-0.719-0.063-1.094-0.063-5.375 0-9.625 4.016-9.625 8.953 0 0.828 0.125 1.625 0.359 2.375-0.359 0.031-0.703 0.047-1.063 0.047-1.422 0-2.547-0.281-3.969-0.562l-3.953 1.984 1.125-3.406c-2.828-1.984-4.531-4.547-4.531-7.656 0-5.391 5.094-9.625 11.328-9.625 5.563 0 10.453 3.391 11.422 7.953zM32 19.687c0 2.547-1.688 4.813-3.969 6.516l0.859 2.828-3.109-1.703c-1.141 0.281-2.281 0.578-3.406 0.578-5.391 0-9.625-3.688-9.625-8.219s4.234-8.219 9.625-8.219c5.094 0 9.625 3.688 9.625 8.219z"></path>
        </svg>
    </span>
    <span class="item" data-type="weibo">
        <svg viewBox="0 0 32 32" width="100%" height="100%">
            <path d="M13.444 27.064c-5.3 0.525-9.875-1.875-10.219-5.35-0.344-3.481 3.675-6.719 8.969-7.244 5.3-0.525 9.875 1.875 10.212 5.35 0.35 3.481-3.669 6.725-8.963 7.244zM24.038 15.521c-0.45-0.137-0.762-0.225-0.525-0.819 0.512-1.287 0.563-2.394 0.006-3.188-1.038-1.481-3.881-1.406-7.137-0.037 0 0-1.025 0.444-0.762-0.363 0.5-1.613 0.425-2.956-0.356-3.737-1.769-1.769-6.469 0.069-10.5 4.1-3.013 3.006-4.763 6.212-4.763 8.981 0 5.287 6.787 8.506 13.425 8.506 8.7 0 14.494-5.056 14.494-9.069 0-2.431-2.044-3.806-3.881-4.375z"></path>
            <path d="M29.819 5.833c-2.1-2.331-5.2-3.219-8.063-2.612v0c-0.663 0.144-1.081 0.794-0.938 1.45 0.144 0.662 0.788 1.081 1.45 0.938 2.038-0.431 4.238 0.2 5.731 1.856s1.9 3.913 1.256 5.888v0c-0.206 0.644 0.144 1.331 0.788 1.544 0.644 0.206 1.331-0.144 1.544-0.787v-0.006c0.9-2.762 0.331-5.938-1.769-8.269z"></path>
            <path d="M26.588 8.752c-1.025-1.138-2.538-1.569-3.925-1.269-0.569 0.119-0.931 0.688-0.813 1.256 0.125 0.569 0.688 0.931 1.25 0.806v0c0.681-0.144 1.419 0.069 1.919 0.619 0.5 0.556 0.637 1.313 0.419 1.975v0c-0.175 0.55 0.125 1.15 0.681 1.331 0.556 0.175 1.15-0.125 1.331-0.681 0.438-1.356 0.163-2.906-0.863-4.037z"></path>
            <path d="M13.738 20.771c-0.188 0.319-0.594 0.469-0.912 0.337-0.319-0.125-0.412-0.488-0.231-0.794 0.188-0.306 0.581-0.456 0.894-0.337 0.313 0.113 0.425 0.469 0.25 0.794zM12.044 22.933c-0.512 0.819-1.613 1.175-2.438 0.8-0.813-0.369-1.056-1.319-0.544-2.119 0.506-0.794 1.569-1.15 2.388-0.806 0.831 0.356 1.1 1.3 0.594 2.125zM13.969 17.146c-2.519-0.656-5.369 0.6-6.463 2.819-1.119 2.262-0.037 4.781 2.506 5.606 2.638 0.85 5.75-0.456 6.831-2.894 1.069-2.394-0.262-4.85-2.875-5.531z"></path>
        </svg>
    </span>
    <span class="item" data-type="twitter">
        <svg viewBox="0 0 32 32" width="100%" height="100%">
            <path d="M32.003 6.075c-1.175 0.525-2.444 0.875-3.769 1.031 1.356-0.813 2.394-2.1 2.887-3.631-1.269 0.75-2.675 1.3-4.169 1.594-1.2-1.275-2.906-2.069-4.794-2.069-3.625 0-6.563 2.938-6.563 6.563 0 0.512 0.056 1.012 0.169 1.494-5.456-0.275-10.294-2.888-13.531-6.862-0.563 0.969-0.887 2.1-0.887 3.3 0 2.275 1.156 4.287 2.919 5.463-1.075-0.031-2.087-0.331-2.975-0.819 0 0.025 0 0.056 0 0.081 0 3.181 2.263 5.838 5.269 6.437-0.55 0.15-1.131 0.231-1.731 0.231-0.425 0-0.831-0.044-1.237-0.119 0.838 2.606 3.263 4.506 6.131 4.563-2.25 1.762-5.075 2.813-8.156 2.813-0.531 0-1.050-0.031-1.569-0.094 2.913 1.869 6.362 2.95 10.069 2.95 12.075 0 18.681-10.006 18.681-18.681 0-0.287-0.006-0.569-0.019-0.85 1.281-0.919 2.394-2.075 3.275-3.394z"></path>
        </svg>
    </span>
    <span class="item__qr"></span>
</div>        </div>
        <div class="wrapper">
            <section class="vditor-reset articles article__content">
                <p><img src="https://b3logfile.com/bing/20180105.jpg?imageView2/1/w/960/h/540/interlace/1/q/100" alt=""></p>
<h3 id="构建-CompletableFuture">构建 CompletableFuture</h3>
<h4 id="直接返回计算结果">直接返回计算结果</h4>
<p><code>CompletableFuture.completedFuture</code> 是一个静态辅助方法，用来返回一个已经计算好的 CompletableFuture。</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln">1</span><span class="highlight-cl"><span class="highlight-kd">public</span> <span class="highlight-kd">static</span> <span class="highlight-o">&lt;</span><span class="highlight-n">U</span><span class="highlight-o">&gt;</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">U</span><span class="highlight-o">&gt;</span> <span class="highlight-nf">completedFuture</span><span class="highlight-o">(</span><span class="highlight-n">U</span> <span class="highlight-n">value</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">2</span><span class="highlight-cl">    <span class="highlight-k">return</span> <span class="highlight-k">new</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">U</span><span class="highlight-o">&gt;((</span><span class="highlight-n">value</span> <span class="highlight-o">==</span> <span class="highlight-kc">null</span><span class="highlight-o">)</span> <span class="highlight-o">?</span> <span class="highlight-n">NIL</span> <span class="highlight-o">:</span> <span class="highlight-n">value</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">3</span><span class="highlight-cl"><span class="highlight-o">}</span>
</span></span></code></pre>
<p>示例代码：</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln">1</span><span class="highlight-cl">    <span class="highlight-cm">/**
</span></span></span><span class="highlight-line"><span class="highlight-ln">2</span><span class="highlight-cl"><span class="highlight-cm">     * 构建一个直接返回结果结果的 CompletableFuture
</span></span></span><span class="highlight-line"><span class="highlight-ln">3</span><span class="highlight-cl"><span class="highlight-cm">     */</span>
</span></span><span class="highlight-line"><span class="highlight-ln">4</span><span class="highlight-cl">    <span class="highlight-nd">@Test</span>
</span></span><span class="highlight-line"><span class="highlight-ln">5</span><span class="highlight-cl">    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">test_create_completableFuture</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">6</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">String</span><span class="highlight-o">&gt;</span> <span class="highlight-n">strFuture</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">completedFuture</span><span class="highlight-o">(</span><span class="highlight-s">"我是字符串"</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">7</span><span class="highlight-cl">        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"strFuture 计算结果："</span> <span class="highlight-o">+</span> <span class="highlight-n">strFuture</span><span class="highlight-o">.</span><span class="highlight-na">join</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">8</span><span class="highlight-cl">    <span class="highlight-o">}</span>
</span></span></code></pre>
<h4 id="为异步执行的任务构建-CompletableFuture">为异步执行的任务构建 CompletableFuture</h4>
<p>使用下面这组静态方法，为创建一个异步执行的 <code>CompletableFuture</code></p>
<ul>
<li>
<p>无返回值的</p>
<ul>
<li>CompletableFuture#runAsync(Runnable)</li>
<li>CompletableFuture#runAsync(Runnable, Executor)</li>
</ul>
<p>示例代码：</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln"> 1</span><span class="highlight-cl">    <span class="highlight-cm">/**
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 2</span><span class="highlight-cl"><span class="highlight-cm">     * 构建无返回值的 {@link CompletableFuture}
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 3</span><span class="highlight-cl"><span class="highlight-cm">     *
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 4</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#runAsync(Runnable)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 5</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#runAsync(Runnable, Executor)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 6</span><span class="highlight-cl"><span class="highlight-cm">     */</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 7</span><span class="highlight-cl">    <span class="highlight-nd">@Test</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 8</span><span class="highlight-cl">    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">create_completableFuture_by_runAsync</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 9</span><span class="highlight-cl">        <span class="highlight-c1">// 默认使用 ForkJoinPool.commonPool() 作为它的线程池执行异步代码
</span></span></span><span class="highlight-line"><span class="highlight-ln">10</span><span class="highlight-cl"><span class="highlight-c1"></span>        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">Void</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future_01</span> <span class="highlight-o">=</span>
</span></span><span class="highlight-line"><span class="highlight-ln">11</span><span class="highlight-cl">                <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">runAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"Thread:%s\n"</span><span class="highlight-o">,</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">()));</span>
</span></span><span class="highlight-line"><span class="highlight-ln">12</span><span class="highlight-cl">        <span class="highlight-c1">// 使用指定线程池作为它的线程池执行异步代码
</span></span></span><span class="highlight-line"><span class="highlight-ln">13</span><span class="highlight-cl"><span class="highlight-c1"></span>        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">Void</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future_02</span> <span class="highlight-o">=</span>
</span></span><span class="highlight-line"><span class="highlight-ln">14</span><span class="highlight-cl">                <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">runAsync</span><span class="highlight-o">(</span>
</span></span><span class="highlight-line"><span class="highlight-ln">15</span><span class="highlight-cl">                        <span class="highlight-o">()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"Thread:%s\n"</span><span class="highlight-o">,</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">()),</span>
</span></span><span class="highlight-line"><span class="highlight-ln">16</span><span class="highlight-cl">                        <span class="highlight-n">FIXED_THREAD_POOL</span>
</span></span><span class="highlight-line"><span class="highlight-ln">17</span><span class="highlight-cl">                <span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">18</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">19</span><span class="highlight-cl">        <span class="highlight-n">future_01</span><span class="highlight-o">.</span><span class="highlight-na">join</span><span class="highlight-o">();</span>
</span></span><span class="highlight-line"><span class="highlight-ln">20</span><span class="highlight-cl">        <span class="highlight-n">future_02</span><span class="highlight-o">.</span><span class="highlight-na">join</span><span class="highlight-o">();</span>
</span></span><span class="highlight-line"><span class="highlight-ln">21</span><span class="highlight-cl">    <span class="highlight-o">}</span>
</span></span></code></pre>
<p>执行结果：</p>
<blockquote>
<p>Thread:ForkJoinPool.commonPool-worker-1<br>
Thread:pool-1-thread-1</p>
</blockquote>
</li>
<li>
<p>有返回值的</p>
<ul>
<li>CompletableFuture#supplyAsync(Supplier)</li>
<li>CompletableFuture#supplyAsync(Supplier, Executor)</li>
</ul>
<p>示例代码：</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln"> 1</span><span class="highlight-cl">    <span class="highlight-cm">/**
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 2</span><span class="highlight-cl"><span class="highlight-cm">     * 构建有返回值的 {@link CompletableFuture}
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 3</span><span class="highlight-cl"><span class="highlight-cm">     *
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 4</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#supplyAsync(Supplier)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 5</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#supplyAsync(Supplier, Executor)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 6</span><span class="highlight-cl"><span class="highlight-cm">     */</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 7</span><span class="highlight-cl">    <span class="highlight-nd">@Test</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 8</span><span class="highlight-cl">    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">create_completableFuture_by_supplyAsync</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 9</span><span class="highlight-cl">        <span class="highlight-c1">// 默认使用 ForkJoinPool.commonPool() 作为它的线程池执行异步代码
</span></span></span><span class="highlight-line"><span class="highlight-ln">10</span><span class="highlight-cl"><span class="highlight-c1"></span>        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">String</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future_01</span> <span class="highlight-o">=</span>
</span></span><span class="highlight-line"><span class="highlight-ln">11</span><span class="highlight-cl">                <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-n">String</span><span class="highlight-o">.</span><span class="highlight-na">format</span><span class="highlight-o">(</span><span class="highlight-s">"future_01 执行线程:%s"</span><span class="highlight-o">,</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">()));</span>
</span></span><span class="highlight-line"><span class="highlight-ln">12</span><span class="highlight-cl">        <span class="highlight-c1">// 使用指定线程池作为它的线程池执行异步代码
</span></span></span><span class="highlight-line"><span class="highlight-ln">13</span><span class="highlight-cl"><span class="highlight-c1"></span>        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">String</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future_02</span> <span class="highlight-o">=</span>
</span></span><span class="highlight-line"><span class="highlight-ln">14</span><span class="highlight-cl">                <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(</span>
</span></span><span class="highlight-line"><span class="highlight-ln">15</span><span class="highlight-cl">                        <span class="highlight-o">()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-n">String</span><span class="highlight-o">.</span><span class="highlight-na">format</span><span class="highlight-o">(</span><span class="highlight-s">"future_02 执行线程:%s"</span><span class="highlight-o">,</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">()),</span>
</span></span><span class="highlight-line"><span class="highlight-ln">16</span><span class="highlight-cl">                        <span class="highlight-n">FIXED_THREAD_POOL</span>
</span></span><span class="highlight-line"><span class="highlight-ln">17</span><span class="highlight-cl">                <span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">18</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">19</span><span class="highlight-cl">        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-n">future_01</span><span class="highlight-o">.</span><span class="highlight-na">join</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">20</span><span class="highlight-cl">        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-n">future_02</span><span class="highlight-o">.</span><span class="highlight-na">join</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">21</span><span class="highlight-cl">    <span class="highlight-o">}</span>
</span></span></code></pre>
<p>执行结果：</p>
<blockquote>
<p>future_01 执行线程:ForkJoinPool.commonPool-worker-1<br>
future_02 执行线程:pool-1-thread-1</p>
</blockquote>
</li>
</ul>
<p><strong>注：根据方法入参规律性理解功能</strong></p>
<ul>
<li>入参为 <code>java.lang.Runnable</code> 的方法表明无需入参也无返回值</li>
<li>入参为 <code>java.util.function.Supplier</code> 的方法表明无需入参但是有返回值</li>
<li>入参多一个 <code>java.util.concurrent.Executor</code> 的方法表明把任务提交到指定线程池执行</li>
</ul>
<h3 id="对计算结果的二次处理">对计算结果的二次处理</h3>
<h4 id="不改变计算结果的对象类型-仅对结果进行二次增强处理">不改变计算结果的对象类型，仅对结果进行二次增强处理</h4>
<ul>
<li>
<p>当 <code>CompletableFuture</code> 的计算完成或发生异常时，在同一线程中执行特定的 Action</p>
<p><font color="red">同一线程指与调用 <code>CompletableFuture#whenComplete</code> 的 CompletableFuture 实例任务执行的线程</font></p>
<blockquote>
<p>CompletableFuture#whenComplete(BiConsumer)</p>
</blockquote>
</li>
<li>
<p>当 <code>CompletableFuture</code> 的计算完成或发生异常时，另起一个线程执行特定的 Action</p>
<blockquote>
<p>CompletableFuture#whenCompleteAsync(BiConsumer)</p>
<p>CompletableFuture#whenCompleteAsync(BiConsumer, Executor)</p>
</blockquote>
</li>
</ul>
<p>示例代码:</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln"> 1</span><span class="highlight-cl">    <span class="highlight-cm">/**
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 2</span><span class="highlight-cl"><span class="highlight-cm">     * 当 {@link CompletableFuture} 的计算结果完成，在同一线程中执行特定的 Action
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 3</span><span class="highlight-cl"><span class="highlight-cm">     * &lt;br&gt;
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 4</span><span class="highlight-cl"><span class="highlight-cm">     * &lt;font color="red"&gt;同一线程指与调用 {@link CompletableFuture#whenComplete} 的 {@link CompletableFuture} 实例任务执行的线程&lt;/font&gt;
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 5</span><span class="highlight-cl"><span class="highlight-cm">     *
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 6</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#whenComplete(BiConsumer)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 7</span><span class="highlight-cl"><span class="highlight-cm">     */</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 8</span><span class="highlight-cl">    <span class="highlight-nd">@Test</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 9</span><span class="highlight-cl">    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">test_process_result_with_sync</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">10</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">String</span><span class="highlight-o">&gt;</span> <span class="highlight-n">resultFutureOfMainThread</span> <span class="highlight-o">=</span>
</span></span><span class="highlight-line"><span class="highlight-ln">11</span><span class="highlight-cl">                <span class="highlight-c1">// 执行线程: ForkJoinPool.commonPool-worker-1
</span></span></span><span class="highlight-line"><span class="highlight-ln">12</span><span class="highlight-cl"><span class="highlight-c1"></span>                <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">13</span><span class="highlight-cl">                            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"base future end,Thread:%s\n"</span><span class="highlight-o">,</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">14</span><span class="highlight-cl">                            <span class="highlight-k">return</span> <span class="highlight-s">"whenComplete method"</span><span class="highlight-o">;</span>
</span></span><span class="highlight-line"><span class="highlight-ln">15</span><span class="highlight-cl">                        <span class="highlight-o">})</span>
</span></span><span class="highlight-line"><span class="highlight-ln">16</span><span class="highlight-cl">                        <span class="highlight-c1">// 执行线程: pool-1-thread-1
</span></span></span><span class="highlight-line"><span class="highlight-ln">17</span><span class="highlight-cl"><span class="highlight-c1"></span>                        <span class="highlight-o">.</span><span class="highlight-na">whenCompleteAsync</span><span class="highlight-o">(</span><span class="highlight-n">ACTION</span><span class="highlight-o">,</span> <span class="highlight-n">FIXED_THREAD_POOL</span><span class="highlight-o">)</span>
</span></span><span class="highlight-line"><span class="highlight-ln">18</span><span class="highlight-cl">                        <span class="highlight-c1">// 执行线程: pool-1-thread-1
</span></span></span><span class="highlight-line"><span class="highlight-ln">19</span><span class="highlight-cl"><span class="highlight-c1"></span>                        <span class="highlight-o">.</span><span class="highlight-na">whenComplete</span><span class="highlight-o">(</span><span class="highlight-n">ACTION</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">20</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">21</span><span class="highlight-cl">        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-n">resultFutureOfMainThread</span><span class="highlight-o">.</span><span class="highlight-na">join</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">22</span><span class="highlight-cl">    <span class="highlight-o">}</span>
</span></span></code></pre>
<p>执行结果：</p>
<blockquote>
<p>base future end,Thread:ForkJoinPool.commonPool-worker-1<br>
执行线程: pool-1-thread-1, 执行方法: whenComplete method , 发生异常: [null]<br>
执行线程: pool-1-thread-1, 执行方法: whenComplete method , 发生异常: [null]<br>
whenComplete method</p>
</blockquote>
<h4 id="改变计算结果的对象类型-----">改变计算结果的对象类型，<code>CompletableFuture&lt;T&gt;</code> -&gt; <code>CompletableFuture&lt;U&gt;</code></h4>
<p>当原来的 CompletableFuture 计算完后，将结果传递给函数 fn，将 fn 的结果作为新的 CompletableFuture 计算结果</p>
<ul>
<li>
<p>无法处理异常</p>
<ul>
<li>CompletableFuture#thenApply(Function)</li>
<li>CompletableFuture#thenApplyAsync(Function)</li>
<li>CompletableFuture#thenApplyAsync(Function, Executor)</li>
</ul>
<p>示例代码：</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln"> 1</span><span class="highlight-cl">    <span class="highlight-cm">/**
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 2</span><span class="highlight-cl"><span class="highlight-cm">     * 当原来的 CompletableFuture 计算完后，将结果传递给函数fn，将fn的结果作为新的 CompletableFuture 计算结果
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 3</span><span class="highlight-cl"><span class="highlight-cm">     * &lt;br&gt;
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 4</span><span class="highlight-cl"><span class="highlight-cm">     * {@code CompletableFuture&lt;T&gt; } -&gt; {@code CompletableFuture&lt;U&gt;}
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 5</span><span class="highlight-cl"><span class="highlight-cm">     * &lt;br&gt;
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 6</span><span class="highlight-cl"><span class="highlight-cm">     * &lt;font color="red"&gt;
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 7</span><span class="highlight-cl"><span class="highlight-cm">     * 与 {@link CompletableFuture#handle(BiFunction)} 的区别:  {@link CompletableFuture#thenApply(Function)}
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 8</span><span class="highlight-cl"><span class="highlight-cm">     * 不处理异常,一旦发生异常会抛出
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 9</span><span class="highlight-cl"><span class="highlight-cm">     * &lt;/font&gt;
</span></span></span><span class="highlight-line"><span class="highlight-ln">10</span><span class="highlight-cl"><span class="highlight-cm">     *
</span></span></span><span class="highlight-line"><span class="highlight-ln">11</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#thenApply(Function)
</span></span></span><span class="highlight-line"><span class="highlight-ln">12</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#thenApplyAsync(Function)
</span></span></span><span class="highlight-line"><span class="highlight-ln">13</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#thenApplyAsync(Function, Executor)
</span></span></span><span class="highlight-line"><span class="highlight-ln">14</span><span class="highlight-cl"><span class="highlight-cm">     */</span>
</span></span><span class="highlight-line"><span class="highlight-ln">15</span><span class="highlight-cl">    <span class="highlight-nd">@Test</span>
</span></span><span class="highlight-line"><span class="highlight-ln">16</span><span class="highlight-cl">    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">test_thenApply_method</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">17</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">Integer</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">completedFuture</span><span class="highlight-o">(</span><span class="highlight-s">"我是字符串"</span><span class="highlight-o">)</span>
</span></span><span class="highlight-line"><span class="highlight-ln">18</span><span class="highlight-cl">                <span class="highlight-o">.</span><span class="highlight-na">thenApply</span><span class="highlight-o">(</span><span class="highlight-n">v</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">19</span><span class="highlight-cl">                    <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"原始计算结果: %s,当前线程: %s \n"</span><span class="highlight-o">,</span> <span class="highlight-n">v</span><span class="highlight-o">,</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">20</span><span class="highlight-cl">                    <span class="highlight-k">return</span> <span class="highlight-n">v</span><span class="highlight-o">.</span><span class="highlight-na">length</span><span class="highlight-o">();</span>
</span></span><span class="highlight-line"><span class="highlight-ln">21</span><span class="highlight-cl">                <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">22</span><span class="highlight-cl">        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"最终 CompletableFuture 结果: %s \n"</span><span class="highlight-o">,</span> <span class="highlight-n">future</span><span class="highlight-o">.</span><span class="highlight-na">join</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">23</span><span class="highlight-cl">    <span class="highlight-o">}</span>
</span></span></code></pre>
<p>执行结果：</p>
<blockquote>
<p>原始计算结果: 我是字符串,当前线程: main<br>
最终 CompletableFuture 结果: 5</p>
</blockquote>
</li>
<li>
<p>能处理异常</p>
<ul>
<li>CompletableFuture#handle(BiFunction)</li>
<li>CompletableFuture#handleAsync(BiFunction)</li>
<li>CompletableFuture#handleAsync(BiFunction, Executor)</li>
</ul>
<p>示例代码：</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln"> 1</span><span class="highlight-cl">    <span class="highlight-cm">/**
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 2</span><span class="highlight-cl"><span class="highlight-cm">     * {@link CompletableFuture#handle} 处理异常的实例代码
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 3</span><span class="highlight-cl"><span class="highlight-cm">     */</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 4</span><span class="highlight-cl">    <span class="highlight-nd">@Test</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 5</span><span class="highlight-cl">    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">test_handle_process_exception</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 6</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">String</span><span class="highlight-o">&gt;</span> <span class="highlight-n">baseFuture</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 7</span><span class="highlight-cl">            <span class="highlight-k">if</span> <span class="highlight-o">(</span><span class="highlight-kc">true</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 8</span><span class="highlight-cl">                <span class="highlight-k">throw</span> <span class="highlight-k">new</span> <span class="highlight-n">RuntimeException</span><span class="highlight-o">(</span><span class="highlight-s">"我故意的,嘻嘻"</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 9</span><span class="highlight-cl">            <span class="highlight-o">}</span>
</span></span><span class="highlight-line"><span class="highlight-ln">10</span><span class="highlight-cl">            <span class="highlight-k">return</span> <span class="highlight-s">"我是字符串"</span><span class="highlight-o">;</span>
</span></span><span class="highlight-line"><span class="highlight-ln">11</span><span class="highlight-cl">        <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">12</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">13</span><span class="highlight-cl">        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"handle : "</span> <span class="highlight-o">+</span>
</span></span><span class="highlight-line"><span class="highlight-ln">14</span><span class="highlight-cl">                <span class="highlight-n">baseFuture</span><span class="highlight-o">.</span><span class="highlight-na">handle</span><span class="highlight-o">((</span><span class="highlight-n">v</span><span class="highlight-o">,</span> <span class="highlight-n">e</span><span class="highlight-o">)</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">15</span><span class="highlight-cl">                            <span class="highlight-k">if</span> <span class="highlight-o">(</span><span class="highlight-n">Objects</span><span class="highlight-o">.</span><span class="highlight-na">nonNull</span><span class="highlight-o">(</span><span class="highlight-n">e</span><span class="highlight-o">))</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">16</span><span class="highlight-cl">                                <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"handle 基础 Future 计算发生异常: [%s], 执行线程: [%s] \n"</span><span class="highlight-o">,</span>
</span></span><span class="highlight-line"><span class="highlight-ln">17</span><span class="highlight-cl">                                        <span class="highlight-n">e</span><span class="highlight-o">.</span><span class="highlight-na">getMessage</span><span class="highlight-o">(),</span>
</span></span><span class="highlight-line"><span class="highlight-ln">18</span><span class="highlight-cl">                                        <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">19</span><span class="highlight-cl">                                <span class="highlight-k">return</span> <span class="highlight-n">e</span><span class="highlight-o">.</span><span class="highlight-na">getMessage</span><span class="highlight-o">().</span><span class="highlight-na">length</span><span class="highlight-o">();</span>
</span></span><span class="highlight-line"><span class="highlight-ln">20</span><span class="highlight-cl">                            <span class="highlight-o">}</span>
</span></span><span class="highlight-line"><span class="highlight-ln">21</span><span class="highlight-cl">                            <span class="highlight-k">return</span> <span class="highlight-n">v</span><span class="highlight-o">.</span><span class="highlight-na">length</span><span class="highlight-o">();</span>
</span></span><span class="highlight-line"><span class="highlight-ln">22</span><span class="highlight-cl">                        <span class="highlight-o">})</span>
</span></span><span class="highlight-line"><span class="highlight-ln">23</span><span class="highlight-cl">                        <span class="highlight-o">.</span><span class="highlight-na">join</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">24</span><span class="highlight-cl">    <span class="highlight-o">}</span>
</span></span></code></pre>
<p>执行结果：</p>
<blockquote>
<p>handle 基础 Future 计算发生异常: [java.lang.RuntimeException: 我故意的,嘻嘻], 执行线程: [ForkJoinPool.commonPool-worker-1]<br>
handle : 35</p>
</blockquote>
</li>
</ul>
<p><code>CompletableFuture#handle</code> 对比 <code>CompletableFuture#thenApply</code>：</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln"> 1</span><span class="highlight-cl">    <span class="highlight-cm">/**
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 2</span><span class="highlight-cl"><span class="highlight-cm">     * 对比 {@link CompletableFuture#thenApply} 和 {@link CompletableFuture#handle} 处理异常的差异
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 3</span><span class="highlight-cl"><span class="highlight-cm">     */</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 4</span><span class="highlight-cl">    <span class="highlight-nd">@Test</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 5</span><span class="highlight-cl">    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">test_thenApply_and_handle_method_when_occur_exception</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 6</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">String</span><span class="highlight-o">&gt;</span> <span class="highlight-n">baseFuture</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 7</span><span class="highlight-cl">            <span class="highlight-k">if</span> <span class="highlight-o">(</span><span class="highlight-kc">true</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 8</span><span class="highlight-cl">                <span class="highlight-k">throw</span> <span class="highlight-k">new</span> <span class="highlight-n">RuntimeException</span><span class="highlight-o">(</span><span class="highlight-s">"我故意的,嘻嘻"</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 9</span><span class="highlight-cl">            <span class="highlight-o">}</span>
</span></span><span class="highlight-line"><span class="highlight-ln">10</span><span class="highlight-cl">            <span class="highlight-k">return</span> <span class="highlight-s">"我是字符串"</span><span class="highlight-o">;</span>
</span></span><span class="highlight-line"><span class="highlight-ln">11</span><span class="highlight-cl">        <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">12</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">13</span><span class="highlight-cl">        <span class="highlight-k">try</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">14</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"thenApply : "</span> <span class="highlight-o">+</span> <span class="highlight-n">baseFuture</span><span class="highlight-o">.</span><span class="highlight-na">thenApply</span><span class="highlight-o">(</span><span class="highlight-n">String</span><span class="highlight-o">::</span><span class="highlight-n">length</span><span class="highlight-o">).</span><span class="highlight-na">join</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">15</span><span class="highlight-cl">        <span class="highlight-o">}</span> <span class="highlight-k">catch</span> <span class="highlight-o">(</span><span class="highlight-n">Exception</span> <span class="highlight-n">e</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">16</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"thenApply 基础 Future 计算发生异常 :"</span> <span class="highlight-o">+</span> <span class="highlight-n">e</span><span class="highlight-o">.</span><span class="highlight-na">getMessage</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">17</span><span class="highlight-cl">        <span class="highlight-o">}</span>
</span></span><span class="highlight-line"><span class="highlight-ln">18</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">19</span><span class="highlight-cl">        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"handle : "</span> <span class="highlight-o">+</span>
</span></span><span class="highlight-line"><span class="highlight-ln">20</span><span class="highlight-cl">                <span class="highlight-n">baseFuture</span><span class="highlight-o">.</span><span class="highlight-na">handle</span><span class="highlight-o">((</span><span class="highlight-n">v</span><span class="highlight-o">,</span> <span class="highlight-n">e</span><span class="highlight-o">)</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">21</span><span class="highlight-cl">                            <span class="highlight-k">if</span> <span class="highlight-o">(</span><span class="highlight-n">Objects</span><span class="highlight-o">.</span><span class="highlight-na">nonNull</span><span class="highlight-o">(</span><span class="highlight-n">e</span><span class="highlight-o">))</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">22</span><span class="highlight-cl">                                <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"handle 基础 Future 计算发生异常: "</span> <span class="highlight-o">+</span> <span class="highlight-n">e</span><span class="highlight-o">.</span><span class="highlight-na">getMessage</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">23</span><span class="highlight-cl">                                <span class="highlight-k">return</span> <span class="highlight-n">e</span><span class="highlight-o">.</span><span class="highlight-na">getMessage</span><span class="highlight-o">().</span><span class="highlight-na">length</span><span class="highlight-o">();</span>
</span></span><span class="highlight-line"><span class="highlight-ln">24</span><span class="highlight-cl">                            <span class="highlight-o">}</span>
</span></span><span class="highlight-line"><span class="highlight-ln">25</span><span class="highlight-cl">                            <span class="highlight-k">return</span> <span class="highlight-n">v</span><span class="highlight-o">.</span><span class="highlight-na">length</span><span class="highlight-o">();</span>
</span></span><span class="highlight-line"><span class="highlight-ln">26</span><span class="highlight-cl">                        <span class="highlight-o">})</span>
</span></span><span class="highlight-line"><span class="highlight-ln">27</span><span class="highlight-cl">                        <span class="highlight-o">.</span><span class="highlight-na">join</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">28</span><span class="highlight-cl">    <span class="highlight-o">}</span>
</span></span></code></pre>
<p>执行结果：</p>
<blockquote>
<p>thenApply 基础 Future 计算发生异常 :java.lang.RuntimeException: 我故意的,嘻嘻<br>
handle 基础 Future 计算发生异常: java.lang.RuntimeException: 我故意的,嘻嘻<br>
handle : 35</p>
</blockquote>
<p>由执行结果可知，<code>thenApply</code> 方法并无处理异常的能力，而 <code>handle</code> 确能够处理异常，保证结果正常返回。</p>
<h4 id="消费计算结果-----">消费计算结果，<code>CompletableFuture&lt;T&gt;</code> -&gt; <code>CompletableFuture&lt;Void&gt;</code></h4>
<ul>
<li>
<p>有入参的（把计算结果作为方法入参）</p>
<ul>
<li>CompletableFuture#thenAccept(Consumer)</li>
<li>CompletableFuture#thenAcceptAsync(Consumer)</li>
<li>CompletableFuture#thenAcceptAsync(Consumer, Executor)</li>
</ul>
<p>示例代码：</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln"> 1</span><span class="highlight-cl">    <span class="highlight-cm">/**
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 2</span><span class="highlight-cl"><span class="highlight-cm">     * 只对结果执行 Action ,而不返回新地计算值，因此计算值为 {@link Void}
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 3</span><span class="highlight-cl"><span class="highlight-cm">     *
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 4</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#thenAccept(Consumer)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 5</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#thenAcceptAsync(Consumer)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 6</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#thenAcceptAsync(Consumer, Executor)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 7</span><span class="highlight-cl"><span class="highlight-cm">     */</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 8</span><span class="highlight-cl">    <span class="highlight-nd">@Test</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 9</span><span class="highlight-cl">    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">test_thenAccept_method</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">10</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">Void</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">completedFuture</span><span class="highlight-o">(</span><span class="highlight-s">"我是字符串"</span><span class="highlight-o">)</span>
</span></span><span class="highlight-line"><span class="highlight-ln">11</span><span class="highlight-cl">                <span class="highlight-o">.</span><span class="highlight-na">thenAccept</span><span class="highlight-o">(</span><span class="highlight-n">v</span> <span class="highlight-o">-&gt;</span> <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"结果输出: [%s], 执行线程: [%s]"</span><span class="highlight-o">,</span>
</span></span><span class="highlight-line"><span class="highlight-ln">12</span><span class="highlight-cl">                        <span class="highlight-n">v</span><span class="highlight-o">.</span><span class="highlight-na">concat</span><span class="highlight-o">(</span><span class="highlight-s">",嘻嘻"</span><span class="highlight-o">),</span>
</span></span><span class="highlight-line"><span class="highlight-ln">13</span><span class="highlight-cl">                        <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">()));</span>
</span></span><span class="highlight-line"><span class="highlight-ln">14</span><span class="highlight-cl">    <span class="highlight-o">}</span>
</span></span></code></pre>
<p>执行结果：</p>
<blockquote>
<p>结果输出: [我是字符串,嘻嘻], 执行线程: [main]</p>
</blockquote>
</li>
<li>
<p>无入参的</p>
<ul>
<li>CompletableFuture#thenRun(Runnable)</li>
<li>CompletableFuture#thenRunAsync(Runnable)</li>
<li>CompletableFuture#thenRunAsync(Runnable, Executor)</li>
</ul>
<p>示例代码：</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln"> 1</span><span class="highlight-cl">    <span class="highlight-cm">/**
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 2</span><span class="highlight-cl"><span class="highlight-cm">     * 当计算完成的时候会执行一个 {@link Runnable} ,与 {@link CompletableFuture#thenAccept} 不同，{@link Runnable} 并不使用
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 3</span><span class="highlight-cl"><span class="highlight-cm">     * {@link CompletableFuture} 计算的结果
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 4</span><span class="highlight-cl"><span class="highlight-cm">     *
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 5</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#thenRun(Runnable)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 6</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#thenRunAsync(Runnable)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 7</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#thenRunAsync(Runnable, Executor)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 8</span><span class="highlight-cl"><span class="highlight-cm">     */</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 9</span><span class="highlight-cl">    <span class="highlight-nd">@Test</span>
</span></span><span class="highlight-line"><span class="highlight-ln">10</span><span class="highlight-cl">    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">test_thenRun_method</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">11</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">Void</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">completedFuture</span><span class="highlight-o">(</span><span class="highlight-s">"我是字符串"</span><span class="highlight-o">)</span>
</span></span><span class="highlight-line"><span class="highlight-ln">12</span><span class="highlight-cl">                <span class="highlight-o">.</span><span class="highlight-na">thenRunAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"thenRunAsync 计算，执行线程: [%s]"</span><span class="highlight-o">,</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">()));</span>
</span></span><span class="highlight-line"><span class="highlight-ln">13</span><span class="highlight-cl">    <span class="highlight-o">}</span>
</span></span></code></pre>
<p>执行结果：</p>
<blockquote>
<p>thenRunAsync 计算，执行线程: [ForkJoinPool.commonPool-worker-1]</p>
</blockquote>
</li>
</ul>
<h4 id="当两个CompletionStage都正常完成计算的时候-执行提供的-Active">当两个 CompletionStage 都正常完成计算的时候，执行提供的 Active</h4>
<ul>
<li>
<p>有入参的（两个 CompletionStage 的计算结果作为入参）</p>
<ul>
<li>CompletableFuture#thenAcceptBoth(CompletionStage, BiConsumer)</li>
<li>CompletableFuture#thenAcceptBothAsync(CompletionStage, BiConsumer)</li>
<li>CompletableFuture#thenAcceptBothAsync(CompletionStage, BiConsumer, Executor)</li>
</ul>
<p>示例代码：</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln"> 1</span><span class="highlight-cl">   <span class="highlight-cm">/**
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 2</span><span class="highlight-cl"><span class="highlight-cm">     * 当两个 {@link CompletionStage} 都正常完成计算的时候，就会执行提供的 {@link BiConsumer} ，它用来组合另外一个异步的结果
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 3</span><span class="highlight-cl"><span class="highlight-cm">     *
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 4</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#thenAcceptBoth(CompletionStage, BiConsumer)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 5</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#thenAcceptBothAsync(CompletionStage, BiConsumer)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 6</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#thenAcceptBothAsync(CompletionStage, BiConsumer, Executor)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 7</span><span class="highlight-cl"><span class="highlight-cm">     */</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 8</span><span class="highlight-cl">    <span class="highlight-nd">@Test</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 9</span><span class="highlight-cl">    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">test_thenAcceptBoth_method</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">10</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">String</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future_01</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">11</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"future_01 执行线程："</span> <span class="highlight-o">+</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">12</span><span class="highlight-cl">            <span class="highlight-k">return</span> <span class="highlight-s">"你好,"</span><span class="highlight-o">;</span>
</span></span><span class="highlight-line"><span class="highlight-ln">13</span><span class="highlight-cl">        <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">14</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">String</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future_02</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">15</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"future_02 执行线程："</span> <span class="highlight-o">+</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">16</span><span class="highlight-cl">            <span class="highlight-k">return</span> <span class="highlight-s">"java 8"</span><span class="highlight-o">;</span>
</span></span><span class="highlight-line"><span class="highlight-ln">17</span><span class="highlight-cl">        <span class="highlight-o">},</span> <span class="highlight-n">FIXED_THREAD_POOL</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">18</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">19</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">Void</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future</span> <span class="highlight-o">=</span> <span class="highlight-n">future_01</span><span class="highlight-o">.</span><span class="highlight-na">thenAcceptBoth</span><span class="highlight-o">(</span><span class="highlight-n">future_02</span><span class="highlight-o">,</span>
</span></span><span class="highlight-line"><span class="highlight-ln">20</span><span class="highlight-cl">                <span class="highlight-o">(</span><span class="highlight-n">future_01_value</span><span class="highlight-o">,</span> <span class="highlight-n">future_02_value</span><span class="highlight-o">)</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">21</span><span class="highlight-cl">                    <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"future_01 是否执行完毕: %s, future_02 是否执行完毕: %s \n"</span><span class="highlight-o">,</span>
</span></span><span class="highlight-line"><span class="highlight-ln">22</span><span class="highlight-cl">                            <span class="highlight-n">future_01</span><span class="highlight-o">.</span><span class="highlight-na">isDone</span><span class="highlight-o">(),</span>
</span></span><span class="highlight-line"><span class="highlight-ln">23</span><span class="highlight-cl">                            <span class="highlight-n">future_02</span><span class="highlight-o">.</span><span class="highlight-na">isDone</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">24</span><span class="highlight-cl">                    <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"执行线程：%s, 结果：%s \n"</span><span class="highlight-o">,</span>
</span></span><span class="highlight-line"><span class="highlight-ln">25</span><span class="highlight-cl">                            <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">(),</span>
</span></span><span class="highlight-line"><span class="highlight-ln">26</span><span class="highlight-cl">                            <span class="highlight-n">future_01_value</span><span class="highlight-o">.</span><span class="highlight-na">concat</span><span class="highlight-o">(</span><span class="highlight-n">future_02_value</span><span class="highlight-o">));</span>
</span></span><span class="highlight-line"><span class="highlight-ln">27</span><span class="highlight-cl">                <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">28</span><span class="highlight-cl">    <span class="highlight-o">}</span>
</span></span></code></pre>
<p>执行结果：</p>
<blockquote>
<p>future_01 执行线程：ForkJoinPool.commonPool-worker-1<br>
future_02 执行线程：pool-1-thread-1<br>
future_01 是否执行完毕: true, future_02 是否执行完毕: true<br>
执行线程：main, 结果：你好,java 8</p>
</blockquote>
<p><strong>由执行结果可知：</strong></p>
<ol>
<li>thenAcceptBoth 方法需要等待依赖的两个 CompletionStage 均执行完毕才会执行</li>
<li>thenAcceptBoth 方法并非使用 future_01 的执行线程执行，而是使用 main 线程执行</li>
</ol>
</li>
<li>
<p>无入参的</p>
<ul>
<li>CompletableFuture#runAfterBoth(CompletionStage, Runnable)</li>
<li>CompletableFuture#runAfterBothAsync(CompletionStage, Runnable)</li>
<li>CompletableFuture#runAfterBothAsync(CompletionStage, Runnable, Executor)</li>
</ul>
<p>示例代码：</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln"> 1</span><span class="highlight-cl">    <span class="highlight-cm">/**
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 2</span><span class="highlight-cl"><span class="highlight-cm">     * 当两个 {@link CompletionStage} 都正常完成计算的时候,执行一个 {@link Runnable}，这个 {@link Runnable} 并不使用计算的结果
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 3</span><span class="highlight-cl"><span class="highlight-cm">     *
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 4</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#runAfterBoth(CompletionStage, Runnable)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 5</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#runAfterBothAsync(CompletionStage, Runnable)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 6</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#runAfterBothAsync(CompletionStage, Runnable, Executor)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 7</span><span class="highlight-cl"><span class="highlight-cm">     */</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 8</span><span class="highlight-cl">    <span class="highlight-nd">@Test</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 9</span><span class="highlight-cl">    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">test_runAfterBoth_method</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">10</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">String</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future_01</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">11</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"future_01 计算,执行线程: "</span> <span class="highlight-o">+</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">12</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">13</span><span class="highlight-cl">            <span class="highlight-k">try</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">14</span><span class="highlight-cl">                <span class="highlight-n">TimeUnit</span><span class="highlight-o">.</span><span class="highlight-na">SECONDS</span><span class="highlight-o">.</span><span class="highlight-na">sleep</span><span class="highlight-o">(</span><span class="highlight-n">10</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">15</span><span class="highlight-cl">            <span class="highlight-o">}</span> <span class="highlight-k">catch</span> <span class="highlight-o">(</span><span class="highlight-n">InterruptedException</span> <span class="highlight-n">e</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">16</span><span class="highlight-cl">                <span class="highlight-k">throw</span> <span class="highlight-k">new</span> <span class="highlight-n">RuntimeException</span><span class="highlight-o">(</span><span class="highlight-n">e</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">17</span><span class="highlight-cl">            <span class="highlight-o">}</span>
</span></span><span class="highlight-line"><span class="highlight-ln">18</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">19</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"future_01 计算完毕"</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">20</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">21</span><span class="highlight-cl">            <span class="highlight-k">return</span> <span class="highlight-s">"future_01 计算"</span><span class="highlight-o">;</span>
</span></span><span class="highlight-line"><span class="highlight-ln">22</span><span class="highlight-cl">        <span class="highlight-o">},</span> <span class="highlight-n">FIXED_THREAD_POOL</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">23</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">String</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future_02</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">24</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"future_02 计算, 执行线程: "</span> <span class="highlight-o">+</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">25</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">26</span><span class="highlight-cl">            <span class="highlight-k">try</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">27</span><span class="highlight-cl">                <span class="highlight-n">TimeUnit</span><span class="highlight-o">.</span><span class="highlight-na">SECONDS</span><span class="highlight-o">.</span><span class="highlight-na">sleep</span><span class="highlight-o">(</span><span class="highlight-n">5</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">28</span><span class="highlight-cl">            <span class="highlight-o">}</span> <span class="highlight-k">catch</span> <span class="highlight-o">(</span><span class="highlight-n">InterruptedException</span> <span class="highlight-n">e</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">29</span><span class="highlight-cl">                <span class="highlight-k">throw</span> <span class="highlight-k">new</span> <span class="highlight-n">RuntimeException</span><span class="highlight-o">(</span><span class="highlight-n">e</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">30</span><span class="highlight-cl">            <span class="highlight-o">}</span>
</span></span><span class="highlight-line"><span class="highlight-ln">31</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">32</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"future_02 计算完毕"</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">33</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">34</span><span class="highlight-cl">            <span class="highlight-k">return</span> <span class="highlight-s">"future_02 计算"</span><span class="highlight-o">;</span>
</span></span><span class="highlight-line"><span class="highlight-ln">35</span><span class="highlight-cl">        <span class="highlight-o">},</span> <span class="highlight-n">FIXED_THREAD_POOL</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">36</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">37</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">Void</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future</span> <span class="highlight-o">=</span> <span class="highlight-n">future_01</span><span class="highlight-o">.</span><span class="highlight-na">runAfterBoth</span><span class="highlight-o">(</span><span class="highlight-n">future_02</span><span class="highlight-o">,</span>
</span></span><span class="highlight-line"><span class="highlight-ln">38</span><span class="highlight-cl">                <span class="highlight-o">()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">39</span><span class="highlight-cl">                    <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"future_01 执行完毕: %s, future_02 执行完毕: %s \n"</span><span class="highlight-o">,</span>
</span></span><span class="highlight-line"><span class="highlight-ln">40</span><span class="highlight-cl">                            <span class="highlight-n">future_01</span><span class="highlight-o">.</span><span class="highlight-na">isDone</span><span class="highlight-o">(),</span>
</span></span><span class="highlight-line"><span class="highlight-ln">41</span><span class="highlight-cl">                            <span class="highlight-n">future_02</span><span class="highlight-o">.</span><span class="highlight-na">isDone</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">42</span><span class="highlight-cl">                    <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"runAfterBoth 执行线程"</span> <span class="highlight-o">+</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">43</span><span class="highlight-cl">                <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">44</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">45</span><span class="highlight-cl">        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"等待 future 计算完毕 ..."</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">46</span><span class="highlight-cl">        <span class="highlight-n">future</span><span class="highlight-o">.</span><span class="highlight-na">join</span><span class="highlight-o">();</span>
</span></span><span class="highlight-line"><span class="highlight-ln">47</span><span class="highlight-cl">    <span class="highlight-o">}</span>
</span></span></code></pre>
<p>执行结果：</p>
<blockquote>
<p>future_01 计算,执行线程: pool-1-thread-1<br>
等待 future 计算完毕 ...<br>
future_01 计算完毕<br>
future_02 计算, 执行线程: pool-1-thread-1<br>
future_02 计算完毕<br>
future_01 执行完毕: true, future_02 执行完毕: true<br>
runAfterBoth 执行线程 pool-1-thread-1</p>
</blockquote>
<p><strong>由结果分析：</strong></p>
<ol>
<li>
<p>runAfterBoth 方法需要等待依赖的两个 CompletionStage 均执行完毕才会执行</p>
</li>
<li>
<p>从表象来看 runAfterBoth 执行使用的线程和 future_01 是同一个，上述例子比较特殊，我们可以修改下示例代码</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln">1</span><span class="highlight-cl"><span class="highlight-c1">// 不再指定执行线程池
</span></span></span><span class="highlight-line"><span class="highlight-ln">2</span><span class="highlight-cl"><span class="highlight-c1"></span><span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">String</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future_01</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">3</span><span class="highlight-cl">    <span class="highlight-o">...</span>
</span></span><span class="highlight-line"><span class="highlight-ln">4</span><span class="highlight-cl"><span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">5</span><span class="highlight-cl"><span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">String</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future_02</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">6</span><span class="highlight-cl">    <span class="highlight-o">...</span>
</span></span><span class="highlight-line"><span class="highlight-ln">7</span><span class="highlight-cl"><span class="highlight-o">});</span>
</span></span></code></pre>
<p>再次运行，结果如下：</p>
<blockquote>
<p>future_01 计算,执行线程: ForkJoinPool.commonPool-worker-1<br>
future_02 计算, 执行线程: ForkJoinPool.commonPool-worker-2<br>
等待 future 计算完毕 ...<br>
future_02 计算完毕<br>
future_01 计算完毕<br>
future_01 执行完毕: true, future_02 执行完毕: true<br>
runAfterBoth 执行线程 ForkJoinPool.commonPool-worker-1</p>
</blockquote>
<p>由此，基本可以确定 <strong>runAfterBoth 执行使用的线程和 future_01 是同一个</strong></p>
</li>
</ol>
</li>
</ul>
<h4 id="当两个中任意一个-CompletionStage-完成的时候-action这个消费者就会被执行">当两个中任意一个 <em>CompletionStage</em> 完成的时候，action 这个消费者就会被执行</h4>
<ul>
<li>
<p>有返回类型 <em>CompletableFuture&lt;U&gt;</em></p>
<blockquote>
<p>CompletableFuture#applyToEither(CompletionStage, Function)</p>
<p>CompletableFuture#applyToEitherAsync(CompletionStage, Function)</p>
<p>CompletableFuture#applyToEitherAsync(CompletionStage, Function, Executor)</p>
</blockquote>
<p>示例代码：</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln"> 1</span><span class="highlight-cl">    <span class="highlight-cm">/**
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 2</span><span class="highlight-cl"><span class="highlight-cm">     * 当任意一个 CompletionStage 完成的时候，action这个消费者就会被执行。这个方法返回 CompletableFuture&lt;U&gt;
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 3</span><span class="highlight-cl"><span class="highlight-cm">     *
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 4</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#applyToEither(CompletionStage, Function)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 5</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#applyToEitherAsync(CompletionStage, Function)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 6</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#applyToEitherAsync(CompletionStage, Function, Executor)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 7</span><span class="highlight-cl"><span class="highlight-cm">     */</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 8</span><span class="highlight-cl">    <span class="highlight-nd">@Test</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 9</span><span class="highlight-cl">    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">test_applyToEither_method</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">10</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">Integer</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future_01</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">11</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"future_01 计算开始, 执行线程: %s\n"</span><span class="highlight-o">,</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">12</span><span class="highlight-cl">            <span class="highlight-k">try</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">13</span><span class="highlight-cl">                <span class="highlight-n">TimeUnit</span><span class="highlight-o">.</span><span class="highlight-na">SECONDS</span><span class="highlight-o">.</span><span class="highlight-na">sleep</span><span class="highlight-o">(</span><span class="highlight-n">10</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">14</span><span class="highlight-cl">            <span class="highlight-o">}</span> <span class="highlight-k">catch</span> <span class="highlight-o">(</span><span class="highlight-n">InterruptedException</span> <span class="highlight-n">e</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">15</span><span class="highlight-cl">                <span class="highlight-k">throw</span> <span class="highlight-k">new</span> <span class="highlight-n">RuntimeException</span><span class="highlight-o">(</span><span class="highlight-n">e</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">16</span><span class="highlight-cl">            <span class="highlight-o">}</span>
</span></span><span class="highlight-line"><span class="highlight-ln">17</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"future_01 计算完毕"</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">18</span><span class="highlight-cl">            <span class="highlight-k">return</span> <span class="highlight-n">100</span><span class="highlight-o">;</span>
</span></span><span class="highlight-line"><span class="highlight-ln">19</span><span class="highlight-cl">        <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">20</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">21</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">Integer</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future_02</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">22</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"future_02 计算完毕, 执行线程: %s\n"</span><span class="highlight-o">,</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">23</span><span class="highlight-cl">            <span class="highlight-k">return</span> <span class="highlight-n">200</span><span class="highlight-o">;</span>
</span></span><span class="highlight-line"><span class="highlight-ln">24</span><span class="highlight-cl">        <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">25</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">26</span><span class="highlight-cl">        <span class="highlight-c1">// applyToEither 使用 main 线程执行,所以 future_01 未计算完毕也可以执行
</span></span></span><span class="highlight-line"><span class="highlight-ln">27</span><span class="highlight-cl"><span class="highlight-c1"></span>        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">String</span><span class="highlight-o">&gt;</span> <span class="highlight-n">resultFuture</span> <span class="highlight-o">=</span> <span class="highlight-n">future_01</span><span class="highlight-o">.</span><span class="highlight-na">applyToEither</span><span class="highlight-o">(</span><span class="highlight-n">future_02</span><span class="highlight-o">,</span> <span class="highlight-n">integer</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">28</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"future_01 是否计算完毕: %s, future_02 是否计算完毕: %s, 结果: %s, 执行线程: %s\n"</span><span class="highlight-o">,</span>
</span></span><span class="highlight-line"><span class="highlight-ln">29</span><span class="highlight-cl">                    <span class="highlight-n">future_01</span><span class="highlight-o">.</span><span class="highlight-na">isDone</span><span class="highlight-o">(),</span>
</span></span><span class="highlight-line"><span class="highlight-ln">30</span><span class="highlight-cl">                    <span class="highlight-n">future_02</span><span class="highlight-o">.</span><span class="highlight-na">isDone</span><span class="highlight-o">(),</span>
</span></span><span class="highlight-line"><span class="highlight-ln">31</span><span class="highlight-cl">                    <span class="highlight-n">integer</span><span class="highlight-o">.</span><span class="highlight-na">toString</span><span class="highlight-o">(),</span>
</span></span><span class="highlight-line"><span class="highlight-ln">32</span><span class="highlight-cl">                    <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">33</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">34</span><span class="highlight-cl">            <span class="highlight-k">return</span> <span class="highlight-n">integer</span><span class="highlight-o">.</span><span class="highlight-na">toString</span><span class="highlight-o">();</span>
</span></span><span class="highlight-line"><span class="highlight-ln">35</span><span class="highlight-cl">        <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">36</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">37</span><span class="highlight-cl">        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"resultFuture 计算结果: "</span> <span class="highlight-o">+</span> <span class="highlight-n">resultFuture</span><span class="highlight-o">.</span><span class="highlight-na">join</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">38</span><span class="highlight-cl">    <span class="highlight-o">}</span>
</span></span></code></pre>
<p>执行结果：</p>
<blockquote>
<p>future_01 计算开始, 执行线程: ForkJoinPool.commonPool-worker-1<br>
future_02 计算完毕, 执行线程: ForkJoinPool.commonPool-worker-2<br>
future_01 是否计算完毕: false, future_02 是否计算完毕: true, 结果: 200, 执行线程: main<br>
resultFuture 计算结果: 200</p>
</blockquote>
</li>
<li>
<p>无返回类型 <em>CompletableFuture&lt;U&gt;</em></p>
<blockquote>
<p>CompletableFuture#acceptEither(CompletionStage, Consumer)</p>
<p>CompletableFuture#acceptEitherAsync(CompletionStage, Consumer)</p>
<p>CompletableFuture#acceptEitherAsync(CompletionStage, Consumer, Executor)</p>
</blockquote>
<p>示例代码：</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln"> 1</span><span class="highlight-cl">    <span class="highlight-cm">/**
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 2</span><span class="highlight-cl"><span class="highlight-cm">     * 当任意一个 CompletionStage 完成的时候，action这个消费者就会被执行。这个方法返回 CompletableFuture&lt;Void&gt;
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 3</span><span class="highlight-cl"><span class="highlight-cm">     *
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 4</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#acceptEither(CompletionStage, Consumer)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 5</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#acceptEitherAsync(CompletionStage, Consumer)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 6</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#acceptEitherAsync(CompletionStage, Consumer, Executor)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 7</span><span class="highlight-cl"><span class="highlight-cm">     */</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 8</span><span class="highlight-cl">    <span class="highlight-nd">@Test</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 9</span><span class="highlight-cl">    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">test_acceptEither_method</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">10</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">Integer</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future_01</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">11</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"future_01 计算开始, 执行线程: %s\n"</span><span class="highlight-o">,</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">12</span><span class="highlight-cl">            <span class="highlight-k">try</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">13</span><span class="highlight-cl">                <span class="highlight-n">TimeUnit</span><span class="highlight-o">.</span><span class="highlight-na">SECONDS</span><span class="highlight-o">.</span><span class="highlight-na">sleep</span><span class="highlight-o">(</span><span class="highlight-n">10</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">14</span><span class="highlight-cl">            <span class="highlight-o">}</span> <span class="highlight-k">catch</span> <span class="highlight-o">(</span><span class="highlight-n">InterruptedException</span> <span class="highlight-n">e</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">15</span><span class="highlight-cl">                <span class="highlight-k">throw</span> <span class="highlight-k">new</span> <span class="highlight-n">RuntimeException</span><span class="highlight-o">(</span><span class="highlight-n">e</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">16</span><span class="highlight-cl">            <span class="highlight-o">}</span>
</span></span><span class="highlight-line"><span class="highlight-ln">17</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"future_01 计算完毕"</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">18</span><span class="highlight-cl">            <span class="highlight-k">return</span> <span class="highlight-n">100</span><span class="highlight-o">;</span>
</span></span><span class="highlight-line"><span class="highlight-ln">19</span><span class="highlight-cl">        <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">20</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">21</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">Integer</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future_02</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">22</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"future_02 计算完毕, 执行线程: %s\n"</span><span class="highlight-o">,</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">23</span><span class="highlight-cl">            <span class="highlight-k">return</span> <span class="highlight-n">200</span><span class="highlight-o">;</span>
</span></span><span class="highlight-line"><span class="highlight-ln">24</span><span class="highlight-cl">        <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">25</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">26</span><span class="highlight-cl">        <span class="highlight-c1">// acceptEither 使用 main 线程执行,所以 future_01 未计算完毕也可以执行
</span></span></span><span class="highlight-line"><span class="highlight-ln">27</span><span class="highlight-cl"><span class="highlight-c1"></span>        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">Void</span><span class="highlight-o">&gt;</span> <span class="highlight-n">resultFuture</span> <span class="highlight-o">=</span> <span class="highlight-n">future_01</span><span class="highlight-o">.</span><span class="highlight-na">acceptEither</span><span class="highlight-o">(</span><span class="highlight-n">future_02</span><span class="highlight-o">,</span> <span class="highlight-n">integer</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">28</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"future_01 是否计算完毕: %s, future_02 是否计算完毕: %s, 结果: %s, 执行线程: %s\n"</span><span class="highlight-o">,</span>
</span></span><span class="highlight-line"><span class="highlight-ln">29</span><span class="highlight-cl">                    <span class="highlight-n">future_01</span><span class="highlight-o">.</span><span class="highlight-na">isDone</span><span class="highlight-o">(),</span>
</span></span><span class="highlight-line"><span class="highlight-ln">30</span><span class="highlight-cl">                    <span class="highlight-n">future_02</span><span class="highlight-o">.</span><span class="highlight-na">isDone</span><span class="highlight-o">(),</span>
</span></span><span class="highlight-line"><span class="highlight-ln">31</span><span class="highlight-cl">                    <span class="highlight-n">integer</span><span class="highlight-o">.</span><span class="highlight-na">toString</span><span class="highlight-o">(),</span>
</span></span><span class="highlight-line"><span class="highlight-ln">32</span><span class="highlight-cl">                    <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">33</span><span class="highlight-cl">        <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">34</span><span class="highlight-cl">    <span class="highlight-o">}</span>
</span></span></code></pre>
<p>执行结果：</p>
<blockquote>
<p>future_01 计算开始, 执行线程: ForkJoinPool.commonPool-worker-1<br>
future_02 计算完毕, 执行线程: ForkJoinPool.commonPool-worker-2<br>
future_01 是否计算完毕: false, future_02 是否计算完毕: true, 结果: 200, 执行线程: main</p>
</blockquote>
</li>
</ul>
<h4 id="applyToEither-和-acceptEither-一定是非阻塞的么-"><em>applyToEither</em> 和 <em>acceptEither</em> 一定是非阻塞的么？</h4>
<p>由上面的示例代码执行结果可知，<em>applyToEither</em> 和 <em>acceptEither</em> 都是使用当前线程执行的，由于 <em>future_01</em> 和 <em>future_02</em> 都是在异步线程池中执行，所以不会出现阻塞的情况，但是如果我们认为的指定其都使用同一个线程执行呢，是否会出现阻塞情况？</p>
<p>示例代码：</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln"> 1</span><span class="highlight-cl">   <span class="highlight-kd">private</span> <span class="highlight-kd">static</span> <span class="highlight-kd">final</span> <span class="highlight-n">ExecutorService</span> <span class="highlight-n">FIXED_THREAD_POOL</span> <span class="highlight-o">=</span> <span class="highlight-n">Executors</span><span class="highlight-o">.</span><span class="highlight-na">newFixedThreadPool</span><span class="highlight-o">(</span><span class="highlight-n">1</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 2</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln"> 3</span><span class="highlight-cl">   <span class="highlight-cm">/**
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 4</span><span class="highlight-cl"><span class="highlight-cm">     * 通过处理,指定 applyToEitherAsync 的执行线程和  future_01 的线程一样,这种情况下就会导致 applyToEitherAsync 执行阻塞
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 5</span><span class="highlight-cl"><span class="highlight-cm">     */</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 6</span><span class="highlight-cl">    <span class="highlight-nd">@Test</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 7</span><span class="highlight-cl">    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">test_applyToEitherAsyncThread_isSameAs_future_01</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 8</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">Integer</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future_01</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 9</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"future_01 计算开始, 执行线程: %s\n"</span><span class="highlight-o">,</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">10</span><span class="highlight-cl">            <span class="highlight-k">try</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">11</span><span class="highlight-cl">                <span class="highlight-n">TimeUnit</span><span class="highlight-o">.</span><span class="highlight-na">SECONDS</span><span class="highlight-o">.</span><span class="highlight-na">sleep</span><span class="highlight-o">(</span><span class="highlight-n">10</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">12</span><span class="highlight-cl">            <span class="highlight-o">}</span> <span class="highlight-k">catch</span> <span class="highlight-o">(</span><span class="highlight-n">InterruptedException</span> <span class="highlight-n">e</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">13</span><span class="highlight-cl">                <span class="highlight-k">throw</span> <span class="highlight-k">new</span> <span class="highlight-n">RuntimeException</span><span class="highlight-o">(</span><span class="highlight-n">e</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">14</span><span class="highlight-cl">            <span class="highlight-o">}</span>
</span></span><span class="highlight-line"><span class="highlight-ln">15</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"future_01 计算完毕"</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">16</span><span class="highlight-cl">            <span class="highlight-k">return</span> <span class="highlight-n">100</span><span class="highlight-o">;</span>
</span></span><span class="highlight-line"><span class="highlight-ln">17</span><span class="highlight-cl">        <span class="highlight-o">},</span> <span class="highlight-n">FIXED_THREAD_POOL</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">18</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">19</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">Integer</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future_02</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">20</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"future_02 计算完毕, 执行线程: %s\n"</span><span class="highlight-o">,</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">21</span><span class="highlight-cl">            <span class="highlight-k">return</span> <span class="highlight-n">200</span><span class="highlight-o">;</span>
</span></span><span class="highlight-line"><span class="highlight-ln">22</span><span class="highlight-cl">        <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">23</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">24</span><span class="highlight-cl">        <span class="highlight-c1">// 通过处理,指定 applyToEitherAsync 的执行线程和  future_01 的线程一样,这种情况下就会导致 applyToEitherAsync 执行阻塞
</span></span></span><span class="highlight-line"><span class="highlight-ln">25</span><span class="highlight-cl"><span class="highlight-c1"></span>        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">String</span><span class="highlight-o">&gt;</span> <span class="highlight-n">resultFuture</span> <span class="highlight-o">=</span> <span class="highlight-n">future_01</span><span class="highlight-o">.</span><span class="highlight-na">applyToEitherAsync</span><span class="highlight-o">(</span><span class="highlight-n">future_02</span><span class="highlight-o">,</span>
</span></span><span class="highlight-line"><span class="highlight-ln">26</span><span class="highlight-cl">                <span class="highlight-n">integer</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">27</span><span class="highlight-cl">                    <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"future_01 是否计算完毕: %s, future_02 是否计算完毕: %s, 结果: %s, 执行线程: %s\n"</span><span class="highlight-o">,</span>
</span></span><span class="highlight-line"><span class="highlight-ln">28</span><span class="highlight-cl">                            <span class="highlight-n">future_01</span><span class="highlight-o">.</span><span class="highlight-na">isDone</span><span class="highlight-o">(),</span>
</span></span><span class="highlight-line"><span class="highlight-ln">29</span><span class="highlight-cl">                            <span class="highlight-n">future_02</span><span class="highlight-o">.</span><span class="highlight-na">isDone</span><span class="highlight-o">(),</span>
</span></span><span class="highlight-line"><span class="highlight-ln">30</span><span class="highlight-cl">                            <span class="highlight-n">integer</span><span class="highlight-o">.</span><span class="highlight-na">toString</span><span class="highlight-o">(),</span>
</span></span><span class="highlight-line"><span class="highlight-ln">31</span><span class="highlight-cl">                            <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">32</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">33</span><span class="highlight-cl">                    <span class="highlight-k">return</span> <span class="highlight-n">integer</span><span class="highlight-o">.</span><span class="highlight-na">toString</span><span class="highlight-o">();</span>
</span></span><span class="highlight-line"><span class="highlight-ln">34</span><span class="highlight-cl">                <span class="highlight-o">},</span>
</span></span><span class="highlight-line"><span class="highlight-ln">35</span><span class="highlight-cl">                <span class="highlight-n">FIXED_THREAD_POOL</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">36</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">37</span><span class="highlight-cl">        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"resultFuture 计算结果: "</span> <span class="highlight-o">+</span> <span class="highlight-n">resultFuture</span><span class="highlight-o">.</span><span class="highlight-na">join</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">38</span><span class="highlight-cl">    <span class="highlight-o">}</span>
</span></span></code></pre>
<p>执行结果：</p>
<blockquote>
<p>future_01 计算开始, 执行线程: pool-1-thread-1<br>
future_02 计算完毕, 执行线程: ForkJoinPool.commonPool-worker-1<br>
future_01 计算完毕<br>
future_01 是否计算完毕: true, future_02 是否计算完毕: true, 结果: 100, 执行线程: pool-1-thread-1<br>
resultFuture 计算结果: 100</p>
</blockquote>
<p><strong>很明显，出现了阻塞。所以 <em>applyToEither</em> 和 <em>acceptEither</em> 非阻塞并非绝对，需要按情况具体分析</strong></p>
<h3 id="在计算步骤链中组合-CompletableFuture">在计算步骤链中组合 <em>CompletableFuture</em></h3>
<h4 id="使用-thenCompose-方法将两个-CompletableFuture-顺序链接起来">使用 <em>thenCompose</em> 方法将两个 <em>CompletableFuture</em> 顺序链接起来</h4>
<ul>
<li>CompletableFuture#thenCompose(Function)</li>
<li>CompletableFuture#thenComposeAsync(Function)</li>
<li>CompletableFuture#thenComposeAsync(Function, Executor)</li>
</ul>
<p>示例代码：</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln"> 1</span><span class="highlight-cl">    <span class="highlight-nd">@Test</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 2</span><span class="highlight-cl">    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">test_thenCompose_method</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 3</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">String</span><span class="highlight-o">&gt;</span> <span class="highlight-n">baseFuture</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 4</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"base future compute start"</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 5</span><span class="highlight-cl">            <span class="highlight-k">try</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 6</span><span class="highlight-cl">                <span class="highlight-n">TimeUnit</span><span class="highlight-o">.</span><span class="highlight-na">SECONDS</span><span class="highlight-o">.</span><span class="highlight-na">sleep</span><span class="highlight-o">(</span><span class="highlight-n">10</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 7</span><span class="highlight-cl">            <span class="highlight-o">}</span> <span class="highlight-k">catch</span> <span class="highlight-o">(</span><span class="highlight-n">InterruptedException</span> <span class="highlight-n">e</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 8</span><span class="highlight-cl">                <span class="highlight-k">throw</span> <span class="highlight-k">new</span> <span class="highlight-n">RuntimeException</span><span class="highlight-o">(</span><span class="highlight-n">e</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 9</span><span class="highlight-cl">            <span class="highlight-o">}</span>
</span></span><span class="highlight-line"><span class="highlight-ln">10</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"base future compute end. 执行线程 : "</span> <span class="highlight-o">+</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">11</span><span class="highlight-cl">            <span class="highlight-k">return</span> <span class="highlight-s">"hello,%s"</span><span class="highlight-o">;</span>
</span></span><span class="highlight-line"><span class="highlight-ln">12</span><span class="highlight-cl">        <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">13</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">14</span><span class="highlight-cl">        <span class="highlight-c1">// 即使使用 thenComposeAsync, 任需要等 baseFuture 计算完毕之后 才会执行 thenComposeAsync 的计算
</span></span></span><span class="highlight-line"><span class="highlight-ln">15</span><span class="highlight-cl"><span class="highlight-c1"></span>        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">Integer</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future</span> <span class="highlight-o">=</span> <span class="highlight-n">baseFuture</span><span class="highlight-o">.</span><span class="highlight-na">thenComposeAsync</span><span class="highlight-o">(</span><span class="highlight-n">str</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">16</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"thenComposeAsync run ,baseFuture 执行完毕: "</span> <span class="highlight-o">+</span> <span class="highlight-n">baseFuture</span><span class="highlight-o">.</span><span class="highlight-na">isDone</span><span class="highlight-o">()</span>
</span></span><span class="highlight-line"><span class="highlight-ln">17</span><span class="highlight-cl">                    <span class="highlight-o">+</span> <span class="highlight-s">". 执行线程 : "</span> <span class="highlight-o">+</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">18</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">19</span><span class="highlight-cl">            <span class="highlight-k">try</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">20</span><span class="highlight-cl">                <span class="highlight-n">TimeUnit</span><span class="highlight-o">.</span><span class="highlight-na">SECONDS</span><span class="highlight-o">.</span><span class="highlight-na">sleep</span><span class="highlight-o">(</span><span class="highlight-n">10</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">21</span><span class="highlight-cl">            <span class="highlight-o">}</span> <span class="highlight-k">catch</span> <span class="highlight-o">(</span><span class="highlight-n">InterruptedException</span> <span class="highlight-n">e</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">22</span><span class="highlight-cl">                <span class="highlight-k">throw</span> <span class="highlight-k">new</span> <span class="highlight-n">RuntimeException</span><span class="highlight-o">(</span><span class="highlight-n">e</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">23</span><span class="highlight-cl">            <span class="highlight-o">}</span>
</span></span><span class="highlight-line"><span class="highlight-ln">24</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">25</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"thenComposeAsync run end"</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">26</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">27</span><span class="highlight-cl">            <span class="highlight-k">return</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">28</span><span class="highlight-cl">                <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-n">String</span><span class="highlight-o">.</span><span class="highlight-na">format</span><span class="highlight-o">(</span><span class="highlight-n">str</span><span class="highlight-o">,</span> <span class="highlight-s">"java 8. 执行线程 : "</span> <span class="highlight-o">+</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">()));</span>
</span></span><span class="highlight-line"><span class="highlight-ln">29</span><span class="highlight-cl">                <span class="highlight-k">return</span> <span class="highlight-n">100</span><span class="highlight-o">;</span>
</span></span><span class="highlight-line"><span class="highlight-ln">30</span><span class="highlight-cl">            <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">31</span><span class="highlight-cl">        <span class="highlight-o">},</span> <span class="highlight-n">FIXED_THREAD_POOL</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">32</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">33</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">34</span><span class="highlight-cl">        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"等待 future 计算完毕 ..."</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">35</span><span class="highlight-cl">        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"计算结果 : "</span> <span class="highlight-o">+</span> <span class="highlight-n">future</span><span class="highlight-o">.</span><span class="highlight-na">join</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">36</span><span class="highlight-cl">    <span class="highlight-o">}</span>
</span></span></code></pre>
<p>执行结果：</p>
<blockquote>
<p>base future compute start<br>
等待 future 计算完毕 ...<br>
base future compute end. 执行线程 : ForkJoinPool.commonPool-worker-1<br>
thenComposeAsync run ,baseFuture 执行完毕: true. 执行线程 : pool-1-thread-1<br>
thenComposeAsync run end<br>
hello,java 8. 执行线程 : ForkJoinPool.commonPool-worker-1<br>
计算结果 : 100</p>
</blockquote>
<h5 id="thenCompose---与-thenApply---的区别"><em>thenCompose()</em> 与 <em>thenApply()</em> 的区别</h5>
<ul>
<li>
<p><em>thenApply()</em> 可以处理先前计算的结果，关键点在于可以转换 <em>CompletableFuture</em> 返回的结果类型，并且这个 <em>CompletableFuture</em> 仅仅只是对结果的封装，其计算逻辑已经在 <em>thenApply()</em> 中执行完毕。</p>
</li>
<li>
<p><em>thenCompose()</em> 可以把先前的计算结果作为入参在另一个 <em>CompletableFuture</em> 中使用，并且返回一个全新的 <em>CompletableFuture</em>，关键点在于返回的对象是 <em>CompletableFuture</em>，其计算逻辑在 <em>thenCompose()</em> 执行完毕的时候仍未执行。</p>
<p><strong><font color="red">网上经常会说：<em>thenApply()</em>&nbsp;和 <em>thenCompose()</em>&nbsp;的区别类似于&nbsp;<em>map()</em> 和 <em>flatMap()</em>&nbsp;的区别。我个人对此的理解是：<em>map()</em> 是把 T -&gt; R ，<em>flatMap()</em>&nbsp;是把 T -&gt; Stream&lt;R&gt;；类似的，<em>thenApply()</em>&nbsp;是把 T -&gt; U，<em>thenCompose()</em>&nbsp;是把 T -&gt; CompletableFuture&lt;U&gt;</font></strong></p>
</li>
</ul>
<h4 id="执行两个独立的-CompletableFuture-并对它们的结果做一些事情">执行两个独立的 <em>CompletableFuture</em> 并对它们的结果做一些事情</h4>
<h5 id="组合两个并行的-CompletionStage--返回一个新的-CompletableFuture">组合两个并行的 <em>CompletionStage</em>， 返回一个新的 <em>CompletableFuture</em></h5>
<ul>
<li>CompletableFuture#thenCombine(CompletionStage, BiFunction)</li>
<li>CompletableFuture#thenCombineAsync(CompletionStage, BiFunction)</li>
<li>CompletableFuture#thenCombineAsync(CompletionStage, BiFunction, Executor)</li>
</ul>
<p>示例代码：</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln"> 1</span><span class="highlight-cl">    <span class="highlight-cm">/**
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 2</span><span class="highlight-cl"><span class="highlight-cm">     * 组合两个并行的 CompletionStage, 返回一个新的 CompletableFuture
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 3</span><span class="highlight-cl"><span class="highlight-cm">     *
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 4</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#thenCombine(CompletionStage, BiFunction)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 5</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#thenCombineAsync(CompletionStage, BiFunction)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 6</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#thenCombineAsync(CompletionStage, BiFunction, Executor)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 7</span><span class="highlight-cl"><span class="highlight-cm">     */</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 8</span><span class="highlight-cl">    <span class="highlight-nd">@Test</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 9</span><span class="highlight-cl">    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">test_thenCombine_method</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">10</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">Integer</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future_01</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">11</span><span class="highlight-cl">            <span class="highlight-k">try</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">12</span><span class="highlight-cl">                <span class="highlight-n">TimeUnit</span><span class="highlight-o">.</span><span class="highlight-na">SECONDS</span><span class="highlight-o">.</span><span class="highlight-na">sleep</span><span class="highlight-o">(</span><span class="highlight-n">10</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">13</span><span class="highlight-cl">            <span class="highlight-o">}</span> <span class="highlight-k">catch</span> <span class="highlight-o">(</span><span class="highlight-n">InterruptedException</span> <span class="highlight-n">e</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">14</span><span class="highlight-cl">                <span class="highlight-k">throw</span> <span class="highlight-k">new</span> <span class="highlight-n">RuntimeException</span><span class="highlight-o">(</span><span class="highlight-n">e</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">15</span><span class="highlight-cl">            <span class="highlight-o">}</span>
</span></span><span class="highlight-line"><span class="highlight-ln">16</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"future_01 计算完毕,执行线程："</span> <span class="highlight-o">+</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">17</span><span class="highlight-cl">            <span class="highlight-k">return</span> <span class="highlight-n">100</span><span class="highlight-o">;</span>
</span></span><span class="highlight-line"><span class="highlight-ln">18</span><span class="highlight-cl">        <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">19</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">20</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">String</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future_02</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">21</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"future_02 计算完毕,执行线程："</span> <span class="highlight-o">+</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">22</span><span class="highlight-cl">            <span class="highlight-k">return</span> <span class="highlight-s">"abc"</span><span class="highlight-o">;</span>
</span></span><span class="highlight-line"><span class="highlight-ln">23</span><span class="highlight-cl">        <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">24</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">25</span><span class="highlight-cl">        <span class="highlight-c1">// future_02 和 future_01 并行执行,但是 thenCombineAsync() 需要等 future_01 计算完毕之后才能执行.
</span></span></span><span class="highlight-line"><span class="highlight-ln">26</span><span class="highlight-cl"><span class="highlight-c1"></span>        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">String</span><span class="highlight-o">&gt;</span> <span class="highlight-n">resultFuture</span> <span class="highlight-o">=</span> <span class="highlight-n">future_01</span><span class="highlight-o">.</span><span class="highlight-na">thenCombineAsync</span><span class="highlight-o">(</span><span class="highlight-n">future_02</span><span class="highlight-o">,</span>
</span></span><span class="highlight-line"><span class="highlight-ln">27</span><span class="highlight-cl">                <span class="highlight-o">(</span><span class="highlight-n">future_01_value</span><span class="highlight-o">,</span> <span class="highlight-n">future_02_value</span><span class="highlight-o">)</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">28</span><span class="highlight-cl">                    <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"future_01 是否计算完毕: %s, future_02 是否计算完毕: %s ,执行线程: [%s]\n"</span><span class="highlight-o">,</span>
</span></span><span class="highlight-line"><span class="highlight-ln">29</span><span class="highlight-cl">                            <span class="highlight-n">future_01</span><span class="highlight-o">.</span><span class="highlight-na">isDone</span><span class="highlight-o">(),</span>
</span></span><span class="highlight-line"><span class="highlight-ln">30</span><span class="highlight-cl">                            <span class="highlight-n">future_02</span><span class="highlight-o">.</span><span class="highlight-na">isDone</span><span class="highlight-o">(),</span>
</span></span><span class="highlight-line"><span class="highlight-ln">31</span><span class="highlight-cl">                            <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">32</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">33</span><span class="highlight-cl">                    <span class="highlight-k">return</span> <span class="highlight-n">future_01_value</span> <span class="highlight-o">+</span> <span class="highlight-n">future_02_value</span><span class="highlight-o">;</span>
</span></span><span class="highlight-line"><span class="highlight-ln">34</span><span class="highlight-cl">                <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">35</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">36</span><span class="highlight-cl">        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"resultFuture 结果:"</span> <span class="highlight-o">+</span> <span class="highlight-n">resultFuture</span><span class="highlight-o">.</span><span class="highlight-na">join</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">37</span><span class="highlight-cl">    <span class="highlight-o">}</span>
</span></span></code></pre>
<p>执行结果：</p>
<blockquote>
<p>future_02 计算完毕,执行线程：ForkJoinPool.commonPool-worker-2<br>
future_01 计算完毕,执行线程：ForkJoinPool.commonPool-worker-1<br>
future_01 是否计算完毕: true, future_02 是否计算完毕: true ,执行线程: [ForkJoinPool.commonPool-worker-1]<br>
resultFuture 结果:100abc</p>
</blockquote>
<h3 id="异常处理">异常处理</h3>
<ul>
<li>
<p>当 <code>CompletableFuture</code> 的计算抛出异常的时候，执行特定的 Action 动作，若计算正常执行，则不会执行  Action 动作，直接返回计算结果</p>
<blockquote>
<p>CompletableFuture#completeExceptionally(Throwable)</p>
</blockquote>
<p>示例代码：</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln"> 1</span><span class="highlight-cl">    <span class="highlight-cm">/**
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 2</span><span class="highlight-cl"><span class="highlight-cm">     * 当 {@link CompletableFuture} 的计算抛出异常的时候，我们可以执行特定的 Action 动作
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 3</span><span class="highlight-cl"><span class="highlight-cm">     *
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 4</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#completeExceptionally(Throwable)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 5</span><span class="highlight-cl"><span class="highlight-cm">     */</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 6</span><span class="highlight-cl">    <span class="highlight-nd">@Test</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 7</span><span class="highlight-cl">    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">test_process_exception</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 8</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">String</span><span class="highlight-o">&gt;</span> <span class="highlight-n">resultFutureOfException</span> <span class="highlight-o">=</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 9</span><span class="highlight-cl">                <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">10</span><span class="highlight-cl">                            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"base_future 开始执行,执行线程：%s\n"</span><span class="highlight-o">,</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">11</span><span class="highlight-cl">                            <span class="highlight-k">if</span> <span class="highlight-o">(</span><span class="highlight-kc">true</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">12</span><span class="highlight-cl">                                <span class="highlight-k">throw</span> <span class="highlight-k">new</span> <span class="highlight-n">RuntimeException</span><span class="highlight-o">(</span><span class="highlight-s">"我故意的，嘻嘻"</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">13</span><span class="highlight-cl">                            <span class="highlight-o">}</span>
</span></span><span class="highlight-line"><span class="highlight-ln">14</span><span class="highlight-cl">                            <span class="highlight-k">return</span> <span class="highlight-s">"计算成功"</span><span class="highlight-o">;</span>
</span></span><span class="highlight-line"><span class="highlight-ln">15</span><span class="highlight-cl">                        <span class="highlight-o">})</span>
</span></span><span class="highlight-line"><span class="highlight-ln">16</span><span class="highlight-cl">                        <span class="highlight-c1">// 只有前一动作发生异常才会执行exceptionally()中定义的active
</span></span></span><span class="highlight-line"><span class="highlight-ln">17</span><span class="highlight-cl"><span class="highlight-c1"></span>                        <span class="highlight-o">.</span><span class="highlight-na">exceptionally</span><span class="highlight-o">(</span><span class="highlight-n">throwable</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">18</span><span class="highlight-cl">                            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"exceptionally method start, 执行线程："</span> <span class="highlight-o">+</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">19</span><span class="highlight-cl">                            <span class="highlight-k">return</span> <span class="highlight-n">String</span><span class="highlight-o">.</span><span class="highlight-na">format</span><span class="highlight-o">(</span><span class="highlight-s">"base_future 发生异常 [%s]\n"</span><span class="highlight-o">,</span> <span class="highlight-n">throwable</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">20</span><span class="highlight-cl">                        <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">21</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">22</span><span class="highlight-cl">        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"计算结果：%s,执行线程：%s "</span><span class="highlight-o">,</span>
</span></span><span class="highlight-line"><span class="highlight-ln">23</span><span class="highlight-cl">                <span class="highlight-n">resultFutureOfException</span><span class="highlight-o">.</span><span class="highlight-na">join</span><span class="highlight-o">(),</span>
</span></span><span class="highlight-line"><span class="highlight-ln">24</span><span class="highlight-cl">                <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">25</span><span class="highlight-cl">    <span class="highlight-o">}</span>
</span></span></code></pre>
<p>执行结果：</p>
<blockquote>
<p>base_future 开始执行,执行线程：ForkJoinPool.commonPool-worker-1<br>
exceptionally method start, 执行线程：ForkJoinPool.commonPool-worker-1<br>
计算结果：base_future 发生异常 [java.util.concurrent.CompletionException: java.lang.RuntimeException: 我故意的，嘻嘻] ,执行线程：main</p>
</blockquote>
<p>修改代码如下，测试计算不发生异常时的执行情况：</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln"> 1</span><span class="highlight-cl">    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">test_process_exception</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 2</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">String</span><span class="highlight-o">&gt;</span> <span class="highlight-n">resultFutureOfException</span> <span class="highlight-o">=</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 3</span><span class="highlight-cl">                <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 4</span><span class="highlight-cl">                            <span class="highlight-o">...</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 5</span><span class="highlight-cl">                            <span class="highlight-k">if</span> <span class="highlight-o">(</span><span class="highlight-kc">false</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 6</span><span class="highlight-cl">                                <span class="highlight-k">throw</span> <span class="highlight-k">new</span> <span class="highlight-n">RuntimeException</span><span class="highlight-o">(</span><span class="highlight-s">"我故意的，嘻嘻"</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 7</span><span class="highlight-cl">                            <span class="highlight-o">}</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 8</span><span class="highlight-cl">                            <span class="highlight-o">...</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 9</span><span class="highlight-cl">                        <span class="highlight-o">})</span>
</span></span><span class="highlight-line"><span class="highlight-ln">10</span><span class="highlight-cl">                        <span class="highlight-c1">// 只有前一动作发生异常才会执行exceptionally()中定义的active
</span></span></span><span class="highlight-line"><span class="highlight-ln">11</span><span class="highlight-cl"><span class="highlight-c1"></span>                        <span class="highlight-o">.</span><span class="highlight-na">exceptionally</span><span class="highlight-o">(</span><span class="highlight-n">throwable</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">12</span><span class="highlight-cl">                            <span class="highlight-o">...</span>
</span></span><span class="highlight-line"><span class="highlight-ln">13</span><span class="highlight-cl">                        <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">14</span><span class="highlight-cl">		<span class="highlight-o">...</span>
</span></span><span class="highlight-line"><span class="highlight-ln">15</span><span class="highlight-cl">    <span class="highlight-o">}</span>
</span></span></code></pre>
<p>执行结果如下：</p>
<blockquote>
<p>base_future 开始执行,执行线程：ForkJoinPool.commonPool-worker-1<br>
计算结果：计算成功,执行线程：main</p>
</blockquote>
<p><strong>由此可知：计算正常执行，则不会执行 Action 动作，直接返回计算结果</strong></p>
<p><font color="red">CompletableFuture#completeExceptionally 处理完异常，并不会再次抛出异常，程序会正常运行结束，但是 <code>CompletableFuture#whenComplete</code> 处理的异常会抛出</font></p>
</li>
<li>
<p>既能处理计算结果，也能处理异常</p>
<blockquote>
<p>CompletableFuture#handle(BiFunction)</p>
<p>CompletableFuture#handleAsync(BiFunction)</p>
<p>CompletableFuture#handleAsync(BiFunction, Executor)</p>
</blockquote>
<p>计算正常执行时，处理计算结果的示例代码：</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln"> 1</span><span class="highlight-cl">    <span class="highlight-cm">/**
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 2</span><span class="highlight-cl"><span class="highlight-cm">     * 当原先的 {@link CompletableFuture} 的值计算完成或者抛出异常的时候，会触发 {@link CompletableFuture#handle(BiFunction)} 的计算
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 3</span><span class="highlight-cl"><span class="highlight-cm">     * &lt;br&gt;
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 4</span><span class="highlight-cl"><span class="highlight-cm">     * &lt;font color="red"&gt;与 {@link CompletableFuture#whenComplete} 相比,该组方法允许变更最终 {@link CompletableFuture} 的对象类型&lt;/font&gt;
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 5</span><span class="highlight-cl"><span class="highlight-cm">     *
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 6</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#handle(BiFunction)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 7</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#handleAsync(BiFunction)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 8</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#handleAsync(BiFunction, Executor)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 9</span><span class="highlight-cl"><span class="highlight-cm">     */</span>
</span></span><span class="highlight-line"><span class="highlight-ln">10</span><span class="highlight-cl">    <span class="highlight-nd">@Test</span>
</span></span><span class="highlight-line"><span class="highlight-ln">11</span><span class="highlight-cl">    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">test_handle_method</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">12</span><span class="highlight-cl">        <span class="highlight-c1">// 用同一线程执行handle()指定的active
</span></span></span><span class="highlight-line"><span class="highlight-ln">13</span><span class="highlight-cl"><span class="highlight-c1"></span>        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">Integer</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">completedFuture</span><span class="highlight-o">(</span><span class="highlight-s">"我是字符串"</span><span class="highlight-o">)</span>
</span></span><span class="highlight-line"><span class="highlight-ln">14</span><span class="highlight-cl">                <span class="highlight-o">.</span><span class="highlight-na">handle</span><span class="highlight-o">((</span><span class="highlight-n">v</span><span class="highlight-o">,</span> <span class="highlight-n">e</span><span class="highlight-o">)</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">15</span><span class="highlight-cl">                    <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"原始计算结果: %s,当前线程: %s \n"</span><span class="highlight-o">,</span> <span class="highlight-n">v</span><span class="highlight-o">,</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">16</span><span class="highlight-cl">                    <span class="highlight-k">return</span> <span class="highlight-n">v</span><span class="highlight-o">.</span><span class="highlight-na">length</span><span class="highlight-o">();</span>
</span></span><span class="highlight-line"><span class="highlight-ln">17</span><span class="highlight-cl">                <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">18</span><span class="highlight-cl">        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"最终 CompletableFuture 结果: %s \n"</span><span class="highlight-o">,</span> <span class="highlight-n">future</span><span class="highlight-o">.</span><span class="highlight-na">join</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">19</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">20</span><span class="highlight-cl">        <span class="highlight-c1">// 用默认的线程池 ForkJoinPool#commonPool() 异步执行特定的 Action
</span></span></span><span class="highlight-line"><span class="highlight-ln">21</span><span class="highlight-cl"><span class="highlight-c1"></span>        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">Integer</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future_handleAsync</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">completedFuture</span><span class="highlight-o">(</span><span class="highlight-s">"我是字符串"</span><span class="highlight-o">)</span>
</span></span><span class="highlight-line"><span class="highlight-ln">22</span><span class="highlight-cl">                <span class="highlight-o">.</span><span class="highlight-na">handleAsync</span><span class="highlight-o">((</span><span class="highlight-n">v</span><span class="highlight-o">,</span> <span class="highlight-n">e</span><span class="highlight-o">)</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">23</span><span class="highlight-cl">                    <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"原始计算结果: %s,当前线程: %s \n"</span><span class="highlight-o">,</span> <span class="highlight-n">v</span><span class="highlight-o">,</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">24</span><span class="highlight-cl">                    <span class="highlight-k">return</span> <span class="highlight-n">v</span><span class="highlight-o">.</span><span class="highlight-na">length</span><span class="highlight-o">();</span>
</span></span><span class="highlight-line"><span class="highlight-ln">25</span><span class="highlight-cl">                <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">26</span><span class="highlight-cl">        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"最终 CompletableFuture 结果: %s \n"</span><span class="highlight-o">,</span> <span class="highlight-n">future_handleAsync</span><span class="highlight-o">.</span><span class="highlight-na">join</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">27</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">28</span><span class="highlight-cl">        <span class="highlight-c1">// 用指定线程池异步执行特定的 Action
</span></span></span><span class="highlight-line"><span class="highlight-ln">29</span><span class="highlight-cl"><span class="highlight-c1"></span>        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">Integer</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future_handleAsync_withCustomPool</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">completedFuture</span><span class="highlight-o">(</span><span class="highlight-s">"我是字符串"</span><span class="highlight-o">)</span>
</span></span><span class="highlight-line"><span class="highlight-ln">30</span><span class="highlight-cl">                <span class="highlight-o">.</span><span class="highlight-na">handleAsync</span><span class="highlight-o">((</span><span class="highlight-n">v</span><span class="highlight-o">,</span> <span class="highlight-n">e</span><span class="highlight-o">)</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">31</span><span class="highlight-cl">                            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"原始计算结果: %s,当前线程: %s \n"</span><span class="highlight-o">,</span> <span class="highlight-n">v</span><span class="highlight-o">,</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">32</span><span class="highlight-cl">                            <span class="highlight-k">return</span> <span class="highlight-n">v</span><span class="highlight-o">.</span><span class="highlight-na">length</span><span class="highlight-o">();</span>
</span></span><span class="highlight-line"><span class="highlight-ln">33</span><span class="highlight-cl">                        <span class="highlight-o">},</span>
</span></span><span class="highlight-line"><span class="highlight-ln">34</span><span class="highlight-cl">                        <span class="highlight-n">FIXED_THREAD_POOL</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">35</span><span class="highlight-cl">        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"最终 CompletableFuture 结果: %s \n"</span><span class="highlight-o">,</span> <span class="highlight-n">future_handleAsync_withCustomPool</span><span class="highlight-o">.</span><span class="highlight-na">join</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">36</span><span class="highlight-cl">    <span class="highlight-o">}</span>
</span></span></code></pre>
<p>执行结果：</p>
<blockquote>
<p>原始计算结果: 我是字符串,当前线程: main<br>
最终 CompletableFuture 结果: 5<br>
原始计算结果: 我是字符串,当前线程: ForkJoinPool.commonPool-worker-1<br>
最终 CompletableFuture 结果: 5<br>
原始计算结果: 我是字符串,当前线程: pool-1-thread-1<br>
最终 CompletableFuture 结果: 5</p>
</blockquote>
<p>计算执行异常时，处理异常的示例代码：</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln"> 1</span><span class="highlight-cl">    <span class="highlight-cm">/**
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 2</span><span class="highlight-cl"><span class="highlight-cm">     * {@link CompletableFuture#handle} 处理异常的实例代码
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 3</span><span class="highlight-cl"><span class="highlight-cm">     */</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 4</span><span class="highlight-cl">    <span class="highlight-nd">@Test</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 5</span><span class="highlight-cl">    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">test_handle_method_when_occur_exception</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 6</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">String</span><span class="highlight-o">&gt;</span> <span class="highlight-n">baseFuture</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 7</span><span class="highlight-cl">            <span class="highlight-k">if</span> <span class="highlight-o">(</span><span class="highlight-kc">true</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 8</span><span class="highlight-cl">                <span class="highlight-k">throw</span> <span class="highlight-k">new</span> <span class="highlight-n">RuntimeException</span><span class="highlight-o">(</span><span class="highlight-s">"我故意的,嘻嘻"</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 9</span><span class="highlight-cl">            <span class="highlight-o">}</span>
</span></span><span class="highlight-line"><span class="highlight-ln">10</span><span class="highlight-cl">            <span class="highlight-k">return</span> <span class="highlight-s">"我是字符串"</span><span class="highlight-o">;</span>
</span></span><span class="highlight-line"><span class="highlight-ln">11</span><span class="highlight-cl">        <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">12</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">13</span><span class="highlight-cl">        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"handle : "</span> <span class="highlight-o">+</span>
</span></span><span class="highlight-line"><span class="highlight-ln">14</span><span class="highlight-cl">                <span class="highlight-n">baseFuture</span><span class="highlight-o">.</span><span class="highlight-na">handle</span><span class="highlight-o">((</span><span class="highlight-n">v</span><span class="highlight-o">,</span> <span class="highlight-n">e</span><span class="highlight-o">)</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">15</span><span class="highlight-cl">                            <span class="highlight-k">if</span> <span class="highlight-o">(</span><span class="highlight-n">Objects</span><span class="highlight-o">.</span><span class="highlight-na">nonNull</span><span class="highlight-o">(</span><span class="highlight-n">e</span><span class="highlight-o">))</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">16</span><span class="highlight-cl">                                <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"handle 基础 Future 计算发生异常: "</span> <span class="highlight-o">+</span> <span class="highlight-n">e</span><span class="highlight-o">.</span><span class="highlight-na">getMessage</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">17</span><span class="highlight-cl">                                <span class="highlight-k">return</span> <span class="highlight-n">e</span><span class="highlight-o">.</span><span class="highlight-na">getMessage</span><span class="highlight-o">().</span><span class="highlight-na">length</span><span class="highlight-o">();</span>
</span></span><span class="highlight-line"><span class="highlight-ln">18</span><span class="highlight-cl">                            <span class="highlight-o">}</span>
</span></span><span class="highlight-line"><span class="highlight-ln">19</span><span class="highlight-cl">                            <span class="highlight-k">return</span> <span class="highlight-n">v</span><span class="highlight-o">.</span><span class="highlight-na">length</span><span class="highlight-o">();</span>
</span></span><span class="highlight-line"><span class="highlight-ln">20</span><span class="highlight-cl">                        <span class="highlight-o">})</span>
</span></span><span class="highlight-line"><span class="highlight-ln">21</span><span class="highlight-cl">                        <span class="highlight-o">.</span><span class="highlight-na">join</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">22</span><span class="highlight-cl">    <span class="highlight-o">}</span>
</span></span></code></pre>
</li>
</ul>
<h2 id="参考文档">参考文档</h2>
<ol>
<li><a href="https://colobu.com/2016/02/29/Java-CompletableFuture" target="_blank">https://colobu.com/2016/02/29/Java-CompletableFuture</a></li>
<li><a href="https://www.baeldung.com/java-completablefuture" target="_blank">https://www.baeldung.com/java-completablefuture</a></li>
</ol>
                    <div>
                        <hr>

标题：Java 8 - CompletableFuture<br>
作者：<a href="https://forzenfox.github.io" target="_blank">forzenfox</a><br>
地址：<a href="https://forzenfox.github.io/articles/2022/04/26/1650947125974.html" target="_blank">https://forzenfox.github.io/articles/2022/04/26/1650947125974.html</a><br>

<!-- 签名档内可使用 HTML、JavaScript -->
<br>
                    </div>
            </section>
        </div>

    </div>
        <div class="post__toc">
<ul class="article__toc">
        <li class="toc__h3">
            <a href="#构建-CompletableFuture">构建 CompletableFuture</a>
        </li>
        <li class="toc__h4">
            <a href="#直接返回计算结果">直接返回计算结果</a>
        </li>
        <li class="toc__h4">
            <a href="#为异步执行的任务构建-CompletableFuture">为异步执行的任务构建 CompletableFuture</a>
        </li>
        <li class="toc__h3">
            <a href="#对计算结果的二次处理">对计算结果的二次处理</a>
        </li>
        <li class="toc__h4">
            <a href="#不改变计算结果的对象类型-仅对结果进行二次增强处理">不改变计算结果的对象类型，仅对结果进行二次增强处理</a>
        </li>
        <li class="toc__h4">
            <a href="#改变计算结果的对象类型-----">改变计算结果的对象类型，CompletableFuture<T> -> CompletableFuture<U></a>
        </li>
        <li class="toc__h4">
            <a href="#消费计算结果-----">消费计算结果，CompletableFuture<T> -> CompletableFuture<Void></a>
        </li>
        <li class="toc__h4">
            <a href="#当两个CompletionStage都正常完成计算的时候-执行提供的-Active">当两个 CompletionStage 都正常完成计算的时候，执行提供的 Active</a>
        </li>
        <li class="toc__h4">
            <a href="#当两个中任意一个-CompletionStage-完成的时候-action这个消费者就会被执行">当两个中任意一个 CompletionStage 完成的时候，action 这个消费者就会被执行</a>
        </li>
        <li class="toc__h4">
            <a href="#applyToEither-和-acceptEither-一定是非阻塞的么-">applyToEither 和 acceptEither 一定是非阻塞的么？</a>
        </li>
        <li class="toc__h3">
            <a href="#在计算步骤链中组合-CompletableFuture">在计算步骤链中组合 CompletableFuture</a>
        </li>
        <li class="toc__h4">
            <a href="#使用-thenCompose-方法将两个-CompletableFuture-顺序链接起来">使用 thenCompose 方法将两个 CompletableFuture 顺序链接起来</a>
        </li>
        <li class="toc__h5">
            <a href="#thenCompose---与-thenApply---的区别">thenCompose() 与 thenApply() 的区别</a>
        </li>
        <li class="toc__h4">
            <a href="#执行两个独立的-CompletableFuture-并对它们的结果做一些事情">执行两个独立的 CompletableFuture 并对它们的结果做一些事情</a>
        </li>
        <li class="toc__h5">
            <a href="#组合两个并行的-CompletionStage--返回一个新的-CompletableFuture">组合两个并行的 CompletionStage， 返回一个新的 CompletableFuture</a>
        </li>
        <li class="toc__h3">
            <a href="#异常处理">异常处理</a>
        </li>
        <li class="toc__h2">
            <a href="#参考文档">参考文档</a>
        </li>
</ul>        </div>
        <div class="wrapper">
            <div id="gitalk-container"></div>
            <div id="vcomment"
                 style="    margin-bottom: 40px; margin-top: 80px;
        border: 1px solid rgba(255,255,255,0.8);
        border-radius: 5px;
        background: rgba(255,255,255,0.9);
        box-shadow: 0 1px 4px rgba(0,0,0,0.04);
        padding: 20px;"
                 data-name="forzenfox" data-postId="1650947125974"></div>
            <div id="b3logsolocomments"></div>
        </div>
    <div class="article__bottom">
        <div class="wrapper">
            <div class="fn__flex">
                <div class="item" id="randomArticles"></div>
                <div class="item" id="relevantArticles"></div>
            </div>
        </div>
    </div>
    
</div>
<script type="text/javascript"
        src="https://forzenfox.github.io/skins/Bubble/js/TweenMax.min.js?1682844075131"
        charset="utf-8"></script>
<footer class="footer">
    <div class="wrapper">
            <a href="https://ld246.com/member/forzenfox"
       title="https://ld246.com/member/forzenfox"
       class="user__site"
       target="_blank" rel="noopener nofollow">
        <svg viewBox="0 0 32 32" width="100%" height="100%">
            <path fill="#d23f31" style="fill: var(--color1, #d23f31)" d="M5.787 17.226h17.033l5.954 9.528c0.47 0.752 0.003 1.361-1.042 1.361h-15.141z"></path>
            <path d="M10.74 3.927h17.033c1.045 0 1.512 0.609 1.042 1.361l-5.954 9.528h-19.872l6.379-10.209c0.235-0.376 0.849-0.681 1.372-0.681z"></path>
            <path d="M2.953 17.226h2.839l6.804 10.889h-1.892c-0.523 0-1.137-0.305-1.372-0.681z"></path>
        </svg>
    </a>


 <br>
        &copy; 2023
        <a href="https://forzenfox.github.io">佛系码农</a>
        
        <span class="footer__heart">❤️</span>
    </div>
</footer>
<svg class="side__top" id="sideTop" version="1.1" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
    <path d="M26.562 13.958c0 0.72 0.583 1.303 1.303 1.303s1.303-0.583 1.303-1.303v0c0-0.72-0.583-1.303-1.303-1.303s-1.303 0.583-1.303 1.303v0zM23.305 10.7c0 0 0 0 0 0 0 0.72 0.583 1.303 1.303 1.303s1.303-0.583 1.303-1.303c0-0 0-0 0-0v0c0-0 0-0 0-0 0-0.72-0.583-1.303-1.303-1.303s-1.303 0.583-1.303 1.303c0 0 0 0 0 0v0zM20.022 7.417c0 0 0 0 0 0 0 0.72 0.583 1.303 1.303 1.303s1.303-0.583 1.303-1.303c0-0 0-0 0-0v0c0-0 0-0 0-0 0-0.72-0.583-1.303-1.303-1.303s-1.303 0.583-1.303 1.303c0 0 0 0 0 0v0zM29.67 0h-27.339c-0.677 0-1.228 0.551-1.228 1.228s0.551 1.228 1.228 1.228h11.151l-10.725 10.725c-0.476 0.476-0.476 1.253 0 1.729 0.226 0.226 0.551 0.351 0.852 0.351s0.626-0.125 0.852-0.351l10.074-10.074v25.936c0 0.677 0.551 1.228 1.228 1.228s1.228-0.551 1.228-1.228v-26.011c0.476 0.426 1.203 0.426 1.679-0.050s0.476-1.253 0-1.729l-0.576-0.576h11.577c0.677 0 1.228-0.551 1.228-1.228 0-0.626-0.551-1.178-1.228-1.178z"></path>
</svg>
<script>
  var Label = {
    speech: true,
    servePath: "https://forzenfox.github.io",
    staticServePath: "https://forzenfox.github.io",
    luteAvailable: true,
    hljsStyle: 'dracula',
    langLabel: "zh_CN",
    version: "4.4.0",
    staticSite: true,
    showCodeBlockLn: true,
    articleId: "1650947125974",
  }
</script>
<script type="text/javascript"
        src="https://forzenfox.github.io/skins/Bubble/js/common.min.js?1682844075131"
        charset="utf-8"></script>
<script type="text/javascript"
        src="https://forzenfox.github.io/skins/Bubble/js/circleMagic.min.js?1682844075131"
        charset="utf-8"></script>
<link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/kanbanniang@0.2.10/index.css"/>
<script async src="https://cdn.jsdelivr.net/npm/kanbanniang@0.2.10/index.js"></script>
<div class="solo-kanbanniang">
    <div class="solo-kanbanniang__tip"></div>
    <canvas id="soloKanbanniang" width="280" height="250"></canvas>
    <div class="solo-kanbanniang__tool">
        <svg id="soloKanbanniangHome" viewBox="0 0 32 32" width="100%" height="100%">
            <path d="M32 18.967l-16-12.42-16 12.42v-5.064l16-12.42 16 12.42zM28 18.516v12h-8v-8h-8v8h-8v-12l12-9z"></path>
        </svg>
        <svg id="soloKanbanniangRSS" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M320.364 768q0 45.728-32 77.728t-77.728 32-77.728-32-32-77.728 32-77.728 77.728-32 77.728 32 32 77.728zM612.94 838.272q1.152 16-9.728 27.424-10.272 12-26.848 12h-77.152q-14.272 0-24.576-9.44t-11.424-23.712q-12.576-130.848-105.44-223.712t-223.712-105.44q-14.272-1.152-23.712-11.424t-9.44-24.576V402.24q0-16.576 12-26.848 9.728-9.728 24.576-9.728h2.848q91.424 7.424 174.848 46.016t148 103.712q65.152 64.576 103.712 148t46.016 174.848z m292.576 1.152q1.152 15.424-10.272 26.848-10.272 11.424-26.272 11.424h-81.728q-14.848 0-25.44-10.016t-11.136-24.288q-6.848-122.848-57.728-233.44t-132.288-192-192-132.288-233.44-58.272q-14.272-0.576-24.288-11.136t-10.016-24.864V109.664q0-16 11.424-26.272 10.272-10.272 25.152-10.272h1.728q149.728 7.424 286.56 68.576t243.136 168q106.848 106.272 168 243.136t68.576 286.56z"></path>
        </svg>
        <svg id="soloKanbanniangChat" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M802.42709 96.163153H219.476155c-84.48109 0-154.896836 71.746044-154.896836 157.840888v393.119449c0 86.072331 70.415746 157.819398 154.896836 157.819399h214.038818V925.470963s22.526039 40.168862 64.767096 5.734608c30.965246-25.819039 126.721123-91.828428 171.775248-123.385145h132.369773c84.502579 0 154.896836-83.21526 154.896836-157.839865V251.125481c0-86.094844-70.394257-154.962328-154.896836-154.962328zM301.144176 518.002714c-39.427988 0-70.416769-31.576159-70.416769-71.746044 0-40.168862 30.988782-71.746044 70.416769-71.746044 39.426965 0 70.393233 31.577183 70.393234 71.746044 0 40.169885-30.966269 71.746044-70.393234 71.746044z m208.411657 0c-39.450501 0-70.415746-31.576159-70.415746-71.746044 0-40.168862 30.965246-71.746044 70.415746-71.746044 39.405475 0 70.394257 31.577183 70.394257 71.746044 0 40.169885-30.988782 71.746044-70.394257 71.746044z m211.203236 0c-39.426965 0-70.416769-31.576159-70.416769-71.746044 0-40.168862 30.988782-71.746044 70.416769-71.746044s70.415746 31.577183 70.415746 71.746044c-0.001023 40.169885-30.988782 71.746044-70.415746 71.746044z"></path>
        </svg>
        <svg id="soloKanbanniangChange" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M936.672 193.216l-226.88-64c-8.704-2.528-18.112-1.12-25.824 3.776-7.68 4.864-12.896 12.736-14.432 21.728C655.712 236.928 595.328 288 512 288c-71.424 0-142.464-103.296-163.776-143.104-7.136-13.28-22.528-19.84-37.024-15.68l-224 64C73.472 197.152 64 209.728 64 224v256a31.93 31.93 0 0 0 11.712 24.736c7.392 6.08 17.152 8.512 26.56 6.624L224 487.04V832c0 52.928 43.072 96 96 96h384c52.928 0 96-43.072 96-96V519.04l121.728 24.352c9.44 1.92 19.2-0.544 26.56-6.624C955.68 530.656 960 521.6 960 512V224c0-14.336-9.536-26.912-23.328-30.784zM672 800H352c-17.664 0-32-14.304-32-32s14.336-32 32-32h320c17.696 0 32 14.304 32 32s-14.304 32-32 32z"></path>
        </svg>
        <svg id="soloKanbanniangPhoto" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M898.048 258.048q23.552-1.024 46.592 9.216t40.96 27.136 28.672 39.424 10.752 46.08l0 390.144q0 24.576-10.752 47.104t-28.672 40.448-40.96 28.16-47.616 10.24l-697.344 0q-24.576 0-48.64-10.24t-42.496-27.648-29.696-40.448-11.264-48.64l0-381.952q0-22.528 10.752-45.568t28.672-41.472 39.936-30.208 44.544-11.776l63.488 0 13.312-83.968q3.072-20.48 18.432-32.768t34.816-12.288l456.704 0q19.456 0 34.304 10.752t16.896 34.304l14.336 83.968 54.272 0zM548.864 712.704q40.96 0 77.824-15.872t63.488-42.496 42.496-62.976 15.872-77.312-15.872-77.312-42.496-62.976-63.488-42.496-77.824-15.872-77.312 15.872-63.488 42.496-43.008 62.976-15.872 77.312 15.872 77.312 43.008 62.976 63.488 42.496 77.312 15.872z"></path>
        </svg>
        <svg id="soloKanbanniangGithub" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M1024 524.8c0 114.346667-32.554667 217.216-97.706667 308.565333-65.066667 91.306667-149.162667 154.538667-252.288 189.610667-11.989333 2.304-20.778667 0.682667-26.325333-4.778667a27.605333 27.605333 0 0 1-8.362667-20.48v-144.213333c0-44.16-11.52-76.501333-34.645333-97.024 25.344-2.730667 48.085333-6.826667 68.309333-12.288a268.629333 268.629333 0 0 0 62.72-26.666667 187.434667 187.434667 0 0 0 53.973334-45.44c14.421333-18.005333 26.197333-41.898667 35.328-71.765333 9.088-29.824 13.653333-64.128 13.653333-102.826667 0-55.125333-17.536-102.058667-52.650667-140.8 16.426667-41.429333 14.677333-87.893333-5.333333-139.392-12.458667-4.096-30.464-1.578667-54.016 7.509334a355.328 355.328 0 0 0-61.312 30.08L640 271.274667a462.336 462.336 0 0 0-128-17.749334c-43.989333 0-86.656 5.930667-128 17.749334a589.824 589.824 0 0 0-28.330667-18.432c-11.776-7.253333-30.336-16.042667-55.68-26.325334-25.344-10.24-44.416-13.312-57.301333-9.216-19.584 51.498667-21.12 97.962667-4.693333 139.434667-35.114667 38.698667-52.650667 85.632-52.650667 140.757333 0 38.698667 4.565333 72.874667 13.653333 102.485334 9.130667 29.610667 20.778667 53.546667 34.986667 71.765333 14.250667 18.218667 32.128 33.493333 53.674667 45.781333 21.546667 12.288 42.453333 21.205333 62.677333 26.666667 20.224 5.461333 43.008 9.557333 68.309333 12.288-17.749333 16.384-28.629333 39.850667-32.64 70.4a130.005333 130.005333 0 0 1-29.994666 10.24c-10.666667 2.261333-23.338667 3.413333-37.973334 3.413333-14.72 0-29.269333-4.906667-43.690666-14.677333-14.464-9.813333-26.794667-24.064-36.992-42.709333a109.226667 109.226667 0 0 0-32.341334-35.541334c-13.141333-9.130667-24.106667-14.592-33.024-16.426666l-13.312-2.048c-9.344 0-15.786667 1.024-19.328 3.072-3.584 2.090667-4.693333 4.693333-3.328 7.893333 1.28 3.157333 3.328 6.4 5.973334 9.557333 2.688 3.2 5.546667 5.930667 8.661333 8.192l4.693333 3.413334c9.770667 4.565333 19.413333 13.226667 29.013334 25.984 9.514667 12.757333 16.512 24.362667 20.992 34.858666l6.656 15.701334c5.76 17.322667 15.530667 31.317333 29.312 42.026666 13.781333 10.666667 28.672 17.536 44.672 20.48 16 2.986667 31.445333 4.565333 46.336 4.821334 14.890667 0.213333 27.221333-0.597333 36.992-2.389334l15.36-2.730666c0 17.28 0.085333 37.546667 0.298666 60.8l0.341334 36.906666a27.050667 27.050667 0 0 1-8.661334 20.48c-5.76 5.461333-14.677333 7.082667-26.666666 4.778667-103.125333-35.072-187.221333-98.261333-252.330667-189.610667C32.554667 742.058667 0 639.146667 0 524.8c0-95.232 22.869333-183.04 68.693333-263.466667A516.266667 516.266667 0 0 1 254.976 70.4C333.44 23.466667 419.114667 0 512 0c92.885333 0 178.56 23.466667 256.981333 70.4a516.266667 516.266667 0 0 1 186.368 190.976C1001.130667 341.802667 1024 429.653333 1024 524.842667z"></path>
        </svg>
        <svg id="soloKanbanniangClose" viewBox="0 0 1024 1024" width="32" height="32">
            <path d="M517.572566143763 1018.6748601482986C238.26554897656422 1018.6748601482986 11.897910175114305 792.2714997690043 11.897910175114305 513.0002041796496c0-279.3070171671984 226.36763880144977-505.71037754649296 505.6746559686481-505.71037754649296 279.2712955893538 0 505.6746559686481 226.40336037929444 505.6746559686481 505.71037754649296C1023.2472221124112 792.2714997690043 796.8795833109612 1018.6748601482986 517.572566143763 1018.6748601482986zM754.7281214542927 339.25044954334646c13.752807470184345-13.752807470184345 9.680547595895998-40.186775075214015-9.073280772537204-58.94060344364717l-2.143294670678079-2.1075730928334457c-18.7538283684332-18.7538283684332-45.15207439561819-22.861809820566194-58.90488186580257-9.073280772537204l-168.21291007038468 168.24863164822932-180.42968969324974-180.46541127109438c-13.967136937252159-13.967136937252159-40.72259874288353-9.823433907274534-59.72647815622916 9.216167083915742l-2.143294670678079 2.143294670678079c-19.039600991190277 19.003879413345654-23.111860865478626 45.75934121897699-9.180445506071107 59.655035000539876l180.42968969324974 180.46541127109438-176.07165719620428 176.03593561835962c-13.788529048028984 13.824250625873615-9.716269173740633 40.151053497369375 9.073280772537204 58.94060344364717l2.1075730928334457 2.1075730928334457c18.7538283684332 18.7538283684332 45.15207439561819 22.897531398410823 58.90488186580257 9.073280772537204l176.10737877404887-176.10737877404887 170.39192631890742 170.42764789675192c13.967136937252159 13.931415359407513 40.686877165038865 9.85915548511917 59.690756578384516-9.180445506071107l2.1790162485227142-2.1790162485227142c19.039600991190277-18.968157835501014 23.147582443323273-45.72361964113239 9.180445506071107-59.690756578384516l-170.39192631890742-170.42764789675192L754.7281214542927 339.25044954334646z"></path>
        </svg>
    </div>
</div>

    <svg viewBox="0 0 32 32" width="100%" height="100%" class="side__top side__top--toc">
        <path d="M30 18h-28c-1.1 0-2-0.9-2-2s0.9-2 2-2h28c1.1 0 2 0.9 2 2s-0.9 2-2 2zM30 6.25h-28c-1.1 0-2-0.9-2-2s0.9-2 2-2h28c1.1 0 2 0.9 2 2s-0.9 2-2 2zM2 25.75h28c1.1 0 2 0.9 2 2s-0.9 2-2 2h-28c-1.1 0-2-0.9-2-2s0.9-2 2-2z"></path>
    </svg>

<script type="text/javascript">
    Util.addScript('https://forzenfox.github.io/js/page.min.js?1682844075131', 'soloPageScript')
    var page = new Page({
        "commentContentCannotEmptyLabel": "评论不能为空",
        "oId": "1650947125974",
        "blogHost": "https://forzenfox.github.io",
        "randomArticles1Label": "随机阅读：",
        "externalRelevantArticles1Label": "站外相关阅读："
    });
    $(document).ready(function () {
        page.load();
    page.tips.externalRelevantArticlesDisplayCount = "0";
        page.loadRandomArticles('<h3>随机阅读</h3>');
        page.loadRelevantArticles('1650947125974', '<h3>相关阅读</h3>');
    Skin.initArticle()
    });
</script>

</body>
</html>

<!-- Generated by Latke (https://github.com/88250/latke) in 43ms, 2023/05/03 16:48:56 -->