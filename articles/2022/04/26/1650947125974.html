<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/><meta name="theme-color" content="#3b3e43"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no"/><title>Java 8 - CompletableFuture - 佛系码农</title><meta name="description" content="悄悄咪咪写bug的佛系码农"/><meta property="og:description" content="悄悄咪咪写bug的佛系码农"/>    <meta name="keywords" content="Solo,Java,博客,开源"/><link rel="dns-prefetch" href="https://forzenfox.github.io"/><link rel="dns-prefetch" href="https://unpkg.com"/><link rel="preconnect" href="https://forzenfox.github.io"><link rel="icon" type="image/png" href="https://b3log.org/images/brand/solo-128.png"/><link rel="apple-touch-icon" href="https://b3log.org/images/brand/solo-128.png"><link rel="shortcut icon" type="image/x-icon" href="https://b3log.org/images/brand/solo-128.png"><meta name="copyright" content="B3log"/><meta http-equiv="Window-target" content="_top"/><meta property="og:locale" content="zh_CN"/><meta property="og:title" content="Java 8 - CompletableFuture - 佛系码农"/><meta property="og:site_name" content="佛系码农"/><meta property="og:url"      content="https://forzenfox.github.io/articles/2022/04/26/1650947125974.html?"/><meta property="og:image" content="https://b3log.org/images/brand/solo-128.png"/><link rel="search" type="application/opensearchdescription+xml" title="Java 8 - CompletableFuture - 佛系码农" href="/opensearch.xml"><link href="https://forzenfox.github.io/rss.xml" title="RSS" type="application/rss+xml" rel="alternate"/><link rel="manifest" href="https://forzenfox.github.io/manifest.json">        <link rel="canonical" href="https://forzenfox.github.io/articles/2022/04/26/1650947125974.html">        <link rel="stylesheet"
              href="https://forzenfox.github.io/skins/yilia/css/base.css?1691458683705"/>
            <link rel="prev" title="Spring Framework 学习笔记 - Spring 应用上下文生命周期" href="https://forzenfox.github.io/articles/2022/04/02/1648886248605.html">
            <link rel="next" title="如何实现在容器内部限速" href="https://forzenfox.github.io/articles/2023/05/03/1683102869814.html">
    <script src="https://unpkg.com/vditor@3.8.15/dist/js/icons/ant.js" async="" id="vditorIconScript"></script></head>
<body>
<div class="side fn__flex-column">
    <div class="overlay">
        <a onclick="$('.side .toc').show()" href="javascript:void(0)" class="toc-btn">目录</a>
    </div>
    <div class="user__sites">
    <a href="https://ld246.com/member/forzenfox"
       title="https://ld246.com/member/forzenfox"
       class="user__site"
       target="_blank" rel="noopener nofollow">
        <svg viewBox="0 0 32 32" width="100%" height="100%">
            <path fill="#d23f31" style="fill: var(--color1, #d23f31)" d="M5.787 17.226h17.033l5.954 9.528c0.47 0.752 0.003 1.361-1.042 1.361h-15.141z"></path>
            <path d="M10.74 3.927h17.033c1.045 0 1.512 0.609 1.042 1.361l-5.954 9.528h-19.872l6.379-10.209c0.235-0.376 0.849-0.681 1.372-0.681z"></path>
            <path d="M2.953 17.226h2.839l6.804 10.889h-1.892c-0.523 0-1.137-0.305-1.372-0.681z"></path>
        </svg>
    </a>


    </div>
    <header class="content fn__flex-1">
        <a href="https://forzenfox.github.io">
            <img class="avatar" src="https://b3logfile.com/avatar/1636036720949_1636122082221.jpeg?imageView2/1/w/128/h/128/interlace/0/q/100" title="" alt=""/>
        </a>
        <hgroup>
            <h1>
                <a href="https://forzenfox.github.io">佛系码农</a>
            </h1>
        </hgroup>
        <p class="subtitle">
            就是你小子悄悄咪咪把bug写出来的？
        </p>
        <nav>
            <ul>
                <li>
                    <a href="https://forzenfox.github.io/tags.html">标签墙</a>
                    &nbsp; &nbsp;
                    <a href="https://forzenfox.github.io/archives.html">存档</a>
                </li>
            </ul>
        </nav>
    </header>
    <footer>
            <div class="vditor-reset"></div>
        <a rel="alternate" href="https://forzenfox.github.io/rss.xml" title="订阅" class="icon-rss"></a>
    </footer>
        <div class="toc">
            <a onclick="$('.side .toc').hide();" href="javascript:void(0)" class="close">X</a>
<ul class="article__toc">
        <li class="toc__h3">
            <a href="#构建-CompletableFuture">构建 CompletableFuture</a>
        </li>
        <li class="toc__h4">
            <a href="#直接返回计算结果">直接返回计算结果</a>
        </li>
        <li class="toc__h4">
            <a href="#为异步执行的任务构建-CompletableFuture">为异步执行的任务构建 CompletableFuture</a>
        </li>
        <li class="toc__h3">
            <a href="#对计算结果的二次处理">对计算结果的二次处理</a>
        </li>
        <li class="toc__h4">
            <a href="#不改变计算结果的对象类型-仅对结果进行二次增强处理">不改变计算结果的对象类型，仅对结果进行二次增强处理</a>
        </li>
        <li class="toc__h4">
            <a href="#改变计算结果的对象类型-----">改变计算结果的对象类型，CompletableFuture<T> -> CompletableFuture<U></a>
        </li>
        <li class="toc__h4">
            <a href="#消费计算结果-----">消费计算结果，CompletableFuture<T> -> CompletableFuture<Void></a>
        </li>
        <li class="toc__h4">
            <a href="#当两个CompletionStage都正常完成计算的时候-执行提供的-Active">当两个 CompletionStage 都正常完成计算的时候，执行提供的 Active</a>
        </li>
        <li class="toc__h4">
            <a href="#当两个中任意一个-CompletionStage-完成的时候-action这个消费者就会被执行">当两个中任意一个 CompletionStage 完成的时候，action 这个消费者就会被执行</a>
        </li>
        <li class="toc__h4">
            <a href="#applyToEither-和-acceptEither-一定是非阻塞的么-">applyToEither 和 acceptEither 一定是非阻塞的么？</a>
        </li>
        <li class="toc__h3">
            <a href="#在计算步骤链中组合-CompletableFuture">在计算步骤链中组合 CompletableFuture</a>
        </li>
        <li class="toc__h4">
            <a href="#使用-thenCompose-方法将两个-CompletableFuture-顺序链接起来">使用 thenCompose 方法将两个 CompletableFuture 顺序链接起来</a>
        </li>
        <li class="toc__h5">
            <a href="#thenCompose---与-thenApply---的区别">thenCompose() 与 thenApply() 的区别</a>
        </li>
        <li class="toc__h4">
            <a href="#执行两个独立的-CompletableFuture-并对它们的结果做一些事情">执行两个独立的 CompletableFuture 并对它们的结果做一些事情</a>
        </li>
        <li class="toc__h5">
            <a href="#组合两个并行的-CompletionStage--返回一个新的-CompletableFuture">组合两个并行的 CompletionStage， 返回一个新的 CompletableFuture</a>
        </li>
        <li class="toc__h3">
            <a href="#异常处理">异常处理</a>
        </li>
        <li class="toc__h2">
            <a href="#参考文档">参考文档</a>
        </li>
</ul>        </div>
</div>
<main>
    <article class="post">
        <header class="fn__flex">
            <h2 class="fn__flex-1">
                <a rel="bookmark" href="https://forzenfox.github.io/articles/2022/04/26/1650947125974.html">
                    Java 8 - CompletableFuture
                </a>
            </h2>
            <time><span class="icon-date"></span> 2022-04-26</time>
        </header>
        <div class="article__footer fn__flex">
            <span class="icon-tag fn__flex-center"></span>
            <span>&nbsp;&nbsp;&nbsp;</span>
            <div class="tags fn__flex-1 fn__flex-center">
                    <a class="tag" rel="tag" href="https://forzenfox.github.io/tags/java">
                        java</a>
                    <a class="tag" rel="tag" href="https://forzenfox.github.io/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B">
                        多线程</a>
            </div>
            <span>&nbsp;&nbsp;&nbsp;</span>
                <a href="https://forzenfox.github.io/articles/2022/04/26/1650947125974.html#b3logsolocomments"
                   class="vditor-tooltipped__n vditor-tooltipped link fn__flex-center"
                   aria-label="评论">
                    <span data-uvstatcmt="1650947125974">0</span>
                    <span class="icon-chat"></span>
                </a>
            <a class="vditor-tooltipped__n vditor-tooltipped link fn__flex-center"
               href="https://forzenfox.github.io/articles/2022/04/26/1650947125974.html"
               aria-label="浏览">
                <span data-uvstaturl="https://forzenfox.github.io/articles/2022/04/26/1650947125974.html">0</span>
                <span class="icon-views"></span>
            </a>
            <a rel="nofollow" href="https://forzenfox.github.io/authors/1636036911988" class="fn__flex-center">
                <img class="avatar" title="forzenfox" alt="forzenfox"
                     src="https://b3logfile.com/avatar/1636036720949_1636122082221.jpeg?imageView2/1/w/128/h/128/interlace/0/q/100"/>
            </a>
        </div>

        <section class="abstract vditor-reset">
            <p><img src="https://b3logfile.com/bing/20180105.jpg?imageView2/1/w/960/h/540/interlace/1/q/100" alt=""></p>
<h3 id="构建-CompletableFuture">构建 CompletableFuture</h3>
<h4 id="直接返回计算结果">直接返回计算结果</h4>
<p><code>CompletableFuture.completedFuture</code> 是一个静态辅助方法，用来返回一个已经计算好的 CompletableFuture。</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln">1</span><span class="highlight-cl"><span class="highlight-kd">public</span> <span class="highlight-kd">static</span> <span class="highlight-o">&lt;</span><span class="highlight-n">U</span><span class="highlight-o">&gt;</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">U</span><span class="highlight-o">&gt;</span> <span class="highlight-nf">completedFuture</span><span class="highlight-o">(</span><span class="highlight-n">U</span> <span class="highlight-n">value</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">2</span><span class="highlight-cl">    <span class="highlight-k">return</span> <span class="highlight-k">new</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">U</span><span class="highlight-o">&gt;((</span><span class="highlight-n">value</span> <span class="highlight-o">==</span> <span class="highlight-kc">null</span><span class="highlight-o">)</span> <span class="highlight-o">?</span> <span class="highlight-n">NIL</span> <span class="highlight-o">:</span> <span class="highlight-n">value</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">3</span><span class="highlight-cl"><span class="highlight-o">}</span>
</span></span></code></pre>
<p>示例代码：</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln">1</span><span class="highlight-cl">    <span class="highlight-cm">/**
</span></span></span><span class="highlight-line"><span class="highlight-ln">2</span><span class="highlight-cl"><span class="highlight-cm">     * 构建一个直接返回结果结果的 CompletableFuture
</span></span></span><span class="highlight-line"><span class="highlight-ln">3</span><span class="highlight-cl"><span class="highlight-cm">     */</span>
</span></span><span class="highlight-line"><span class="highlight-ln">4</span><span class="highlight-cl">    <span class="highlight-nd">@Test</span>
</span></span><span class="highlight-line"><span class="highlight-ln">5</span><span class="highlight-cl">    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">test_create_completableFuture</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">6</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">String</span><span class="highlight-o">&gt;</span> <span class="highlight-n">strFuture</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">completedFuture</span><span class="highlight-o">(</span><span class="highlight-s">"我是字符串"</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">7</span><span class="highlight-cl">        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"strFuture 计算结果："</span> <span class="highlight-o">+</span> <span class="highlight-n">strFuture</span><span class="highlight-o">.</span><span class="highlight-na">join</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">8</span><span class="highlight-cl">    <span class="highlight-o">}</span>
</span></span></code></pre>
<h4 id="为异步执行的任务构建-CompletableFuture">为异步执行的任务构建 CompletableFuture</h4>
<p>使用下面这组静态方法，为创建一个异步执行的 <code>CompletableFuture</code></p>
<ul>
<li>
<p>无返回值的</p>
<ul>
<li>CompletableFuture#runAsync(Runnable)</li>
<li>CompletableFuture#runAsync(Runnable, Executor)</li>
</ul>
<p>示例代码：</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln"> 1</span><span class="highlight-cl">    <span class="highlight-cm">/**
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 2</span><span class="highlight-cl"><span class="highlight-cm">     * 构建无返回值的 {@link CompletableFuture}
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 3</span><span class="highlight-cl"><span class="highlight-cm">     *
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 4</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#runAsync(Runnable)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 5</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#runAsync(Runnable, Executor)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 6</span><span class="highlight-cl"><span class="highlight-cm">     */</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 7</span><span class="highlight-cl">    <span class="highlight-nd">@Test</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 8</span><span class="highlight-cl">    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">create_completableFuture_by_runAsync</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 9</span><span class="highlight-cl">        <span class="highlight-c1">// 默认使用 ForkJoinPool.commonPool() 作为它的线程池执行异步代码
</span></span></span><span class="highlight-line"><span class="highlight-ln">10</span><span class="highlight-cl"><span class="highlight-c1"></span>        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">Void</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future_01</span> <span class="highlight-o">=</span>
</span></span><span class="highlight-line"><span class="highlight-ln">11</span><span class="highlight-cl">                <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">runAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"Thread:%s\n"</span><span class="highlight-o">,</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">()));</span>
</span></span><span class="highlight-line"><span class="highlight-ln">12</span><span class="highlight-cl">        <span class="highlight-c1">// 使用指定线程池作为它的线程池执行异步代码
</span></span></span><span class="highlight-line"><span class="highlight-ln">13</span><span class="highlight-cl"><span class="highlight-c1"></span>        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">Void</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future_02</span> <span class="highlight-o">=</span>
</span></span><span class="highlight-line"><span class="highlight-ln">14</span><span class="highlight-cl">                <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">runAsync</span><span class="highlight-o">(</span>
</span></span><span class="highlight-line"><span class="highlight-ln">15</span><span class="highlight-cl">                        <span class="highlight-o">()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"Thread:%s\n"</span><span class="highlight-o">,</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">()),</span>
</span></span><span class="highlight-line"><span class="highlight-ln">16</span><span class="highlight-cl">                        <span class="highlight-n">FIXED_THREAD_POOL</span>
</span></span><span class="highlight-line"><span class="highlight-ln">17</span><span class="highlight-cl">                <span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">18</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">19</span><span class="highlight-cl">        <span class="highlight-n">future_01</span><span class="highlight-o">.</span><span class="highlight-na">join</span><span class="highlight-o">();</span>
</span></span><span class="highlight-line"><span class="highlight-ln">20</span><span class="highlight-cl">        <span class="highlight-n">future_02</span><span class="highlight-o">.</span><span class="highlight-na">join</span><span class="highlight-o">();</span>
</span></span><span class="highlight-line"><span class="highlight-ln">21</span><span class="highlight-cl">    <span class="highlight-o">}</span>
</span></span></code></pre>
<p>执行结果：</p>
<blockquote>
<p>Thread:ForkJoinPool.commonPool-worker-1<br>
Thread:pool-1-thread-1</p>
</blockquote>
</li>
<li>
<p>有返回值的</p>
<ul>
<li>CompletableFuture#supplyAsync(Supplier)</li>
<li>CompletableFuture#supplyAsync(Supplier, Executor)</li>
</ul>
<p>示例代码：</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln"> 1</span><span class="highlight-cl">    <span class="highlight-cm">/**
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 2</span><span class="highlight-cl"><span class="highlight-cm">     * 构建有返回值的 {@link CompletableFuture}
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 3</span><span class="highlight-cl"><span class="highlight-cm">     *
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 4</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#supplyAsync(Supplier)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 5</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#supplyAsync(Supplier, Executor)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 6</span><span class="highlight-cl"><span class="highlight-cm">     */</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 7</span><span class="highlight-cl">    <span class="highlight-nd">@Test</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 8</span><span class="highlight-cl">    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">create_completableFuture_by_supplyAsync</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 9</span><span class="highlight-cl">        <span class="highlight-c1">// 默认使用 ForkJoinPool.commonPool() 作为它的线程池执行异步代码
</span></span></span><span class="highlight-line"><span class="highlight-ln">10</span><span class="highlight-cl"><span class="highlight-c1"></span>        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">String</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future_01</span> <span class="highlight-o">=</span>
</span></span><span class="highlight-line"><span class="highlight-ln">11</span><span class="highlight-cl">                <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-n">String</span><span class="highlight-o">.</span><span class="highlight-na">format</span><span class="highlight-o">(</span><span class="highlight-s">"future_01 执行线程:%s"</span><span class="highlight-o">,</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">()));</span>
</span></span><span class="highlight-line"><span class="highlight-ln">12</span><span class="highlight-cl">        <span class="highlight-c1">// 使用指定线程池作为它的线程池执行异步代码
</span></span></span><span class="highlight-line"><span class="highlight-ln">13</span><span class="highlight-cl"><span class="highlight-c1"></span>        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">String</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future_02</span> <span class="highlight-o">=</span>
</span></span><span class="highlight-line"><span class="highlight-ln">14</span><span class="highlight-cl">                <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(</span>
</span></span><span class="highlight-line"><span class="highlight-ln">15</span><span class="highlight-cl">                        <span class="highlight-o">()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-n">String</span><span class="highlight-o">.</span><span class="highlight-na">format</span><span class="highlight-o">(</span><span class="highlight-s">"future_02 执行线程:%s"</span><span class="highlight-o">,</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">()),</span>
</span></span><span class="highlight-line"><span class="highlight-ln">16</span><span class="highlight-cl">                        <span class="highlight-n">FIXED_THREAD_POOL</span>
</span></span><span class="highlight-line"><span class="highlight-ln">17</span><span class="highlight-cl">                <span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">18</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">19</span><span class="highlight-cl">        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-n">future_01</span><span class="highlight-o">.</span><span class="highlight-na">join</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">20</span><span class="highlight-cl">        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-n">future_02</span><span class="highlight-o">.</span><span class="highlight-na">join</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">21</span><span class="highlight-cl">    <span class="highlight-o">}</span>
</span></span></code></pre>
<p>执行结果：</p>
<blockquote>
<p>future_01 执行线程:ForkJoinPool.commonPool-worker-1<br>
future_02 执行线程:pool-1-thread-1</p>
</blockquote>
</li>
</ul>
<p><strong>注：根据方法入参规律性理解功能</strong></p>
<ul>
<li>入参为 <code>java.lang.Runnable</code> 的方法表明无需入参也无返回值</li>
<li>入参为 <code>java.util.function.Supplier</code> 的方法表明无需入参但是有返回值</li>
<li>入参多一个 <code>java.util.concurrent.Executor</code> 的方法表明把任务提交到指定线程池执行</li>
</ul>
<h3 id="对计算结果的二次处理">对计算结果的二次处理</h3>
<h4 id="不改变计算结果的对象类型-仅对结果进行二次增强处理">不改变计算结果的对象类型，仅对结果进行二次增强处理</h4>
<ul>
<li>
<p>当 <code>CompletableFuture</code> 的计算完成或发生异常时，在同一线程中执行特定的 Action</p>
<p><font color="red">同一线程指与调用 <code>CompletableFuture#whenComplete</code> 的 CompletableFuture 实例任务执行的线程</font></p>
<blockquote>
<p>CompletableFuture#whenComplete(BiConsumer)</p>
</blockquote>
</li>
<li>
<p>当 <code>CompletableFuture</code> 的计算完成或发生异常时，另起一个线程执行特定的 Action</p>
<blockquote>
<p>CompletableFuture#whenCompleteAsync(BiConsumer)</p>
<p>CompletableFuture#whenCompleteAsync(BiConsumer, Executor)</p>
</blockquote>
</li>
</ul>
<p>示例代码:</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln"> 1</span><span class="highlight-cl">    <span class="highlight-cm">/**
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 2</span><span class="highlight-cl"><span class="highlight-cm">     * 当 {@link CompletableFuture} 的计算结果完成，在同一线程中执行特定的 Action
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 3</span><span class="highlight-cl"><span class="highlight-cm">     * &lt;br&gt;
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 4</span><span class="highlight-cl"><span class="highlight-cm">     * &lt;font color="red"&gt;同一线程指与调用 {@link CompletableFuture#whenComplete} 的 {@link CompletableFuture} 实例任务执行的线程&lt;/font&gt;
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 5</span><span class="highlight-cl"><span class="highlight-cm">     *
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 6</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#whenComplete(BiConsumer)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 7</span><span class="highlight-cl"><span class="highlight-cm">     */</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 8</span><span class="highlight-cl">    <span class="highlight-nd">@Test</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 9</span><span class="highlight-cl">    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">test_process_result_with_sync</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">10</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">String</span><span class="highlight-o">&gt;</span> <span class="highlight-n">resultFutureOfMainThread</span> <span class="highlight-o">=</span>
</span></span><span class="highlight-line"><span class="highlight-ln">11</span><span class="highlight-cl">                <span class="highlight-c1">// 执行线程: ForkJoinPool.commonPool-worker-1
</span></span></span><span class="highlight-line"><span class="highlight-ln">12</span><span class="highlight-cl"><span class="highlight-c1"></span>                <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">13</span><span class="highlight-cl">                            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"base future end,Thread:%s\n"</span><span class="highlight-o">,</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">14</span><span class="highlight-cl">                            <span class="highlight-k">return</span> <span class="highlight-s">"whenComplete method"</span><span class="highlight-o">;</span>
</span></span><span class="highlight-line"><span class="highlight-ln">15</span><span class="highlight-cl">                        <span class="highlight-o">})</span>
</span></span><span class="highlight-line"><span class="highlight-ln">16</span><span class="highlight-cl">                        <span class="highlight-c1">// 执行线程: pool-1-thread-1
</span></span></span><span class="highlight-line"><span class="highlight-ln">17</span><span class="highlight-cl"><span class="highlight-c1"></span>                        <span class="highlight-o">.</span><span class="highlight-na">whenCompleteAsync</span><span class="highlight-o">(</span><span class="highlight-n">ACTION</span><span class="highlight-o">,</span> <span class="highlight-n">FIXED_THREAD_POOL</span><span class="highlight-o">)</span>
</span></span><span class="highlight-line"><span class="highlight-ln">18</span><span class="highlight-cl">                        <span class="highlight-c1">// 执行线程: pool-1-thread-1
</span></span></span><span class="highlight-line"><span class="highlight-ln">19</span><span class="highlight-cl"><span class="highlight-c1"></span>                        <span class="highlight-o">.</span><span class="highlight-na">whenComplete</span><span class="highlight-o">(</span><span class="highlight-n">ACTION</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">20</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">21</span><span class="highlight-cl">        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-n">resultFutureOfMainThread</span><span class="highlight-o">.</span><span class="highlight-na">join</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">22</span><span class="highlight-cl">    <span class="highlight-o">}</span>
</span></span></code></pre>
<p>执行结果：</p>
<blockquote>
<p>base future end,Thread:ForkJoinPool.commonPool-worker-1<br>
执行线程: pool-1-thread-1, 执行方法: whenComplete method , 发生异常: [null]<br>
执行线程: pool-1-thread-1, 执行方法: whenComplete method , 发生异常: [null]<br>
whenComplete method</p>
</blockquote>
<h4 id="改变计算结果的对象类型-----">改变计算结果的对象类型，<code>CompletableFuture&lt;T&gt;</code> -&gt; <code>CompletableFuture&lt;U&gt;</code></h4>
<p>当原来的 CompletableFuture 计算完后，将结果传递给函数 fn，将 fn 的结果作为新的 CompletableFuture 计算结果</p>
<ul>
<li>
<p>无法处理异常</p>
<ul>
<li>CompletableFuture#thenApply(Function)</li>
<li>CompletableFuture#thenApplyAsync(Function)</li>
<li>CompletableFuture#thenApplyAsync(Function, Executor)</li>
</ul>
<p>示例代码：</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln"> 1</span><span class="highlight-cl">    <span class="highlight-cm">/**
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 2</span><span class="highlight-cl"><span class="highlight-cm">     * 当原来的 CompletableFuture 计算完后，将结果传递给函数fn，将fn的结果作为新的 CompletableFuture 计算结果
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 3</span><span class="highlight-cl"><span class="highlight-cm">     * &lt;br&gt;
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 4</span><span class="highlight-cl"><span class="highlight-cm">     * {@code CompletableFuture&lt;T&gt; } -&gt; {@code CompletableFuture&lt;U&gt;}
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 5</span><span class="highlight-cl"><span class="highlight-cm">     * &lt;br&gt;
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 6</span><span class="highlight-cl"><span class="highlight-cm">     * &lt;font color="red"&gt;
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 7</span><span class="highlight-cl"><span class="highlight-cm">     * 与 {@link CompletableFuture#handle(BiFunction)} 的区别:  {@link CompletableFuture#thenApply(Function)}
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 8</span><span class="highlight-cl"><span class="highlight-cm">     * 不处理异常,一旦发生异常会抛出
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 9</span><span class="highlight-cl"><span class="highlight-cm">     * &lt;/font&gt;
</span></span></span><span class="highlight-line"><span class="highlight-ln">10</span><span class="highlight-cl"><span class="highlight-cm">     *
</span></span></span><span class="highlight-line"><span class="highlight-ln">11</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#thenApply(Function)
</span></span></span><span class="highlight-line"><span class="highlight-ln">12</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#thenApplyAsync(Function)
</span></span></span><span class="highlight-line"><span class="highlight-ln">13</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#thenApplyAsync(Function, Executor)
</span></span></span><span class="highlight-line"><span class="highlight-ln">14</span><span class="highlight-cl"><span class="highlight-cm">     */</span>
</span></span><span class="highlight-line"><span class="highlight-ln">15</span><span class="highlight-cl">    <span class="highlight-nd">@Test</span>
</span></span><span class="highlight-line"><span class="highlight-ln">16</span><span class="highlight-cl">    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">test_thenApply_method</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">17</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">Integer</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">completedFuture</span><span class="highlight-o">(</span><span class="highlight-s">"我是字符串"</span><span class="highlight-o">)</span>
</span></span><span class="highlight-line"><span class="highlight-ln">18</span><span class="highlight-cl">                <span class="highlight-o">.</span><span class="highlight-na">thenApply</span><span class="highlight-o">(</span><span class="highlight-n">v</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">19</span><span class="highlight-cl">                    <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"原始计算结果: %s,当前线程: %s \n"</span><span class="highlight-o">,</span> <span class="highlight-n">v</span><span class="highlight-o">,</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">20</span><span class="highlight-cl">                    <span class="highlight-k">return</span> <span class="highlight-n">v</span><span class="highlight-o">.</span><span class="highlight-na">length</span><span class="highlight-o">();</span>
</span></span><span class="highlight-line"><span class="highlight-ln">21</span><span class="highlight-cl">                <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">22</span><span class="highlight-cl">        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"最终 CompletableFuture 结果: %s \n"</span><span class="highlight-o">,</span> <span class="highlight-n">future</span><span class="highlight-o">.</span><span class="highlight-na">join</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">23</span><span class="highlight-cl">    <span class="highlight-o">}</span>
</span></span></code></pre>
<p>执行结果：</p>
<blockquote>
<p>原始计算结果: 我是字符串,当前线程: main<br>
最终 CompletableFuture 结果: 5</p>
</blockquote>
</li>
<li>
<p>能处理异常</p>
<ul>
<li>CompletableFuture#handle(BiFunction)</li>
<li>CompletableFuture#handleAsync(BiFunction)</li>
<li>CompletableFuture#handleAsync(BiFunction, Executor)</li>
</ul>
<p>示例代码：</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln"> 1</span><span class="highlight-cl">    <span class="highlight-cm">/**
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 2</span><span class="highlight-cl"><span class="highlight-cm">     * {@link CompletableFuture#handle} 处理异常的实例代码
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 3</span><span class="highlight-cl"><span class="highlight-cm">     */</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 4</span><span class="highlight-cl">    <span class="highlight-nd">@Test</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 5</span><span class="highlight-cl">    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">test_handle_process_exception</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 6</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">String</span><span class="highlight-o">&gt;</span> <span class="highlight-n">baseFuture</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 7</span><span class="highlight-cl">            <span class="highlight-k">if</span> <span class="highlight-o">(</span><span class="highlight-kc">true</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 8</span><span class="highlight-cl">                <span class="highlight-k">throw</span> <span class="highlight-k">new</span> <span class="highlight-n">RuntimeException</span><span class="highlight-o">(</span><span class="highlight-s">"我故意的,嘻嘻"</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 9</span><span class="highlight-cl">            <span class="highlight-o">}</span>
</span></span><span class="highlight-line"><span class="highlight-ln">10</span><span class="highlight-cl">            <span class="highlight-k">return</span> <span class="highlight-s">"我是字符串"</span><span class="highlight-o">;</span>
</span></span><span class="highlight-line"><span class="highlight-ln">11</span><span class="highlight-cl">        <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">12</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">13</span><span class="highlight-cl">        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"handle : "</span> <span class="highlight-o">+</span>
</span></span><span class="highlight-line"><span class="highlight-ln">14</span><span class="highlight-cl">                <span class="highlight-n">baseFuture</span><span class="highlight-o">.</span><span class="highlight-na">handle</span><span class="highlight-o">((</span><span class="highlight-n">v</span><span class="highlight-o">,</span> <span class="highlight-n">e</span><span class="highlight-o">)</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">15</span><span class="highlight-cl">                            <span class="highlight-k">if</span> <span class="highlight-o">(</span><span class="highlight-n">Objects</span><span class="highlight-o">.</span><span class="highlight-na">nonNull</span><span class="highlight-o">(</span><span class="highlight-n">e</span><span class="highlight-o">))</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">16</span><span class="highlight-cl">                                <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"handle 基础 Future 计算发生异常: [%s], 执行线程: [%s] \n"</span><span class="highlight-o">,</span>
</span></span><span class="highlight-line"><span class="highlight-ln">17</span><span class="highlight-cl">                                        <span class="highlight-n">e</span><span class="highlight-o">.</span><span class="highlight-na">getMessage</span><span class="highlight-o">(),</span>
</span></span><span class="highlight-line"><span class="highlight-ln">18</span><span class="highlight-cl">                                        <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">19</span><span class="highlight-cl">                                <span class="highlight-k">return</span> <span class="highlight-n">e</span><span class="highlight-o">.</span><span class="highlight-na">getMessage</span><span class="highlight-o">().</span><span class="highlight-na">length</span><span class="highlight-o">();</span>
</span></span><span class="highlight-line"><span class="highlight-ln">20</span><span class="highlight-cl">                            <span class="highlight-o">}</span>
</span></span><span class="highlight-line"><span class="highlight-ln">21</span><span class="highlight-cl">                            <span class="highlight-k">return</span> <span class="highlight-n">v</span><span class="highlight-o">.</span><span class="highlight-na">length</span><span class="highlight-o">();</span>
</span></span><span class="highlight-line"><span class="highlight-ln">22</span><span class="highlight-cl">                        <span class="highlight-o">})</span>
</span></span><span class="highlight-line"><span class="highlight-ln">23</span><span class="highlight-cl">                        <span class="highlight-o">.</span><span class="highlight-na">join</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">24</span><span class="highlight-cl">    <span class="highlight-o">}</span>
</span></span></code></pre>
<p>执行结果：</p>
<blockquote>
<p>handle 基础 Future 计算发生异常: [java.lang.RuntimeException: 我故意的,嘻嘻], 执行线程: [ForkJoinPool.commonPool-worker-1]<br>
handle : 35</p>
</blockquote>
</li>
</ul>
<p><code>CompletableFuture#handle</code> 对比 <code>CompletableFuture#thenApply</code>：</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln"> 1</span><span class="highlight-cl">    <span class="highlight-cm">/**
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 2</span><span class="highlight-cl"><span class="highlight-cm">     * 对比 {@link CompletableFuture#thenApply} 和 {@link CompletableFuture#handle} 处理异常的差异
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 3</span><span class="highlight-cl"><span class="highlight-cm">     */</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 4</span><span class="highlight-cl">    <span class="highlight-nd">@Test</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 5</span><span class="highlight-cl">    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">test_thenApply_and_handle_method_when_occur_exception</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 6</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">String</span><span class="highlight-o">&gt;</span> <span class="highlight-n">baseFuture</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 7</span><span class="highlight-cl">            <span class="highlight-k">if</span> <span class="highlight-o">(</span><span class="highlight-kc">true</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 8</span><span class="highlight-cl">                <span class="highlight-k">throw</span> <span class="highlight-k">new</span> <span class="highlight-n">RuntimeException</span><span class="highlight-o">(</span><span class="highlight-s">"我故意的,嘻嘻"</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 9</span><span class="highlight-cl">            <span class="highlight-o">}</span>
</span></span><span class="highlight-line"><span class="highlight-ln">10</span><span class="highlight-cl">            <span class="highlight-k">return</span> <span class="highlight-s">"我是字符串"</span><span class="highlight-o">;</span>
</span></span><span class="highlight-line"><span class="highlight-ln">11</span><span class="highlight-cl">        <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">12</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">13</span><span class="highlight-cl">        <span class="highlight-k">try</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">14</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"thenApply : "</span> <span class="highlight-o">+</span> <span class="highlight-n">baseFuture</span><span class="highlight-o">.</span><span class="highlight-na">thenApply</span><span class="highlight-o">(</span><span class="highlight-n">String</span><span class="highlight-o">::</span><span class="highlight-n">length</span><span class="highlight-o">).</span><span class="highlight-na">join</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">15</span><span class="highlight-cl">        <span class="highlight-o">}</span> <span class="highlight-k">catch</span> <span class="highlight-o">(</span><span class="highlight-n">Exception</span> <span class="highlight-n">e</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">16</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"thenApply 基础 Future 计算发生异常 :"</span> <span class="highlight-o">+</span> <span class="highlight-n">e</span><span class="highlight-o">.</span><span class="highlight-na">getMessage</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">17</span><span class="highlight-cl">        <span class="highlight-o">}</span>
</span></span><span class="highlight-line"><span class="highlight-ln">18</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">19</span><span class="highlight-cl">        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"handle : "</span> <span class="highlight-o">+</span>
</span></span><span class="highlight-line"><span class="highlight-ln">20</span><span class="highlight-cl">                <span class="highlight-n">baseFuture</span><span class="highlight-o">.</span><span class="highlight-na">handle</span><span class="highlight-o">((</span><span class="highlight-n">v</span><span class="highlight-o">,</span> <span class="highlight-n">e</span><span class="highlight-o">)</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">21</span><span class="highlight-cl">                            <span class="highlight-k">if</span> <span class="highlight-o">(</span><span class="highlight-n">Objects</span><span class="highlight-o">.</span><span class="highlight-na">nonNull</span><span class="highlight-o">(</span><span class="highlight-n">e</span><span class="highlight-o">))</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">22</span><span class="highlight-cl">                                <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"handle 基础 Future 计算发生异常: "</span> <span class="highlight-o">+</span> <span class="highlight-n">e</span><span class="highlight-o">.</span><span class="highlight-na">getMessage</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">23</span><span class="highlight-cl">                                <span class="highlight-k">return</span> <span class="highlight-n">e</span><span class="highlight-o">.</span><span class="highlight-na">getMessage</span><span class="highlight-o">().</span><span class="highlight-na">length</span><span class="highlight-o">();</span>
</span></span><span class="highlight-line"><span class="highlight-ln">24</span><span class="highlight-cl">                            <span class="highlight-o">}</span>
</span></span><span class="highlight-line"><span class="highlight-ln">25</span><span class="highlight-cl">                            <span class="highlight-k">return</span> <span class="highlight-n">v</span><span class="highlight-o">.</span><span class="highlight-na">length</span><span class="highlight-o">();</span>
</span></span><span class="highlight-line"><span class="highlight-ln">26</span><span class="highlight-cl">                        <span class="highlight-o">})</span>
</span></span><span class="highlight-line"><span class="highlight-ln">27</span><span class="highlight-cl">                        <span class="highlight-o">.</span><span class="highlight-na">join</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">28</span><span class="highlight-cl">    <span class="highlight-o">}</span>
</span></span></code></pre>
<p>执行结果：</p>
<blockquote>
<p>thenApply 基础 Future 计算发生异常 :java.lang.RuntimeException: 我故意的,嘻嘻<br>
handle 基础 Future 计算发生异常: java.lang.RuntimeException: 我故意的,嘻嘻<br>
handle : 35</p>
</blockquote>
<p>由执行结果可知，<code>thenApply</code> 方法并无处理异常的能力，而 <code>handle</code> 确能够处理异常，保证结果正常返回。</p>
<h4 id="消费计算结果-----">消费计算结果，<code>CompletableFuture&lt;T&gt;</code> -&gt; <code>CompletableFuture&lt;Void&gt;</code></h4>
<ul>
<li>
<p>有入参的（把计算结果作为方法入参）</p>
<ul>
<li>CompletableFuture#thenAccept(Consumer)</li>
<li>CompletableFuture#thenAcceptAsync(Consumer)</li>
<li>CompletableFuture#thenAcceptAsync(Consumer, Executor)</li>
</ul>
<p>示例代码：</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln"> 1</span><span class="highlight-cl">    <span class="highlight-cm">/**
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 2</span><span class="highlight-cl"><span class="highlight-cm">     * 只对结果执行 Action ,而不返回新地计算值，因此计算值为 {@link Void}
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 3</span><span class="highlight-cl"><span class="highlight-cm">     *
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 4</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#thenAccept(Consumer)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 5</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#thenAcceptAsync(Consumer)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 6</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#thenAcceptAsync(Consumer, Executor)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 7</span><span class="highlight-cl"><span class="highlight-cm">     */</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 8</span><span class="highlight-cl">    <span class="highlight-nd">@Test</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 9</span><span class="highlight-cl">    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">test_thenAccept_method</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">10</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">Void</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">completedFuture</span><span class="highlight-o">(</span><span class="highlight-s">"我是字符串"</span><span class="highlight-o">)</span>
</span></span><span class="highlight-line"><span class="highlight-ln">11</span><span class="highlight-cl">                <span class="highlight-o">.</span><span class="highlight-na">thenAccept</span><span class="highlight-o">(</span><span class="highlight-n">v</span> <span class="highlight-o">-&gt;</span> <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"结果输出: [%s], 执行线程: [%s]"</span><span class="highlight-o">,</span>
</span></span><span class="highlight-line"><span class="highlight-ln">12</span><span class="highlight-cl">                        <span class="highlight-n">v</span><span class="highlight-o">.</span><span class="highlight-na">concat</span><span class="highlight-o">(</span><span class="highlight-s">",嘻嘻"</span><span class="highlight-o">),</span>
</span></span><span class="highlight-line"><span class="highlight-ln">13</span><span class="highlight-cl">                        <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">()));</span>
</span></span><span class="highlight-line"><span class="highlight-ln">14</span><span class="highlight-cl">    <span class="highlight-o">}</span>
</span></span></code></pre>
<p>执行结果：</p>
<blockquote>
<p>结果输出: [我是字符串,嘻嘻], 执行线程: [main]</p>
</blockquote>
</li>
<li>
<p>无入参的</p>
<ul>
<li>CompletableFuture#thenRun(Runnable)</li>
<li>CompletableFuture#thenRunAsync(Runnable)</li>
<li>CompletableFuture#thenRunAsync(Runnable, Executor)</li>
</ul>
<p>示例代码：</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln"> 1</span><span class="highlight-cl">    <span class="highlight-cm">/**
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 2</span><span class="highlight-cl"><span class="highlight-cm">     * 当计算完成的时候会执行一个 {@link Runnable} ,与 {@link CompletableFuture#thenAccept} 不同，{@link Runnable} 并不使用
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 3</span><span class="highlight-cl"><span class="highlight-cm">     * {@link CompletableFuture} 计算的结果
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 4</span><span class="highlight-cl"><span class="highlight-cm">     *
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 5</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#thenRun(Runnable)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 6</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#thenRunAsync(Runnable)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 7</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#thenRunAsync(Runnable, Executor)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 8</span><span class="highlight-cl"><span class="highlight-cm">     */</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 9</span><span class="highlight-cl">    <span class="highlight-nd">@Test</span>
</span></span><span class="highlight-line"><span class="highlight-ln">10</span><span class="highlight-cl">    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">test_thenRun_method</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">11</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">Void</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">completedFuture</span><span class="highlight-o">(</span><span class="highlight-s">"我是字符串"</span><span class="highlight-o">)</span>
</span></span><span class="highlight-line"><span class="highlight-ln">12</span><span class="highlight-cl">                <span class="highlight-o">.</span><span class="highlight-na">thenRunAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"thenRunAsync 计算，执行线程: [%s]"</span><span class="highlight-o">,</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">()));</span>
</span></span><span class="highlight-line"><span class="highlight-ln">13</span><span class="highlight-cl">    <span class="highlight-o">}</span>
</span></span></code></pre>
<p>执行结果：</p>
<blockquote>
<p>thenRunAsync 计算，执行线程: [ForkJoinPool.commonPool-worker-1]</p>
</blockquote>
</li>
</ul>
<h4 id="当两个CompletionStage都正常完成计算的时候-执行提供的-Active">当两个 CompletionStage 都正常完成计算的时候，执行提供的 Active</h4>
<ul>
<li>
<p>有入参的（两个 CompletionStage 的计算结果作为入参）</p>
<ul>
<li>CompletableFuture#thenAcceptBoth(CompletionStage, BiConsumer)</li>
<li>CompletableFuture#thenAcceptBothAsync(CompletionStage, BiConsumer)</li>
<li>CompletableFuture#thenAcceptBothAsync(CompletionStage, BiConsumer, Executor)</li>
</ul>
<p>示例代码：</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln"> 1</span><span class="highlight-cl">   <span class="highlight-cm">/**
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 2</span><span class="highlight-cl"><span class="highlight-cm">     * 当两个 {@link CompletionStage} 都正常完成计算的时候，就会执行提供的 {@link BiConsumer} ，它用来组合另外一个异步的结果
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 3</span><span class="highlight-cl"><span class="highlight-cm">     *
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 4</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#thenAcceptBoth(CompletionStage, BiConsumer)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 5</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#thenAcceptBothAsync(CompletionStage, BiConsumer)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 6</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#thenAcceptBothAsync(CompletionStage, BiConsumer, Executor)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 7</span><span class="highlight-cl"><span class="highlight-cm">     */</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 8</span><span class="highlight-cl">    <span class="highlight-nd">@Test</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 9</span><span class="highlight-cl">    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">test_thenAcceptBoth_method</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">10</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">String</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future_01</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">11</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"future_01 执行线程："</span> <span class="highlight-o">+</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">12</span><span class="highlight-cl">            <span class="highlight-k">return</span> <span class="highlight-s">"你好,"</span><span class="highlight-o">;</span>
</span></span><span class="highlight-line"><span class="highlight-ln">13</span><span class="highlight-cl">        <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">14</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">String</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future_02</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">15</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"future_02 执行线程："</span> <span class="highlight-o">+</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">16</span><span class="highlight-cl">            <span class="highlight-k">return</span> <span class="highlight-s">"java 8"</span><span class="highlight-o">;</span>
</span></span><span class="highlight-line"><span class="highlight-ln">17</span><span class="highlight-cl">        <span class="highlight-o">},</span> <span class="highlight-n">FIXED_THREAD_POOL</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">18</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">19</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">Void</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future</span> <span class="highlight-o">=</span> <span class="highlight-n">future_01</span><span class="highlight-o">.</span><span class="highlight-na">thenAcceptBoth</span><span class="highlight-o">(</span><span class="highlight-n">future_02</span><span class="highlight-o">,</span>
</span></span><span class="highlight-line"><span class="highlight-ln">20</span><span class="highlight-cl">                <span class="highlight-o">(</span><span class="highlight-n">future_01_value</span><span class="highlight-o">,</span> <span class="highlight-n">future_02_value</span><span class="highlight-o">)</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">21</span><span class="highlight-cl">                    <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"future_01 是否执行完毕: %s, future_02 是否执行完毕: %s \n"</span><span class="highlight-o">,</span>
</span></span><span class="highlight-line"><span class="highlight-ln">22</span><span class="highlight-cl">                            <span class="highlight-n">future_01</span><span class="highlight-o">.</span><span class="highlight-na">isDone</span><span class="highlight-o">(),</span>
</span></span><span class="highlight-line"><span class="highlight-ln">23</span><span class="highlight-cl">                            <span class="highlight-n">future_02</span><span class="highlight-o">.</span><span class="highlight-na">isDone</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">24</span><span class="highlight-cl">                    <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"执行线程：%s, 结果：%s \n"</span><span class="highlight-o">,</span>
</span></span><span class="highlight-line"><span class="highlight-ln">25</span><span class="highlight-cl">                            <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">(),</span>
</span></span><span class="highlight-line"><span class="highlight-ln">26</span><span class="highlight-cl">                            <span class="highlight-n">future_01_value</span><span class="highlight-o">.</span><span class="highlight-na">concat</span><span class="highlight-o">(</span><span class="highlight-n">future_02_value</span><span class="highlight-o">));</span>
</span></span><span class="highlight-line"><span class="highlight-ln">27</span><span class="highlight-cl">                <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">28</span><span class="highlight-cl">    <span class="highlight-o">}</span>
</span></span></code></pre>
<p>执行结果：</p>
<blockquote>
<p>future_01 执行线程：ForkJoinPool.commonPool-worker-1<br>
future_02 执行线程：pool-1-thread-1<br>
future_01 是否执行完毕: true, future_02 是否执行完毕: true<br>
执行线程：main, 结果：你好,java 8</p>
</blockquote>
<p><strong>由执行结果可知：</strong></p>
<ol>
<li>thenAcceptBoth 方法需要等待依赖的两个 CompletionStage 均执行完毕才会执行</li>
<li>thenAcceptBoth 方法并非使用 future_01 的执行线程执行，而是使用 main 线程执行</li>
</ol>
</li>
<li>
<p>无入参的</p>
<ul>
<li>CompletableFuture#runAfterBoth(CompletionStage, Runnable)</li>
<li>CompletableFuture#runAfterBothAsync(CompletionStage, Runnable)</li>
<li>CompletableFuture#runAfterBothAsync(CompletionStage, Runnable, Executor)</li>
</ul>
<p>示例代码：</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln"> 1</span><span class="highlight-cl">    <span class="highlight-cm">/**
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 2</span><span class="highlight-cl"><span class="highlight-cm">     * 当两个 {@link CompletionStage} 都正常完成计算的时候,执行一个 {@link Runnable}，这个 {@link Runnable} 并不使用计算的结果
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 3</span><span class="highlight-cl"><span class="highlight-cm">     *
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 4</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#runAfterBoth(CompletionStage, Runnable)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 5</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#runAfterBothAsync(CompletionStage, Runnable)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 6</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#runAfterBothAsync(CompletionStage, Runnable, Executor)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 7</span><span class="highlight-cl"><span class="highlight-cm">     */</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 8</span><span class="highlight-cl">    <span class="highlight-nd">@Test</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 9</span><span class="highlight-cl">    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">test_runAfterBoth_method</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">10</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">String</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future_01</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">11</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"future_01 计算,执行线程: "</span> <span class="highlight-o">+</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">12</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">13</span><span class="highlight-cl">            <span class="highlight-k">try</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">14</span><span class="highlight-cl">                <span class="highlight-n">TimeUnit</span><span class="highlight-o">.</span><span class="highlight-na">SECONDS</span><span class="highlight-o">.</span><span class="highlight-na">sleep</span><span class="highlight-o">(</span><span class="highlight-mi">10</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">15</span><span class="highlight-cl">            <span class="highlight-o">}</span> <span class="highlight-k">catch</span> <span class="highlight-o">(</span><span class="highlight-n">InterruptedException</span> <span class="highlight-n">e</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">16</span><span class="highlight-cl">                <span class="highlight-k">throw</span> <span class="highlight-k">new</span> <span class="highlight-n">RuntimeException</span><span class="highlight-o">(</span><span class="highlight-n">e</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">17</span><span class="highlight-cl">            <span class="highlight-o">}</span>
</span></span><span class="highlight-line"><span class="highlight-ln">18</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">19</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"future_01 计算完毕"</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">20</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">21</span><span class="highlight-cl">            <span class="highlight-k">return</span> <span class="highlight-s">"future_01 计算"</span><span class="highlight-o">;</span>
</span></span><span class="highlight-line"><span class="highlight-ln">22</span><span class="highlight-cl">        <span class="highlight-o">},</span> <span class="highlight-n">FIXED_THREAD_POOL</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">23</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">String</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future_02</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">24</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"future_02 计算, 执行线程: "</span> <span class="highlight-o">+</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">25</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">26</span><span class="highlight-cl">            <span class="highlight-k">try</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">27</span><span class="highlight-cl">                <span class="highlight-n">TimeUnit</span><span class="highlight-o">.</span><span class="highlight-na">SECONDS</span><span class="highlight-o">.</span><span class="highlight-na">sleep</span><span class="highlight-o">(</span><span class="highlight-mi">5</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">28</span><span class="highlight-cl">            <span class="highlight-o">}</span> <span class="highlight-k">catch</span> <span class="highlight-o">(</span><span class="highlight-n">InterruptedException</span> <span class="highlight-n">e</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">29</span><span class="highlight-cl">                <span class="highlight-k">throw</span> <span class="highlight-k">new</span> <span class="highlight-n">RuntimeException</span><span class="highlight-o">(</span><span class="highlight-n">e</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">30</span><span class="highlight-cl">            <span class="highlight-o">}</span>
</span></span><span class="highlight-line"><span class="highlight-ln">31</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">32</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"future_02 计算完毕"</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">33</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">34</span><span class="highlight-cl">            <span class="highlight-k">return</span> <span class="highlight-s">"future_02 计算"</span><span class="highlight-o">;</span>
</span></span><span class="highlight-line"><span class="highlight-ln">35</span><span class="highlight-cl">        <span class="highlight-o">},</span> <span class="highlight-n">FIXED_THREAD_POOL</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">36</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">37</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">Void</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future</span> <span class="highlight-o">=</span> <span class="highlight-n">future_01</span><span class="highlight-o">.</span><span class="highlight-na">runAfterBoth</span><span class="highlight-o">(</span><span class="highlight-n">future_02</span><span class="highlight-o">,</span>
</span></span><span class="highlight-line"><span class="highlight-ln">38</span><span class="highlight-cl">                <span class="highlight-o">()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">39</span><span class="highlight-cl">                    <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"future_01 执行完毕: %s, future_02 执行完毕: %s \n"</span><span class="highlight-o">,</span>
</span></span><span class="highlight-line"><span class="highlight-ln">40</span><span class="highlight-cl">                            <span class="highlight-n">future_01</span><span class="highlight-o">.</span><span class="highlight-na">isDone</span><span class="highlight-o">(),</span>
</span></span><span class="highlight-line"><span class="highlight-ln">41</span><span class="highlight-cl">                            <span class="highlight-n">future_02</span><span class="highlight-o">.</span><span class="highlight-na">isDone</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">42</span><span class="highlight-cl">                    <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"runAfterBoth 执行线程"</span> <span class="highlight-o">+</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">43</span><span class="highlight-cl">                <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">44</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">45</span><span class="highlight-cl">        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"等待 future 计算完毕 ..."</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">46</span><span class="highlight-cl">        <span class="highlight-n">future</span><span class="highlight-o">.</span><span class="highlight-na">join</span><span class="highlight-o">();</span>
</span></span><span class="highlight-line"><span class="highlight-ln">47</span><span class="highlight-cl">    <span class="highlight-o">}</span>
</span></span></code></pre>
<p>执行结果：</p>
<blockquote>
<p>future_01 计算,执行线程: pool-1-thread-1<br>
等待 future 计算完毕 ...<br>
future_01 计算完毕<br>
future_02 计算, 执行线程: pool-1-thread-1<br>
future_02 计算完毕<br>
future_01 执行完毕: true, future_02 执行完毕: true<br>
runAfterBoth 执行线程 pool-1-thread-1</p>
</blockquote>
<p><strong>由结果分析：</strong></p>
<ol>
<li>
<p>runAfterBoth 方法需要等待依赖的两个 CompletionStage 均执行完毕才会执行</p>
</li>
<li>
<p>从表象来看 runAfterBoth 执行使用的线程和 future_01 是同一个，上述例子比较特殊，我们可以修改下示例代码</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln">1</span><span class="highlight-cl"><span class="highlight-c1">// 不再指定执行线程池
</span></span></span><span class="highlight-line"><span class="highlight-ln">2</span><span class="highlight-cl"><span class="highlight-c1"></span><span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">String</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future_01</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">3</span><span class="highlight-cl">    <span class="highlight-o">...</span>
</span></span><span class="highlight-line"><span class="highlight-ln">4</span><span class="highlight-cl"><span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">5</span><span class="highlight-cl"><span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">String</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future_02</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">6</span><span class="highlight-cl">    <span class="highlight-o">...</span>
</span></span><span class="highlight-line"><span class="highlight-ln">7</span><span class="highlight-cl"><span class="highlight-o">});</span>
</span></span></code></pre>
<p>再次运行，结果如下：</p>
<blockquote>
<p>future_01 计算,执行线程: ForkJoinPool.commonPool-worker-1<br>
future_02 计算, 执行线程: ForkJoinPool.commonPool-worker-2<br>
等待 future 计算完毕 ...<br>
future_02 计算完毕<br>
future_01 计算完毕<br>
future_01 执行完毕: true, future_02 执行完毕: true<br>
runAfterBoth 执行线程 ForkJoinPool.commonPool-worker-1</p>
</blockquote>
<p>由此，基本可以确定 <strong>runAfterBoth 执行使用的线程和 future_01 是同一个</strong></p>
</li>
</ol>
</li>
</ul>
<h4 id="当两个中任意一个-CompletionStage-完成的时候-action这个消费者就会被执行">当两个中任意一个 <em>CompletionStage</em> 完成的时候，action 这个消费者就会被执行</h4>
<ul>
<li>
<p>有返回类型 <em>CompletableFuture&lt;U&gt;</em></p>
<blockquote>
<p>CompletableFuture#applyToEither(CompletionStage, Function)</p>
<p>CompletableFuture#applyToEitherAsync(CompletionStage, Function)</p>
<p>CompletableFuture#applyToEitherAsync(CompletionStage, Function, Executor)</p>
</blockquote>
<p>示例代码：</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln"> 1</span><span class="highlight-cl">    <span class="highlight-cm">/**
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 2</span><span class="highlight-cl"><span class="highlight-cm">     * 当任意一个 CompletionStage 完成的时候，action这个消费者就会被执行。这个方法返回 CompletableFuture&lt;U&gt;
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 3</span><span class="highlight-cl"><span class="highlight-cm">     *
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 4</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#applyToEither(CompletionStage, Function)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 5</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#applyToEitherAsync(CompletionStage, Function)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 6</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#applyToEitherAsync(CompletionStage, Function, Executor)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 7</span><span class="highlight-cl"><span class="highlight-cm">     */</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 8</span><span class="highlight-cl">    <span class="highlight-nd">@Test</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 9</span><span class="highlight-cl">    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">test_applyToEither_method</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">10</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">Integer</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future_01</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">11</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"future_01 计算开始, 执行线程: %s\n"</span><span class="highlight-o">,</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">12</span><span class="highlight-cl">            <span class="highlight-k">try</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">13</span><span class="highlight-cl">                <span class="highlight-n">TimeUnit</span><span class="highlight-o">.</span><span class="highlight-na">SECONDS</span><span class="highlight-o">.</span><span class="highlight-na">sleep</span><span class="highlight-o">(</span><span class="highlight-mi">10</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">14</span><span class="highlight-cl">            <span class="highlight-o">}</span> <span class="highlight-k">catch</span> <span class="highlight-o">(</span><span class="highlight-n">InterruptedException</span> <span class="highlight-n">e</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">15</span><span class="highlight-cl">                <span class="highlight-k">throw</span> <span class="highlight-k">new</span> <span class="highlight-n">RuntimeException</span><span class="highlight-o">(</span><span class="highlight-n">e</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">16</span><span class="highlight-cl">            <span class="highlight-o">}</span>
</span></span><span class="highlight-line"><span class="highlight-ln">17</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"future_01 计算完毕"</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">18</span><span class="highlight-cl">            <span class="highlight-k">return</span> <span class="highlight-mi">100</span><span class="highlight-o">;</span>
</span></span><span class="highlight-line"><span class="highlight-ln">19</span><span class="highlight-cl">        <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">20</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">21</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">Integer</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future_02</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">22</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"future_02 计算完毕, 执行线程: %s\n"</span><span class="highlight-o">,</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">23</span><span class="highlight-cl">            <span class="highlight-k">return</span> <span class="highlight-mi">200</span><span class="highlight-o">;</span>
</span></span><span class="highlight-line"><span class="highlight-ln">24</span><span class="highlight-cl">        <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">25</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">26</span><span class="highlight-cl">        <span class="highlight-c1">// applyToEither 使用 main 线程执行,所以 future_01 未计算完毕也可以执行
</span></span></span><span class="highlight-line"><span class="highlight-ln">27</span><span class="highlight-cl"><span class="highlight-c1"></span>        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">String</span><span class="highlight-o">&gt;</span> <span class="highlight-n">resultFuture</span> <span class="highlight-o">=</span> <span class="highlight-n">future_01</span><span class="highlight-o">.</span><span class="highlight-na">applyToEither</span><span class="highlight-o">(</span><span class="highlight-n">future_02</span><span class="highlight-o">,</span> <span class="highlight-n">integer</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">28</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"future_01 是否计算完毕: %s, future_02 是否计算完毕: %s, 结果: %s, 执行线程: %s\n"</span><span class="highlight-o">,</span>
</span></span><span class="highlight-line"><span class="highlight-ln">29</span><span class="highlight-cl">                    <span class="highlight-n">future_01</span><span class="highlight-o">.</span><span class="highlight-na">isDone</span><span class="highlight-o">(),</span>
</span></span><span class="highlight-line"><span class="highlight-ln">30</span><span class="highlight-cl">                    <span class="highlight-n">future_02</span><span class="highlight-o">.</span><span class="highlight-na">isDone</span><span class="highlight-o">(),</span>
</span></span><span class="highlight-line"><span class="highlight-ln">31</span><span class="highlight-cl">                    <span class="highlight-n">integer</span><span class="highlight-o">.</span><span class="highlight-na">toString</span><span class="highlight-o">(),</span>
</span></span><span class="highlight-line"><span class="highlight-ln">32</span><span class="highlight-cl">                    <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">33</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">34</span><span class="highlight-cl">            <span class="highlight-k">return</span> <span class="highlight-n">integer</span><span class="highlight-o">.</span><span class="highlight-na">toString</span><span class="highlight-o">();</span>
</span></span><span class="highlight-line"><span class="highlight-ln">35</span><span class="highlight-cl">        <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">36</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">37</span><span class="highlight-cl">        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"resultFuture 计算结果: "</span> <span class="highlight-o">+</span> <span class="highlight-n">resultFuture</span><span class="highlight-o">.</span><span class="highlight-na">join</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">38</span><span class="highlight-cl">    <span class="highlight-o">}</span>
</span></span></code></pre>
<p>执行结果：</p>
<blockquote>
<p>future_01 计算开始, 执行线程: ForkJoinPool.commonPool-worker-1<br>
future_02 计算完毕, 执行线程: ForkJoinPool.commonPool-worker-2<br>
future_01 是否计算完毕: false, future_02 是否计算完毕: true, 结果: 200, 执行线程: main<br>
resultFuture 计算结果: 200</p>
</blockquote>
</li>
<li>
<p>无返回类型 <em>CompletableFuture&lt;U&gt;</em></p>
<blockquote>
<p>CompletableFuture#acceptEither(CompletionStage, Consumer)</p>
<p>CompletableFuture#acceptEitherAsync(CompletionStage, Consumer)</p>
<p>CompletableFuture#acceptEitherAsync(CompletionStage, Consumer, Executor)</p>
</blockquote>
<p>示例代码：</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln"> 1</span><span class="highlight-cl">    <span class="highlight-cm">/**
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 2</span><span class="highlight-cl"><span class="highlight-cm">     * 当任意一个 CompletionStage 完成的时候，action这个消费者就会被执行。这个方法返回 CompletableFuture&lt;Void&gt;
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 3</span><span class="highlight-cl"><span class="highlight-cm">     *
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 4</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#acceptEither(CompletionStage, Consumer)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 5</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#acceptEitherAsync(CompletionStage, Consumer)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 6</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#acceptEitherAsync(CompletionStage, Consumer, Executor)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 7</span><span class="highlight-cl"><span class="highlight-cm">     */</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 8</span><span class="highlight-cl">    <span class="highlight-nd">@Test</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 9</span><span class="highlight-cl">    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">test_acceptEither_method</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">10</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">Integer</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future_01</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">11</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"future_01 计算开始, 执行线程: %s\n"</span><span class="highlight-o">,</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">12</span><span class="highlight-cl">            <span class="highlight-k">try</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">13</span><span class="highlight-cl">                <span class="highlight-n">TimeUnit</span><span class="highlight-o">.</span><span class="highlight-na">SECONDS</span><span class="highlight-o">.</span><span class="highlight-na">sleep</span><span class="highlight-o">(</span><span class="highlight-mi">10</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">14</span><span class="highlight-cl">            <span class="highlight-o">}</span> <span class="highlight-k">catch</span> <span class="highlight-o">(</span><span class="highlight-n">InterruptedException</span> <span class="highlight-n">e</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">15</span><span class="highlight-cl">                <span class="highlight-k">throw</span> <span class="highlight-k">new</span> <span class="highlight-n">RuntimeException</span><span class="highlight-o">(</span><span class="highlight-n">e</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">16</span><span class="highlight-cl">            <span class="highlight-o">}</span>
</span></span><span class="highlight-line"><span class="highlight-ln">17</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"future_01 计算完毕"</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">18</span><span class="highlight-cl">            <span class="highlight-k">return</span> <span class="highlight-mi">100</span><span class="highlight-o">;</span>
</span></span><span class="highlight-line"><span class="highlight-ln">19</span><span class="highlight-cl">        <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">20</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">21</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">Integer</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future_02</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">22</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"future_02 计算完毕, 执行线程: %s\n"</span><span class="highlight-o">,</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">23</span><span class="highlight-cl">            <span class="highlight-k">return</span> <span class="highlight-mi">200</span><span class="highlight-o">;</span>
</span></span><span class="highlight-line"><span class="highlight-ln">24</span><span class="highlight-cl">        <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">25</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">26</span><span class="highlight-cl">        <span class="highlight-c1">// acceptEither 使用 main 线程执行,所以 future_01 未计算完毕也可以执行
</span></span></span><span class="highlight-line"><span class="highlight-ln">27</span><span class="highlight-cl"><span class="highlight-c1"></span>        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">Void</span><span class="highlight-o">&gt;</span> <span class="highlight-n">resultFuture</span> <span class="highlight-o">=</span> <span class="highlight-n">future_01</span><span class="highlight-o">.</span><span class="highlight-na">acceptEither</span><span class="highlight-o">(</span><span class="highlight-n">future_02</span><span class="highlight-o">,</span> <span class="highlight-n">integer</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">28</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"future_01 是否计算完毕: %s, future_02 是否计算完毕: %s, 结果: %s, 执行线程: %s\n"</span><span class="highlight-o">,</span>
</span></span><span class="highlight-line"><span class="highlight-ln">29</span><span class="highlight-cl">                    <span class="highlight-n">future_01</span><span class="highlight-o">.</span><span class="highlight-na">isDone</span><span class="highlight-o">(),</span>
</span></span><span class="highlight-line"><span class="highlight-ln">30</span><span class="highlight-cl">                    <span class="highlight-n">future_02</span><span class="highlight-o">.</span><span class="highlight-na">isDone</span><span class="highlight-o">(),</span>
</span></span><span class="highlight-line"><span class="highlight-ln">31</span><span class="highlight-cl">                    <span class="highlight-n">integer</span><span class="highlight-o">.</span><span class="highlight-na">toString</span><span class="highlight-o">(),</span>
</span></span><span class="highlight-line"><span class="highlight-ln">32</span><span class="highlight-cl">                    <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">33</span><span class="highlight-cl">        <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">34</span><span class="highlight-cl">    <span class="highlight-o">}</span>
</span></span></code></pre>
<p>执行结果：</p>
<blockquote>
<p>future_01 计算开始, 执行线程: ForkJoinPool.commonPool-worker-1<br>
future_02 计算完毕, 执行线程: ForkJoinPool.commonPool-worker-2<br>
future_01 是否计算完毕: false, future_02 是否计算完毕: true, 结果: 200, 执行线程: main</p>
</blockquote>
</li>
</ul>
<h4 id="applyToEither-和-acceptEither-一定是非阻塞的么-"><em>applyToEither</em> 和 <em>acceptEither</em> 一定是非阻塞的么？</h4>
<p>由上面的示例代码执行结果可知，<em>applyToEither</em> 和 <em>acceptEither</em> 都是使用当前线程执行的，由于 <em>future_01</em> 和 <em>future_02</em> 都是在异步线程池中执行，所以不会出现阻塞的情况，但是如果我们认为的指定其都使用同一个线程执行呢，是否会出现阻塞情况？</p>
<p>示例代码：</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln"> 1</span><span class="highlight-cl">   <span class="highlight-kd">private</span> <span class="highlight-kd">static</span> <span class="highlight-kd">final</span> <span class="highlight-n">ExecutorService</span> <span class="highlight-n">FIXED_THREAD_POOL</span> <span class="highlight-o">=</span> <span class="highlight-n">Executors</span><span class="highlight-o">.</span><span class="highlight-na">newFixedThreadPool</span><span class="highlight-o">(</span><span class="highlight-mi">1</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 2</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln"> 3</span><span class="highlight-cl">   <span class="highlight-cm">/**
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 4</span><span class="highlight-cl"><span class="highlight-cm">     * 通过处理,指定 applyToEitherAsync 的执行线程和  future_01 的线程一样,这种情况下就会导致 applyToEitherAsync 执行阻塞
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 5</span><span class="highlight-cl"><span class="highlight-cm">     */</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 6</span><span class="highlight-cl">    <span class="highlight-nd">@Test</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 7</span><span class="highlight-cl">    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">test_applyToEitherAsyncThread_isSameAs_future_01</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 8</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">Integer</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future_01</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 9</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"future_01 计算开始, 执行线程: %s\n"</span><span class="highlight-o">,</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">10</span><span class="highlight-cl">            <span class="highlight-k">try</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">11</span><span class="highlight-cl">                <span class="highlight-n">TimeUnit</span><span class="highlight-o">.</span><span class="highlight-na">SECONDS</span><span class="highlight-o">.</span><span class="highlight-na">sleep</span><span class="highlight-o">(</span><span class="highlight-mi">10</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">12</span><span class="highlight-cl">            <span class="highlight-o">}</span> <span class="highlight-k">catch</span> <span class="highlight-o">(</span><span class="highlight-n">InterruptedException</span> <span class="highlight-n">e</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">13</span><span class="highlight-cl">                <span class="highlight-k">throw</span> <span class="highlight-k">new</span> <span class="highlight-n">RuntimeException</span><span class="highlight-o">(</span><span class="highlight-n">e</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">14</span><span class="highlight-cl">            <span class="highlight-o">}</span>
</span></span><span class="highlight-line"><span class="highlight-ln">15</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"future_01 计算完毕"</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">16</span><span class="highlight-cl">            <span class="highlight-k">return</span> <span class="highlight-mi">100</span><span class="highlight-o">;</span>
</span></span><span class="highlight-line"><span class="highlight-ln">17</span><span class="highlight-cl">        <span class="highlight-o">},</span> <span class="highlight-n">FIXED_THREAD_POOL</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">18</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">19</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">Integer</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future_02</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">20</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"future_02 计算完毕, 执行线程: %s\n"</span><span class="highlight-o">,</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">21</span><span class="highlight-cl">            <span class="highlight-k">return</span> <span class="highlight-mi">200</span><span class="highlight-o">;</span>
</span></span><span class="highlight-line"><span class="highlight-ln">22</span><span class="highlight-cl">        <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">23</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">24</span><span class="highlight-cl">        <span class="highlight-c1">// 通过处理,指定 applyToEitherAsync 的执行线程和  future_01 的线程一样,这种情况下就会导致 applyToEitherAsync 执行阻塞
</span></span></span><span class="highlight-line"><span class="highlight-ln">25</span><span class="highlight-cl"><span class="highlight-c1"></span>        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">String</span><span class="highlight-o">&gt;</span> <span class="highlight-n">resultFuture</span> <span class="highlight-o">=</span> <span class="highlight-n">future_01</span><span class="highlight-o">.</span><span class="highlight-na">applyToEitherAsync</span><span class="highlight-o">(</span><span class="highlight-n">future_02</span><span class="highlight-o">,</span>
</span></span><span class="highlight-line"><span class="highlight-ln">26</span><span class="highlight-cl">                <span class="highlight-n">integer</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">27</span><span class="highlight-cl">                    <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"future_01 是否计算完毕: %s, future_02 是否计算完毕: %s, 结果: %s, 执行线程: %s\n"</span><span class="highlight-o">,</span>
</span></span><span class="highlight-line"><span class="highlight-ln">28</span><span class="highlight-cl">                            <span class="highlight-n">future_01</span><span class="highlight-o">.</span><span class="highlight-na">isDone</span><span class="highlight-o">(),</span>
</span></span><span class="highlight-line"><span class="highlight-ln">29</span><span class="highlight-cl">                            <span class="highlight-n">future_02</span><span class="highlight-o">.</span><span class="highlight-na">isDone</span><span class="highlight-o">(),</span>
</span></span><span class="highlight-line"><span class="highlight-ln">30</span><span class="highlight-cl">                            <span class="highlight-n">integer</span><span class="highlight-o">.</span><span class="highlight-na">toString</span><span class="highlight-o">(),</span>
</span></span><span class="highlight-line"><span class="highlight-ln">31</span><span class="highlight-cl">                            <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">32</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">33</span><span class="highlight-cl">                    <span class="highlight-k">return</span> <span class="highlight-n">integer</span><span class="highlight-o">.</span><span class="highlight-na">toString</span><span class="highlight-o">();</span>
</span></span><span class="highlight-line"><span class="highlight-ln">34</span><span class="highlight-cl">                <span class="highlight-o">},</span>
</span></span><span class="highlight-line"><span class="highlight-ln">35</span><span class="highlight-cl">                <span class="highlight-n">FIXED_THREAD_POOL</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">36</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">37</span><span class="highlight-cl">        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"resultFuture 计算结果: "</span> <span class="highlight-o">+</span> <span class="highlight-n">resultFuture</span><span class="highlight-o">.</span><span class="highlight-na">join</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">38</span><span class="highlight-cl">    <span class="highlight-o">}</span>
</span></span></code></pre>
<p>执行结果：</p>
<blockquote>
<p>future_01 计算开始, 执行线程: pool-1-thread-1<br>
future_02 计算完毕, 执行线程: ForkJoinPool.commonPool-worker-1<br>
future_01 计算完毕<br>
future_01 是否计算完毕: true, future_02 是否计算完毕: true, 结果: 100, 执行线程: pool-1-thread-1<br>
resultFuture 计算结果: 100</p>
</blockquote>
<p><strong>很明显，出现了阻塞。所以 <em>applyToEither</em> 和 <em>acceptEither</em> 非阻塞并非绝对，需要按情况具体分析</strong></p>
<h3 id="在计算步骤链中组合-CompletableFuture">在计算步骤链中组合 <em>CompletableFuture</em></h3>
<h4 id="使用-thenCompose-方法将两个-CompletableFuture-顺序链接起来">使用 <em>thenCompose</em> 方法将两个 <em>CompletableFuture</em> 顺序链接起来</h4>
<ul>
<li>CompletableFuture#thenCompose(Function)</li>
<li>CompletableFuture#thenComposeAsync(Function)</li>
<li>CompletableFuture#thenComposeAsync(Function, Executor)</li>
</ul>
<p>示例代码：</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln"> 1</span><span class="highlight-cl">    <span class="highlight-nd">@Test</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 2</span><span class="highlight-cl">    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">test_thenCompose_method</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 3</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">String</span><span class="highlight-o">&gt;</span> <span class="highlight-n">baseFuture</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 4</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"base future compute start"</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 5</span><span class="highlight-cl">            <span class="highlight-k">try</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 6</span><span class="highlight-cl">                <span class="highlight-n">TimeUnit</span><span class="highlight-o">.</span><span class="highlight-na">SECONDS</span><span class="highlight-o">.</span><span class="highlight-na">sleep</span><span class="highlight-o">(</span><span class="highlight-mi">10</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 7</span><span class="highlight-cl">            <span class="highlight-o">}</span> <span class="highlight-k">catch</span> <span class="highlight-o">(</span><span class="highlight-n">InterruptedException</span> <span class="highlight-n">e</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 8</span><span class="highlight-cl">                <span class="highlight-k">throw</span> <span class="highlight-k">new</span> <span class="highlight-n">RuntimeException</span><span class="highlight-o">(</span><span class="highlight-n">e</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 9</span><span class="highlight-cl">            <span class="highlight-o">}</span>
</span></span><span class="highlight-line"><span class="highlight-ln">10</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"base future compute end. 执行线程 : "</span> <span class="highlight-o">+</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">11</span><span class="highlight-cl">            <span class="highlight-k">return</span> <span class="highlight-s">"hello,%s"</span><span class="highlight-o">;</span>
</span></span><span class="highlight-line"><span class="highlight-ln">12</span><span class="highlight-cl">        <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">13</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">14</span><span class="highlight-cl">        <span class="highlight-c1">// 即使使用 thenComposeAsync, 任需要等 baseFuture 计算完毕之后 才会执行 thenComposeAsync 的计算
</span></span></span><span class="highlight-line"><span class="highlight-ln">15</span><span class="highlight-cl"><span class="highlight-c1"></span>        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">Integer</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future</span> <span class="highlight-o">=</span> <span class="highlight-n">baseFuture</span><span class="highlight-o">.</span><span class="highlight-na">thenComposeAsync</span><span class="highlight-o">(</span><span class="highlight-n">str</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">16</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"thenComposeAsync run ,baseFuture 执行完毕: "</span> <span class="highlight-o">+</span> <span class="highlight-n">baseFuture</span><span class="highlight-o">.</span><span class="highlight-na">isDone</span><span class="highlight-o">()</span>
</span></span><span class="highlight-line"><span class="highlight-ln">17</span><span class="highlight-cl">                    <span class="highlight-o">+</span> <span class="highlight-s">". 执行线程 : "</span> <span class="highlight-o">+</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">18</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">19</span><span class="highlight-cl">            <span class="highlight-k">try</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">20</span><span class="highlight-cl">                <span class="highlight-n">TimeUnit</span><span class="highlight-o">.</span><span class="highlight-na">SECONDS</span><span class="highlight-o">.</span><span class="highlight-na">sleep</span><span class="highlight-o">(</span><span class="highlight-mi">10</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">21</span><span class="highlight-cl">            <span class="highlight-o">}</span> <span class="highlight-k">catch</span> <span class="highlight-o">(</span><span class="highlight-n">InterruptedException</span> <span class="highlight-n">e</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">22</span><span class="highlight-cl">                <span class="highlight-k">throw</span> <span class="highlight-k">new</span> <span class="highlight-n">RuntimeException</span><span class="highlight-o">(</span><span class="highlight-n">e</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">23</span><span class="highlight-cl">            <span class="highlight-o">}</span>
</span></span><span class="highlight-line"><span class="highlight-ln">24</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">25</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"thenComposeAsync run end"</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">26</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">27</span><span class="highlight-cl">            <span class="highlight-k">return</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">28</span><span class="highlight-cl">                <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-n">String</span><span class="highlight-o">.</span><span class="highlight-na">format</span><span class="highlight-o">(</span><span class="highlight-n">str</span><span class="highlight-o">,</span> <span class="highlight-s">"java 8. 执行线程 : "</span> <span class="highlight-o">+</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">()));</span>
</span></span><span class="highlight-line"><span class="highlight-ln">29</span><span class="highlight-cl">                <span class="highlight-k">return</span> <span class="highlight-mi">100</span><span class="highlight-o">;</span>
</span></span><span class="highlight-line"><span class="highlight-ln">30</span><span class="highlight-cl">            <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">31</span><span class="highlight-cl">        <span class="highlight-o">},</span> <span class="highlight-n">FIXED_THREAD_POOL</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">32</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">33</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">34</span><span class="highlight-cl">        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"等待 future 计算完毕 ..."</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">35</span><span class="highlight-cl">        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"计算结果 : "</span> <span class="highlight-o">+</span> <span class="highlight-n">future</span><span class="highlight-o">.</span><span class="highlight-na">join</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">36</span><span class="highlight-cl">    <span class="highlight-o">}</span>
</span></span></code></pre>
<p>执行结果：</p>
<blockquote>
<p>base future compute start<br>
等待 future 计算完毕 ...<br>
base future compute end. 执行线程 : ForkJoinPool.commonPool-worker-1<br>
thenComposeAsync run ,baseFuture 执行完毕: true. 执行线程 : pool-1-thread-1<br>
thenComposeAsync run end<br>
hello,java 8. 执行线程 : ForkJoinPool.commonPool-worker-1<br>
计算结果 : 100</p>
</blockquote>
<h5 id="thenCompose---与-thenApply---的区别"><em>thenCompose()</em> 与 <em>thenApply()</em> 的区别</h5>
<ul>
<li>
<p><em>thenApply()</em> 可以处理先前计算的结果，关键点在于可以转换 <em>CompletableFuture</em> 返回的结果类型，并且这个 <em>CompletableFuture</em> 仅仅只是对结果的封装，其计算逻辑已经在 <em>thenApply()</em> 中执行完毕。</p>
</li>
<li>
<p><em>thenCompose()</em> 可以把先前的计算结果作为入参在另一个 <em>CompletableFuture</em> 中使用，并且返回一个全新的 <em>CompletableFuture</em>，关键点在于返回的对象是 <em>CompletableFuture</em>，其计算逻辑在 <em>thenCompose()</em> 执行完毕的时候仍未执行。</p>
<p><strong><font color="red">网上经常会说：<em>thenApply()</em>&nbsp;和 <em>thenCompose()</em>&nbsp;的区别类似于&nbsp;<em>map()</em> 和 <em>flatMap()</em>&nbsp;的区别。我个人对此的理解是：<em>map()</em> 是把 T -&gt; R ，<em>flatMap()</em>&nbsp;是把 T -&gt; Stream&lt;R&gt;；类似的，<em>thenApply()</em>&nbsp;是把 T -&gt; U，<em>thenCompose()</em>&nbsp;是把 T -&gt; CompletableFuture&lt;U&gt;</font></strong></p>
</li>
</ul>
<h4 id="执行两个独立的-CompletableFuture-并对它们的结果做一些事情">执行两个独立的 <em>CompletableFuture</em> 并对它们的结果做一些事情</h4>
<h5 id="组合两个并行的-CompletionStage--返回一个新的-CompletableFuture">组合两个并行的 <em>CompletionStage</em>， 返回一个新的 <em>CompletableFuture</em></h5>
<ul>
<li>CompletableFuture#thenCombine(CompletionStage, BiFunction)</li>
<li>CompletableFuture#thenCombineAsync(CompletionStage, BiFunction)</li>
<li>CompletableFuture#thenCombineAsync(CompletionStage, BiFunction, Executor)</li>
</ul>
<p>示例代码：</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln"> 1</span><span class="highlight-cl">    <span class="highlight-cm">/**
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 2</span><span class="highlight-cl"><span class="highlight-cm">     * 组合两个并行的 CompletionStage, 返回一个新的 CompletableFuture
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 3</span><span class="highlight-cl"><span class="highlight-cm">     *
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 4</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#thenCombine(CompletionStage, BiFunction)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 5</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#thenCombineAsync(CompletionStage, BiFunction)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 6</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#thenCombineAsync(CompletionStage, BiFunction, Executor)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 7</span><span class="highlight-cl"><span class="highlight-cm">     */</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 8</span><span class="highlight-cl">    <span class="highlight-nd">@Test</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 9</span><span class="highlight-cl">    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">test_thenCombine_method</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">10</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">Integer</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future_01</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">11</span><span class="highlight-cl">            <span class="highlight-k">try</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">12</span><span class="highlight-cl">                <span class="highlight-n">TimeUnit</span><span class="highlight-o">.</span><span class="highlight-na">SECONDS</span><span class="highlight-o">.</span><span class="highlight-na">sleep</span><span class="highlight-o">(</span><span class="highlight-mi">10</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">13</span><span class="highlight-cl">            <span class="highlight-o">}</span> <span class="highlight-k">catch</span> <span class="highlight-o">(</span><span class="highlight-n">InterruptedException</span> <span class="highlight-n">e</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">14</span><span class="highlight-cl">                <span class="highlight-k">throw</span> <span class="highlight-k">new</span> <span class="highlight-n">RuntimeException</span><span class="highlight-o">(</span><span class="highlight-n">e</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">15</span><span class="highlight-cl">            <span class="highlight-o">}</span>
</span></span><span class="highlight-line"><span class="highlight-ln">16</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"future_01 计算完毕,执行线程："</span> <span class="highlight-o">+</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">17</span><span class="highlight-cl">            <span class="highlight-k">return</span> <span class="highlight-mi">100</span><span class="highlight-o">;</span>
</span></span><span class="highlight-line"><span class="highlight-ln">18</span><span class="highlight-cl">        <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">19</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">20</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">String</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future_02</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">21</span><span class="highlight-cl">            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"future_02 计算完毕,执行线程："</span> <span class="highlight-o">+</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">22</span><span class="highlight-cl">            <span class="highlight-k">return</span> <span class="highlight-s">"abc"</span><span class="highlight-o">;</span>
</span></span><span class="highlight-line"><span class="highlight-ln">23</span><span class="highlight-cl">        <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">24</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">25</span><span class="highlight-cl">        <span class="highlight-c1">// future_02 和 future_01 并行执行,但是 thenCombineAsync() 需要等 future_01 计算完毕之后才能执行.
</span></span></span><span class="highlight-line"><span class="highlight-ln">26</span><span class="highlight-cl"><span class="highlight-c1"></span>        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">String</span><span class="highlight-o">&gt;</span> <span class="highlight-n">resultFuture</span> <span class="highlight-o">=</span> <span class="highlight-n">future_01</span><span class="highlight-o">.</span><span class="highlight-na">thenCombineAsync</span><span class="highlight-o">(</span><span class="highlight-n">future_02</span><span class="highlight-o">,</span>
</span></span><span class="highlight-line"><span class="highlight-ln">27</span><span class="highlight-cl">                <span class="highlight-o">(</span><span class="highlight-n">future_01_value</span><span class="highlight-o">,</span> <span class="highlight-n">future_02_value</span><span class="highlight-o">)</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">28</span><span class="highlight-cl">                    <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"future_01 是否计算完毕: %s, future_02 是否计算完毕: %s ,执行线程: [%s]\n"</span><span class="highlight-o">,</span>
</span></span><span class="highlight-line"><span class="highlight-ln">29</span><span class="highlight-cl">                            <span class="highlight-n">future_01</span><span class="highlight-o">.</span><span class="highlight-na">isDone</span><span class="highlight-o">(),</span>
</span></span><span class="highlight-line"><span class="highlight-ln">30</span><span class="highlight-cl">                            <span class="highlight-n">future_02</span><span class="highlight-o">.</span><span class="highlight-na">isDone</span><span class="highlight-o">(),</span>
</span></span><span class="highlight-line"><span class="highlight-ln">31</span><span class="highlight-cl">                            <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">32</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">33</span><span class="highlight-cl">                    <span class="highlight-k">return</span> <span class="highlight-n">future_01_value</span> <span class="highlight-o">+</span> <span class="highlight-n">future_02_value</span><span class="highlight-o">;</span>
</span></span><span class="highlight-line"><span class="highlight-ln">34</span><span class="highlight-cl">                <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">35</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">36</span><span class="highlight-cl">        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"resultFuture 结果:"</span> <span class="highlight-o">+</span> <span class="highlight-n">resultFuture</span><span class="highlight-o">.</span><span class="highlight-na">join</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">37</span><span class="highlight-cl">    <span class="highlight-o">}</span>
</span></span></code></pre>
<p>执行结果：</p>
<blockquote>
<p>future_02 计算完毕,执行线程：ForkJoinPool.commonPool-worker-2<br>
future_01 计算完毕,执行线程：ForkJoinPool.commonPool-worker-1<br>
future_01 是否计算完毕: true, future_02 是否计算完毕: true ,执行线程: [ForkJoinPool.commonPool-worker-1]<br>
resultFuture 结果:100abc</p>
</blockquote>
<h3 id="异常处理">异常处理</h3>
<ul>
<li>
<p>当 <code>CompletableFuture</code> 的计算抛出异常的时候，执行特定的 Action 动作，若计算正常执行，则不会执行  Action 动作，直接返回计算结果</p>
<blockquote>
<p>CompletableFuture#completeExceptionally(Throwable)</p>
</blockquote>
<p>示例代码：</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln"> 1</span><span class="highlight-cl">    <span class="highlight-cm">/**
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 2</span><span class="highlight-cl"><span class="highlight-cm">     * 当 {@link CompletableFuture} 的计算抛出异常的时候，我们可以执行特定的 Action 动作
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 3</span><span class="highlight-cl"><span class="highlight-cm">     *
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 4</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#completeExceptionally(Throwable)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 5</span><span class="highlight-cl"><span class="highlight-cm">     */</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 6</span><span class="highlight-cl">    <span class="highlight-nd">@Test</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 7</span><span class="highlight-cl">    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">test_process_exception</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 8</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">String</span><span class="highlight-o">&gt;</span> <span class="highlight-n">resultFutureOfException</span> <span class="highlight-o">=</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 9</span><span class="highlight-cl">                <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">10</span><span class="highlight-cl">                            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"base_future 开始执行,执行线程：%s\n"</span><span class="highlight-o">,</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">11</span><span class="highlight-cl">                            <span class="highlight-k">if</span> <span class="highlight-o">(</span><span class="highlight-kc">true</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">12</span><span class="highlight-cl">                                <span class="highlight-k">throw</span> <span class="highlight-k">new</span> <span class="highlight-n">RuntimeException</span><span class="highlight-o">(</span><span class="highlight-s">"我故意的，嘻嘻"</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">13</span><span class="highlight-cl">                            <span class="highlight-o">}</span>
</span></span><span class="highlight-line"><span class="highlight-ln">14</span><span class="highlight-cl">                            <span class="highlight-k">return</span> <span class="highlight-s">"计算成功"</span><span class="highlight-o">;</span>
</span></span><span class="highlight-line"><span class="highlight-ln">15</span><span class="highlight-cl">                        <span class="highlight-o">})</span>
</span></span><span class="highlight-line"><span class="highlight-ln">16</span><span class="highlight-cl">                        <span class="highlight-c1">// 只有前一动作发生异常才会执行exceptionally()中定义的active
</span></span></span><span class="highlight-line"><span class="highlight-ln">17</span><span class="highlight-cl"><span class="highlight-c1"></span>                        <span class="highlight-o">.</span><span class="highlight-na">exceptionally</span><span class="highlight-o">(</span><span class="highlight-n">throwable</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">18</span><span class="highlight-cl">                            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"exceptionally method start, 执行线程："</span> <span class="highlight-o">+</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">19</span><span class="highlight-cl">                            <span class="highlight-k">return</span> <span class="highlight-n">String</span><span class="highlight-o">.</span><span class="highlight-na">format</span><span class="highlight-o">(</span><span class="highlight-s">"base_future 发生异常 [%s]\n"</span><span class="highlight-o">,</span> <span class="highlight-n">throwable</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">20</span><span class="highlight-cl">                        <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">21</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">22</span><span class="highlight-cl">        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"计算结果：%s,执行线程：%s "</span><span class="highlight-o">,</span>
</span></span><span class="highlight-line"><span class="highlight-ln">23</span><span class="highlight-cl">                <span class="highlight-n">resultFutureOfException</span><span class="highlight-o">.</span><span class="highlight-na">join</span><span class="highlight-o">(),</span>
</span></span><span class="highlight-line"><span class="highlight-ln">24</span><span class="highlight-cl">                <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">25</span><span class="highlight-cl">    <span class="highlight-o">}</span>
</span></span></code></pre>
<p>执行结果：</p>
<blockquote>
<p>base_future 开始执行,执行线程：ForkJoinPool.commonPool-worker-1<br>
exceptionally method start, 执行线程：ForkJoinPool.commonPool-worker-1<br>
计算结果：base_future 发生异常 [java.util.concurrent.CompletionException: java.lang.RuntimeException: 我故意的，嘻嘻] ,执行线程：main</p>
</blockquote>
<p>修改代码如下，测试计算不发生异常时的执行情况：</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln"> 1</span><span class="highlight-cl">    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">test_process_exception</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 2</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">String</span><span class="highlight-o">&gt;</span> <span class="highlight-n">resultFutureOfException</span> <span class="highlight-o">=</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 3</span><span class="highlight-cl">                <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 4</span><span class="highlight-cl">                            <span class="highlight-o">...</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 5</span><span class="highlight-cl">                            <span class="highlight-k">if</span> <span class="highlight-o">(</span><span class="highlight-kc">false</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 6</span><span class="highlight-cl">                                <span class="highlight-k">throw</span> <span class="highlight-k">new</span> <span class="highlight-n">RuntimeException</span><span class="highlight-o">(</span><span class="highlight-s">"我故意的，嘻嘻"</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 7</span><span class="highlight-cl">                            <span class="highlight-o">}</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 8</span><span class="highlight-cl">                            <span class="highlight-o">...</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 9</span><span class="highlight-cl">                        <span class="highlight-o">})</span>
</span></span><span class="highlight-line"><span class="highlight-ln">10</span><span class="highlight-cl">                        <span class="highlight-c1">// 只有前一动作发生异常才会执行exceptionally()中定义的active
</span></span></span><span class="highlight-line"><span class="highlight-ln">11</span><span class="highlight-cl"><span class="highlight-c1"></span>                        <span class="highlight-o">.</span><span class="highlight-na">exceptionally</span><span class="highlight-o">(</span><span class="highlight-n">throwable</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">12</span><span class="highlight-cl">                            <span class="highlight-o">...</span>
</span></span><span class="highlight-line"><span class="highlight-ln">13</span><span class="highlight-cl">                        <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">14</span><span class="highlight-cl">		<span class="highlight-o">...</span>
</span></span><span class="highlight-line"><span class="highlight-ln">15</span><span class="highlight-cl">    <span class="highlight-o">}</span>
</span></span></code></pre>
<p>执行结果如下：</p>
<blockquote>
<p>base_future 开始执行,执行线程：ForkJoinPool.commonPool-worker-1<br>
计算结果：计算成功,执行线程：main</p>
</blockquote>
<p><strong>由此可知：计算正常执行，则不会执行 Action 动作，直接返回计算结果</strong></p>
<p><font color="red">CompletableFuture#completeExceptionally 处理完异常，并不会再次抛出异常，程序会正常运行结束，但是 <code>CompletableFuture#whenComplete</code> 处理的异常会抛出</font></p>
</li>
<li>
<p>既能处理计算结果，也能处理异常</p>
<blockquote>
<p>CompletableFuture#handle(BiFunction)</p>
<p>CompletableFuture#handleAsync(BiFunction)</p>
<p>CompletableFuture#handleAsync(BiFunction, Executor)</p>
</blockquote>
<p>计算正常执行时，处理计算结果的示例代码：</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln"> 1</span><span class="highlight-cl">    <span class="highlight-cm">/**
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 2</span><span class="highlight-cl"><span class="highlight-cm">     * 当原先的 {@link CompletableFuture} 的值计算完成或者抛出异常的时候，会触发 {@link CompletableFuture#handle(BiFunction)} 的计算
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 3</span><span class="highlight-cl"><span class="highlight-cm">     * &lt;br&gt;
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 4</span><span class="highlight-cl"><span class="highlight-cm">     * &lt;font color="red"&gt;与 {@link CompletableFuture#whenComplete} 相比,该组方法允许变更最终 {@link CompletableFuture} 的对象类型&lt;/font&gt;
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 5</span><span class="highlight-cl"><span class="highlight-cm">     *
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 6</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#handle(BiFunction)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 7</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#handleAsync(BiFunction)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 8</span><span class="highlight-cl"><span class="highlight-cm">     * @see CompletableFuture#handleAsync(BiFunction, Executor)
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 9</span><span class="highlight-cl"><span class="highlight-cm">     */</span>
</span></span><span class="highlight-line"><span class="highlight-ln">10</span><span class="highlight-cl">    <span class="highlight-nd">@Test</span>
</span></span><span class="highlight-line"><span class="highlight-ln">11</span><span class="highlight-cl">    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">test_handle_method</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">12</span><span class="highlight-cl">        <span class="highlight-c1">// 用同一线程执行handle()指定的active
</span></span></span><span class="highlight-line"><span class="highlight-ln">13</span><span class="highlight-cl"><span class="highlight-c1"></span>        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">Integer</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">completedFuture</span><span class="highlight-o">(</span><span class="highlight-s">"我是字符串"</span><span class="highlight-o">)</span>
</span></span><span class="highlight-line"><span class="highlight-ln">14</span><span class="highlight-cl">                <span class="highlight-o">.</span><span class="highlight-na">handle</span><span class="highlight-o">((</span><span class="highlight-n">v</span><span class="highlight-o">,</span> <span class="highlight-n">e</span><span class="highlight-o">)</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">15</span><span class="highlight-cl">                    <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"原始计算结果: %s,当前线程: %s \n"</span><span class="highlight-o">,</span> <span class="highlight-n">v</span><span class="highlight-o">,</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">16</span><span class="highlight-cl">                    <span class="highlight-k">return</span> <span class="highlight-n">v</span><span class="highlight-o">.</span><span class="highlight-na">length</span><span class="highlight-o">();</span>
</span></span><span class="highlight-line"><span class="highlight-ln">17</span><span class="highlight-cl">                <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">18</span><span class="highlight-cl">        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"最终 CompletableFuture 结果: %s \n"</span><span class="highlight-o">,</span> <span class="highlight-n">future</span><span class="highlight-o">.</span><span class="highlight-na">join</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">19</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">20</span><span class="highlight-cl">        <span class="highlight-c1">// 用默认的线程池 ForkJoinPool#commonPool() 异步执行特定的 Action
</span></span></span><span class="highlight-line"><span class="highlight-ln">21</span><span class="highlight-cl"><span class="highlight-c1"></span>        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">Integer</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future_handleAsync</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">completedFuture</span><span class="highlight-o">(</span><span class="highlight-s">"我是字符串"</span><span class="highlight-o">)</span>
</span></span><span class="highlight-line"><span class="highlight-ln">22</span><span class="highlight-cl">                <span class="highlight-o">.</span><span class="highlight-na">handleAsync</span><span class="highlight-o">((</span><span class="highlight-n">v</span><span class="highlight-o">,</span> <span class="highlight-n">e</span><span class="highlight-o">)</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">23</span><span class="highlight-cl">                    <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"原始计算结果: %s,当前线程: %s \n"</span><span class="highlight-o">,</span> <span class="highlight-n">v</span><span class="highlight-o">,</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">24</span><span class="highlight-cl">                    <span class="highlight-k">return</span> <span class="highlight-n">v</span><span class="highlight-o">.</span><span class="highlight-na">length</span><span class="highlight-o">();</span>
</span></span><span class="highlight-line"><span class="highlight-ln">25</span><span class="highlight-cl">                <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">26</span><span class="highlight-cl">        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"最终 CompletableFuture 结果: %s \n"</span><span class="highlight-o">,</span> <span class="highlight-n">future_handleAsync</span><span class="highlight-o">.</span><span class="highlight-na">join</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">27</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">28</span><span class="highlight-cl">        <span class="highlight-c1">// 用指定线程池异步执行特定的 Action
</span></span></span><span class="highlight-line"><span class="highlight-ln">29</span><span class="highlight-cl"><span class="highlight-c1"></span>        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">Integer</span><span class="highlight-o">&gt;</span> <span class="highlight-n">future_handleAsync_withCustomPool</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">completedFuture</span><span class="highlight-o">(</span><span class="highlight-s">"我是字符串"</span><span class="highlight-o">)</span>
</span></span><span class="highlight-line"><span class="highlight-ln">30</span><span class="highlight-cl">                <span class="highlight-o">.</span><span class="highlight-na">handleAsync</span><span class="highlight-o">((</span><span class="highlight-n">v</span><span class="highlight-o">,</span> <span class="highlight-n">e</span><span class="highlight-o">)</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">31</span><span class="highlight-cl">                            <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"原始计算结果: %s,当前线程: %s \n"</span><span class="highlight-o">,</span> <span class="highlight-n">v</span><span class="highlight-o">,</span> <span class="highlight-n">Thread</span><span class="highlight-o">.</span><span class="highlight-na">currentThread</span><span class="highlight-o">().</span><span class="highlight-na">getName</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">32</span><span class="highlight-cl">                            <span class="highlight-k">return</span> <span class="highlight-n">v</span><span class="highlight-o">.</span><span class="highlight-na">length</span><span class="highlight-o">();</span>
</span></span><span class="highlight-line"><span class="highlight-ln">33</span><span class="highlight-cl">                        <span class="highlight-o">},</span>
</span></span><span class="highlight-line"><span class="highlight-ln">34</span><span class="highlight-cl">                        <span class="highlight-n">FIXED_THREAD_POOL</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln">35</span><span class="highlight-cl">        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">printf</span><span class="highlight-o">(</span><span class="highlight-s">"最终 CompletableFuture 结果: %s \n"</span><span class="highlight-o">,</span> <span class="highlight-n">future_handleAsync_withCustomPool</span><span class="highlight-o">.</span><span class="highlight-na">join</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">36</span><span class="highlight-cl">    <span class="highlight-o">}</span>
</span></span></code></pre>
<p>执行结果：</p>
<blockquote>
<p>原始计算结果: 我是字符串,当前线程: main<br>
最终 CompletableFuture 结果: 5<br>
原始计算结果: 我是字符串,当前线程: ForkJoinPool.commonPool-worker-1<br>
最终 CompletableFuture 结果: 5<br>
原始计算结果: 我是字符串,当前线程: pool-1-thread-1<br>
最终 CompletableFuture 结果: 5</p>
</blockquote>
<p>计算执行异常时，处理异常的示例代码：</p>
<pre><code class="language-java highlight-chroma"><span class="highlight-line"><span class="highlight-ln"> 1</span><span class="highlight-cl">    <span class="highlight-cm">/**
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 2</span><span class="highlight-cl"><span class="highlight-cm">     * {@link CompletableFuture#handle} 处理异常的实例代码
</span></span></span><span class="highlight-line"><span class="highlight-ln"> 3</span><span class="highlight-cl"><span class="highlight-cm">     */</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 4</span><span class="highlight-cl">    <span class="highlight-nd">@Test</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 5</span><span class="highlight-cl">    <span class="highlight-kd">public</span> <span class="highlight-kt">void</span> <span class="highlight-nf">test_handle_method_when_occur_exception</span><span class="highlight-o">()</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 6</span><span class="highlight-cl">        <span class="highlight-n">CompletableFuture</span><span class="highlight-o">&lt;</span><span class="highlight-n">String</span><span class="highlight-o">&gt;</span> <span class="highlight-n">baseFuture</span> <span class="highlight-o">=</span> <span class="highlight-n">CompletableFuture</span><span class="highlight-o">.</span><span class="highlight-na">supplyAsync</span><span class="highlight-o">(()</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 7</span><span class="highlight-cl">            <span class="highlight-k">if</span> <span class="highlight-o">(</span><span class="highlight-kc">true</span><span class="highlight-o">)</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 8</span><span class="highlight-cl">                <span class="highlight-k">throw</span> <span class="highlight-k">new</span> <span class="highlight-n">RuntimeException</span><span class="highlight-o">(</span><span class="highlight-s">"我故意的,嘻嘻"</span><span class="highlight-o">);</span>
</span></span><span class="highlight-line"><span class="highlight-ln"> 9</span><span class="highlight-cl">            <span class="highlight-o">}</span>
</span></span><span class="highlight-line"><span class="highlight-ln">10</span><span class="highlight-cl">            <span class="highlight-k">return</span> <span class="highlight-s">"我是字符串"</span><span class="highlight-o">;</span>
</span></span><span class="highlight-line"><span class="highlight-ln">11</span><span class="highlight-cl">        <span class="highlight-o">});</span>
</span></span><span class="highlight-line"><span class="highlight-ln">12</span><span class="highlight-cl">
</span></span><span class="highlight-line"><span class="highlight-ln">13</span><span class="highlight-cl">        <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"handle : "</span> <span class="highlight-o">+</span>
</span></span><span class="highlight-line"><span class="highlight-ln">14</span><span class="highlight-cl">                <span class="highlight-n">baseFuture</span><span class="highlight-o">.</span><span class="highlight-na">handle</span><span class="highlight-o">((</span><span class="highlight-n">v</span><span class="highlight-o">,</span> <span class="highlight-n">e</span><span class="highlight-o">)</span> <span class="highlight-o">-&gt;</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">15</span><span class="highlight-cl">                            <span class="highlight-k">if</span> <span class="highlight-o">(</span><span class="highlight-n">Objects</span><span class="highlight-o">.</span><span class="highlight-na">nonNull</span><span class="highlight-o">(</span><span class="highlight-n">e</span><span class="highlight-o">))</span> <span class="highlight-o">{</span>
</span></span><span class="highlight-line"><span class="highlight-ln">16</span><span class="highlight-cl">                                <span class="highlight-n">System</span><span class="highlight-o">.</span><span class="highlight-na">out</span><span class="highlight-o">.</span><span class="highlight-na">println</span><span class="highlight-o">(</span><span class="highlight-s">"handle 基础 Future 计算发生异常: "</span> <span class="highlight-o">+</span> <span class="highlight-n">e</span><span class="highlight-o">.</span><span class="highlight-na">getMessage</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">17</span><span class="highlight-cl">                                <span class="highlight-k">return</span> <span class="highlight-n">e</span><span class="highlight-o">.</span><span class="highlight-na">getMessage</span><span class="highlight-o">().</span><span class="highlight-na">length</span><span class="highlight-o">();</span>
</span></span><span class="highlight-line"><span class="highlight-ln">18</span><span class="highlight-cl">                            <span class="highlight-o">}</span>
</span></span><span class="highlight-line"><span class="highlight-ln">19</span><span class="highlight-cl">                            <span class="highlight-k">return</span> <span class="highlight-n">v</span><span class="highlight-o">.</span><span class="highlight-na">length</span><span class="highlight-o">();</span>
</span></span><span class="highlight-line"><span class="highlight-ln">20</span><span class="highlight-cl">                        <span class="highlight-o">})</span>
</span></span><span class="highlight-line"><span class="highlight-ln">21</span><span class="highlight-cl">                        <span class="highlight-o">.</span><span class="highlight-na">join</span><span class="highlight-o">());</span>
</span></span><span class="highlight-line"><span class="highlight-ln">22</span><span class="highlight-cl">    <span class="highlight-o">}</span>
</span></span></code></pre>
</li>
</ul>
<h2 id="参考文档">参考文档</h2>
<ol>
<li><a href="https://colobu.com/2016/02/29/Java-CompletableFuture" target="_blank">https://colobu.com/2016/02/29/Java-CompletableFuture</a></li>
<li><a href="https://www.baeldung.com/java-completablefuture" target="_blank">https://www.baeldung.com/java-completablefuture</a></li>
</ol>
                <div>
                    <hr>

标题：Java 8 - CompletableFuture<br>
作者：<a href="https://forzenfox.github.io" target="_blank">forzenfox</a><br>
地址：<a href="https://forzenfox.github.io/articles/2022/04/26/1650947125974.html" target="_blank">https://forzenfox.github.io/articles/2022/04/26/1650947125974.html</a><br>

<!-- 签名档内可使用 HTML、JavaScript -->
<br>
                </div>

                <aside class="fn__flex">
                        <a class="fn__flex-1 fn__flex-inline" rel="prev" href="https://forzenfox.github.io/articles/2022/04/02/1648886248605.html">
                            <strong>&lt;</strong>
                            <span>&nbsp; Spring Framework 学习笔记 - Spring 应用上下文生命周期&nbsp;&nbsp;&nbsp;</span>
                        </a>
                        <a class="fn__flex-inline" rel="next" href="https://forzenfox.github.io/articles/2023/05/03/1683102869814.html">
                            <span>如何实现在容器内部限速&nbsp; </span>
                            <strong>&gt;</strong>
                        </a>
                </aside>
        </section>

        <footer class="fn-clear share">
            <div class="fn-right">
<div class="article__share"
     data-title="Java 8 - CompletableFuture"
     data-blogtitle="佛系码农"
     data-url="https://forzenfox.github.io/articles/2022/04/26/1650947125974.html"
     data-avatar="https://b3logfile.com/avatar/1636036720949_1636122082221.jpeg?imageView2/1/w/128/h/128/interlace/0/q/100">
    <span class="item" data-type="qqz">
        <svg viewBox="0 0 32 32" width="100%" height="100%">
            <path d="M22.824 13.989l-8.348 6.287s3.351 0.522 8.404 0.461l-0.23-1.040 7.2-6.549c0.132-0.12 0.183-0.312 0.129-0.487s-0.203-0.299-0.377-0.314l-9.492-0.856-3.708-9.213c-0.068-0.169-0.226-0.279-0.401-0.279s-0.333 0.11-0.401 0.279l-3.708 9.213-9.492 0.856c-0.174 0.015-0.323 0.139-0.377 0.314s-0.004 0.366 0.129 0.487l7.2 6.549-2.158 9.742c-0.040 0.178 0.026 0.365 0.168 0.474 0.142 0.107 0.331 0.115 0.481 0.021l8.158-5.165 8.158 5.165c0.070 0.045 0.147 0.066 0.225 0.066 0.090 0 0.18-0.029 0.256-0.086 0.142-0.109 0.208-0.295 0.168-0.474l-1.707-7.704c0.732-0.386 1.538-1.040 1.538-1.040s-3.195 1.638-14.664 0.838l8.312-6.325s-0.327-0.534-10.744-0.914c-0.697-0.026 8.493-1.83 15.281-0.305z"></path>
        </svg>
    </span>
    <span class="item" data-type="wechat">
        <svg viewBox="0 0 32 32" width="100%" height="100%">
            <path d="M9.062 9.203c0-0.859-0.562-1.422-1.422-1.422-0.844 0-1.703 0.562-1.703 1.422 0 0.844 0.859 1.406 1.703 1.406 0.859 0 1.422-0.562 1.422-1.406zM20.672 17.125c0-0.562-0.562-1.125-1.422-1.125-0.562 0-1.125 0.562-1.125 1.125 0 0.578 0.562 1.141 1.125 1.141 0.859 0 1.422-0.562 1.422-1.141zM16.984 9.203c0-0.859-0.562-1.422-1.406-1.422-0.859 0-1.703 0.562-1.703 1.422 0 0.844 0.844 1.406 1.703 1.406 0.844 0 1.406-0.562 1.406-1.406zM26.906 17.125c0-0.562-0.578-1.125-1.422-1.125-0.562 0-1.125 0.562-1.125 1.125 0 0.578 0.562 1.141 1.125 1.141 0.844 0 1.422-0.562 1.422-1.141zM22.75 10.922c-0.359-0.047-0.719-0.063-1.094-0.063-5.375 0-9.625 4.016-9.625 8.953 0 0.828 0.125 1.625 0.359 2.375-0.359 0.031-0.703 0.047-1.063 0.047-1.422 0-2.547-0.281-3.969-0.562l-3.953 1.984 1.125-3.406c-2.828-1.984-4.531-4.547-4.531-7.656 0-5.391 5.094-9.625 11.328-9.625 5.563 0 10.453 3.391 11.422 7.953zM32 19.687c0 2.547-1.688 4.813-3.969 6.516l0.859 2.828-3.109-1.703c-1.141 0.281-2.281 0.578-3.406 0.578-5.391 0-9.625-3.688-9.625-8.219s4.234-8.219 9.625-8.219c5.094 0 9.625 3.688 9.625 8.219z"></path>
        </svg>
    </span>
    <span class="item" data-type="weibo">
        <svg viewBox="0 0 32 32" width="100%" height="100%">
            <path d="M13.444 27.064c-5.3 0.525-9.875-1.875-10.219-5.35-0.344-3.481 3.675-6.719 8.969-7.244 5.3-0.525 9.875 1.875 10.212 5.35 0.35 3.481-3.669 6.725-8.963 7.244zM24.038 15.521c-0.45-0.137-0.762-0.225-0.525-0.819 0.512-1.287 0.563-2.394 0.006-3.188-1.038-1.481-3.881-1.406-7.137-0.037 0 0-1.025 0.444-0.762-0.363 0.5-1.613 0.425-2.956-0.356-3.737-1.769-1.769-6.469 0.069-10.5 4.1-3.013 3.006-4.763 6.212-4.763 8.981 0 5.287 6.787 8.506 13.425 8.506 8.7 0 14.494-5.056 14.494-9.069 0-2.431-2.044-3.806-3.881-4.375z"></path>
            <path d="M29.819 5.833c-2.1-2.331-5.2-3.219-8.063-2.612v0c-0.663 0.144-1.081 0.794-0.938 1.45 0.144 0.662 0.788 1.081 1.45 0.938 2.038-0.431 4.238 0.2 5.731 1.856s1.9 3.913 1.256 5.888v0c-0.206 0.644 0.144 1.331 0.788 1.544 0.644 0.206 1.331-0.144 1.544-0.787v-0.006c0.9-2.762 0.331-5.938-1.769-8.269z"></path>
            <path d="M26.588 8.752c-1.025-1.138-2.538-1.569-3.925-1.269-0.569 0.119-0.931 0.688-0.813 1.256 0.125 0.569 0.688 0.931 1.25 0.806v0c0.681-0.144 1.419 0.069 1.919 0.619 0.5 0.556 0.637 1.313 0.419 1.975v0c-0.175 0.55 0.125 1.15 0.681 1.331 0.556 0.175 1.15-0.125 1.331-0.681 0.438-1.356 0.163-2.906-0.863-4.037z"></path>
            <path d="M13.738 20.771c-0.188 0.319-0.594 0.469-0.912 0.337-0.319-0.125-0.412-0.488-0.231-0.794 0.188-0.306 0.581-0.456 0.894-0.337 0.313 0.113 0.425 0.469 0.25 0.794zM12.044 22.933c-0.512 0.819-1.613 1.175-2.438 0.8-0.813-0.369-1.056-1.319-0.544-2.119 0.506-0.794 1.569-1.15 2.388-0.806 0.831 0.356 1.1 1.3 0.594 2.125zM13.969 17.146c-2.519-0.656-5.369 0.6-6.463 2.819-1.119 2.262-0.037 4.781 2.506 5.606 2.638 0.85 5.75-0.456 6.831-2.894 1.069-2.394-0.262-4.85-2.875-5.531z"></path>
        </svg>
    </span>
    <span class="item" data-type="twitter">
        <svg viewBox="0 0 32 32" width="100%" height="100%">
            <path d="M32.003 6.075c-1.175 0.525-2.444 0.875-3.769 1.031 1.356-0.813 2.394-2.1 2.887-3.631-1.269 0.75-2.675 1.3-4.169 1.594-1.2-1.275-2.906-2.069-4.794-2.069-3.625 0-6.563 2.938-6.563 6.563 0 0.512 0.056 1.012 0.169 1.494-5.456-0.275-10.294-2.888-13.531-6.862-0.563 0.969-0.887 2.1-0.887 3.3 0 2.275 1.156 4.287 2.919 5.463-1.075-0.031-2.087-0.331-2.975-0.819 0 0.025 0 0.056 0 0.081 0 3.181 2.263 5.838 5.269 6.437-0.55 0.15-1.131 0.231-1.731 0.231-0.425 0-0.831-0.044-1.237-0.119 0.838 2.606 3.263 4.506 6.131 4.563-2.25 1.762-5.075 2.813-8.156 2.813-0.531 0-1.050-0.031-1.569-0.094 2.913 1.869 6.362 2.95 10.069 2.95 12.075 0 18.681-10.006 18.681-18.681 0-0.287-0.006-0.569-0.019-0.85 1.281-0.919 2.394-2.075 3.275-3.394z"></path>
        </svg>
    </span>
    <span class="item__qr"></span>
</div>            </div>
        </footer>
            <div id="relevantArticles" class="abstract"></div>
            <div id="randomArticles" class="abstract"></div>
        <br>
    </article>
        <div style="padding: 30px 60px 30px 50px;" id="gitalk-container"></div>
        <div id="b3logsolocomments"></div>
        <div id="vcomment" style="padding: 30px 60px 30px 50px;" data-name="forzenfox"
             data-postId="1650947125974"></div>

<footer class="footer">
    <div class="fn-clear">
        浏览数：<span data-uvstaturl="https://forzenfox.github.io">0</span>
        &nbsp;
        文章总数：55
        <br>
        &copy; 2023
        <a href="https://forzenfox.github.io">佛系码农</a>
        
    </div>
    <span onclick="Util.goTop()" class="icon-goup"></span>
</footer>
<script>
  var Label = {
    speech: true,
    servePath: "https://forzenfox.github.io",
    staticServePath: "https://forzenfox.github.io",
    luteAvailable: true,
    hljsStyle: 'dracula',
    langLabel: "zh_CN",
    version: "4.4.0",
    staticSite: true,
    showCodeBlockLn: true,
    articleId: "1650947125974",
  }
</script>
<script src="https://forzenfox.github.io/skins/yilia/js/common.min.js?1691458683705"></script>


<script type="text/javascript">
    Util.addScript('https://forzenfox.github.io/js/page.min.js?1691458683705', 'soloPageScript')
    var page = new Page({
        "commentContentCannotEmptyLabel": "评论不能为空",
        "oId": "1650947125974",
        "blogHost": "https://forzenfox.github.io",
        "randomArticles1Label": "随机阅读：",
        "externalRelevantArticles1Label": "站外相关阅读："
    });
    $(document).ready(function () {
        page.load();
        page.tips.externalRelevantArticlesDisplayCount = "0";
            page.loadRandomArticles();
            page.loadRelevantArticles('1650947125974', '<h4>相关阅读：</h4>');
        page.share()
    });
</script>
</main>
</body>
</html>

<!-- Generated by Latke (https://github.com/88250/latke) in 21ms, 2023/08/08 09:51:59 -->